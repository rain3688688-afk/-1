"use client";

import React, { useState, useEffect, useRef } from 'react';
import { Sparkles, Lock, RefreshCw, Zap, Heart, Shield, Anchor, Wind, Grid, Eye, Sun, Moon, ChevronRight, BookOpen, Key, Feather, Search, X, Camera, CheckCircle2, ArrowLeft, ArrowRight, AlertCircle } from 'lucide-react';
import Head from 'next/head';
import { createClient } from '@supabase/supabase-js';
import { Radar, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, ResponsiveContainer } from 'recharts';
import html2canvas from 'html2canvas';

// --- 初始化 Supabase ---
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || "";
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || "";
const supabase = createClient(supabaseUrl, supabaseKey);

// 章节配置
const PARTS_CONFIG = [
  { id: 1, startIndex: 0, endIndex: 15, title: "Part 1：现实切片", quote: "“爱不仅仅是誓言，更是下意识的本能。”", desc: "先让我们从生活的琐碎里，捕捉你在亲密关系中那些最真实的条件反射。" },
  { id: 2, startIndex: 16, endIndex: 31, title: "Part 2：情绪暗涌", quote: "“日常的表象之下，藏着我们未曾说出口的渴望。”", desc: "现在的你，已经脱去了社交伪装。让我们再往下潜一点，去触碰那些让你感到不安、委屈或满足的瞬间。" },
  { id: 3, startIndex: 32, endIndex: 47, title: "Part 3：灵魂本相", quote: "“语言无法抵达的地方，直觉可以。”", desc: "欢迎来到你内心的最深处。接下来的问题不需要逻辑，仅凭直觉，选出你第一眼看到的那个答案。" }
];

// --- 题目数据 (完整48题) ---
const QUESTIONS = [
  { id: 1, question: "周末下午，伴侣突然失联了3个小时，发消息也没回。那一刻，你最真实的反应是？", options: [{ text: "忍不住反复确认手机，并在脑子里复盘之前的细节，总觉得是哪儿出了问题。", type: "确定感" }, { text: "挺好的，刚好可以专心做自己的事。", type: "自主权" }, { text: "有点烦躁，想等TA一出现就问清楚到底干嘛去了。", type: "掌控感" }, { text: "心里堵得慌。如果TA够在意我，怎么舍得让我空等？", type: "被偏爱" }] },
  { id: 2, question: "伴侣最近工作压力极大，回家后一言不发。此时你心里的念头是？", options: [{ text: "看着心疼。想多照顾照顾TA，让TA觉得有我在。", type: "被需要" }, { text: "既然TA不想说话，那我就不去打扰了。先忙自己的事吧。", type: "安全距离" }, { text: "死气沉沉的沉默很难受。我希望能和TA聊一聊TA内心到底在经历什么。", type: "精神共鸣" }, { text: "我可以保持安静，但需要先确认一下：是需要我陪着，还是各待各的？", type: "秩序感" }] },
  { id: 3, question: "因为一件琐事发生了激烈的争吵，甚至有些冷场。你心里那个过不去的点主要是？", options: [{ text: "态度冷冰冰。那种随时要放弃我的感觉最让我害怕。", type: "确定感" }, { text: "没吵出个结果。到底谁的问题？以后再遇到这事儿按谁的办？", type: "秩序感" }, { text: "心软了。看TA气成那样，输赢不重要，想先抱抱TA。", type: "被需要" }, { text: "无法沟通。不立刻解决问题翻篇，我就没法安心做事。", type: "掌控感" }] },
  { id: 4, question: "你冷不丁冒出一个有点奇怪的脑洞，想讲给伴侣听。此时你最期待的是？", options: [{ text: "哪怕听不懂，但你愿意放下手机认真听我说完，我很满足。", type: "被偏爱" }, { text: "瞬间接住梗，还能延伸出新观点。那一刻真的会感叹：这世上只有你懂我。", type: "精神共鸣" }, { text: "我就是顺口这么一说。你也随性的回应，松弛就好。", type: "自主权" }, { text: "哪怕想法很奇怪，你也能笑笑接纳。不用怕说错，也不怕被你嫌弃。", type: "安全距离" }] },
  { id: 5, question: "伴侣想看你的手机，或者询问你过去的详细情感经历。你的本能反应是？", options: [{ text: "哪怕没秘密也反感。这是隐私，被审视的感觉很不舒服。", type: "自主权" }, { text: "随便看。如果你看了能让彼此更安心，那我完全可以接受。", type: "确定感" }, { text: "看可以，但要公平。如果我也能看你的，那就没问题。", type: "秩序感" }, { text: "看可以，但不想被误解。不希望你片面定义现在的我。", type: "精神共鸣" }] },
  { id: 6, question: "伴侣偶尔有些迷糊，犯了个不大不小的错。你的常见反应是？", options: [{ text: "没事，我来搞定。我知道你也不是故意的，你可以依靠我。", type: "被需要" }, { text: "觉得被忽视了。你是不是没把我的事放心上？", type: "被偏爱" }, { text: "有点抓狂。为什么老是出这种低级错误？我不想再失控了。", type: "掌控感" }, { text: "这很正常。不用别搞得太严肃，别把小事化大了。", type: "安全距离" }] },
  { id: 7, question: "谈到“未来”这个话题时，什么情况最让你感到不安？", options: [{ text: "对方总说“顺其自然”。走一步看一步的状态，让我没有安全感。", type: "秩序感" }, { text: "态度不坚定。如果表现出一丝犹豫，我就怀疑TA没打算长久。", type: "确定感" }, { text: "想到未来几十年都是一眼望得到头的生活，我就本能地想逃。", type: "自主权" }, { text: "怕未来各过各的。我们不再需要彼此，变成两个合租的陌生人。", type: "被需要" }] },
  { id: 8, question: "当你自己情绪崩溃、非常脆弱的时候，你最希望对方做什么？", options: [{ text: "别问，也别盯着我看。等我自己消化好，再体体面面地回来找你。", type: "安全距离" }, { text: "紧紧抱着我。在那份安静里，我能感觉到你正感同身受地陪我一起难过。", type: "精神共鸣" }, { text: "帮我分析烂摊子怎么收场，解决那个搞崩我的问题。", type: "掌控感" }, { text: "别讲大道理。就算我无理取闹，我也需要你先无条件站在我这边。", type: "被偏爱" }] },
  { id: 9, question: "纪念日那天，如果伴侣准备的礼物让你觉得失望，那个最失望的点通常是？", options: [{ text: "我是特别的吗？感觉换成别人，你大概也会送一样的东西。", type: "被偏爱" }, { text: "你真的懂我吗？你其实根本不懂真正的我，你对我的了解太过浅显。", type: "精神共鸣" }, { text: "乱花钱还没用。这礼物既不实用也占地方，甚至是一种负担。", type: "秩序感" }, { text: "不够对等。我总是记着你的喜好，你对我却一无所知。", type: "被需要" }] },
  { id: 10, question: "伴侣希望你陪TA去参加TA的朋友聚会，你最舒服的状态是？", options: [{ text: "你能一直带着我。让我感觉到在这场陌生的热闹里，你是我的底气和依靠。", type: "确定感" }, { text: "咱们按计划来。别临时变卦去没准备的局，也别当众聊那些不该聊的私事。", type: "掌控感" }, { text: "当作一场普通的社交活动。我不是你的一个挂件，我在其中能玩得开心最重要。", type: "自主权" }, { text: "保持礼貌的距离感。我可以陪你出席，但我不想彻底融入你的圈子。", type: "安全距离" }] },
  { id: 11, question: "两个人一起出去旅行，最容易让你心里炸毛的瞬间是？", options: [{ text: "低级失误搞砸计划。赶不上车/景点关门，这种本可以避免的混乱最让我暴躁。", type: "掌控感" }, { text: "行程变来变去。我需要知道今天到底要干嘛。", type: "秩序感" }, { text: "被行程表催着走。非要几点起床、去哪打卡，这像军训。", type: "自主权" }, { text: "同路不同频。我在为美景感叹，你却完全不在状态甚至觉得无聊。", type: "精神共鸣" }] },
  { id: 12, question: "长时间同居或相处，伴侣有一些让你看不惯的生活习惯。你的第一反应通常是？", options: [{ text: "生活不能这么乱来。如果大家都随心所欲，这个家就乱套了。", type: "秩序感" }, { text: "你是不是根本没听进去？说过好几次了还这样，根本没把我放心上。", type: "确定感" }, { text: "别管我就行。我不想被TA强行改造，所以我也不会干涉TA的活法。", type: "自主权" }, { text: "真是拿你没辙。嘴上虽然嫌弃，但还是会边唠叨边帮TA收尾。", type: "被需要" }] },
  { id: 13, question: "伴侣无意中提起了一个优秀的异性朋友，言语间满是欣赏。你第一反应是？", options: [{ text: "酸溜溜的。哪怕对方再出色，为什么要当着我的面这样夸别的异性？", type: "被偏爱" }, { text: "警铃大作。我会忍不住横向对比，那个人是不是比我更适合TA？", type: "确定感" }, { text: "想搞清楚底细。我要确认你们的互动边界在哪里，确认关系是否在可控范围内。", type: "掌控感" }, { text: "本能地切断话题。我不希望原本的生活被打扰，也不愿去扮演那个疑神疑鬼的嫉妒狂。", type: "安全距离" }] },
  { id: 14, question: "在一起久了，关系进入平淡模式，每天更多是围绕柴米油盐。你会觉得？", options: [{ text: "慢性死亡。没有思想交流，只剩空壳。", type: "精神共鸣" }, { text: "感到很沮丧。好像我是你生活里可有可无的背景板。", type: "被需要" }, { text: "挺好的。在同一个屋檐下舒服做自己很自在。", type: "自主权" }, { text: "这才是理想的状态。稳定的的生活节奏才是我追求的终点。", type: "秩序感" }] },
  { id: 15, question: "你正沉浸在某个小爱好里，你希望伴侣是什么样的反应？", options: [{ text: "保持边界不加入。明白这是我自己的精神自留地。", type: "安全距离" }, { text: "保持对我的尊重。即使你不认可也要明白我有权支配自己的时间。", type: "掌控感" }, { text: "懂我的那份快乐。至少能感受到为什么这个东西能打动我。", type: "精神共鸣" }, { text: "陪我一起玩。哪怕不喜欢，也希望能为了我参与一下。", type: "被偏爱" }] },
  { id: 16, question: "大吵一架终于和好了。为了让这页彻底翻过去，你最需要的一个“收尾动作”是？", options: [{ text: "反复确认直到有确凿的答案。“我们真的没事了吗？”", type: "确定感" }, { text: "某种补偿行为。比如给TA做顿好吃的。", type: "被需要" }, { text: "彻底不提。赶紧回归正常，把这难受的一页揭过去。", type: "安全距离" }, { text: "得到一个小惊喜。买个礼物或者带我吃顿好的。", type: "被偏爱" }] },
  // Part 2
  { id: 17, question: "在一段关系里，最让你感到痛苦的那种时刻，其实是？", options: [{ text: "你到底在想什么？为什么要让我不停猜忌？", type: "确定感" }, { text: "到底还要退让到哪一步？为什么我一点私人空间都没有了？", type: "自主权" }, { text: "凭什么我说了不算？为什么我只能被动地接受你的安排？", type: "掌控感" }, { text: "你到底听懂我在说什么了吗？为什么我们像是两个世界的人？", type: "精神共鸣" }] },
  { id: 18, question: "如果你感到被亏欠、被辜负时，你心里最先跳出来的念头是？", options: [{ text: "我到底算什么？我的付出在你眼里一点分量都没有？", type: "被需要" }, { text: "果然还是不该抱期待。为什么要给你伤害我的机会？", type: "安全距离" }, { text: "凭什么每次都要我退一步？难道讲道理的人，注定就该多吃点亏吗？", type: "秩序感" }, { text: "你是不是对谁都这样？只是我刚好是你的伴侣。", type: "被偏爱" }] },
  { id: 19, question: "当你感受到什么时，最能让你由衷地感叹“这就是我要的爱”？", options: [{ text: "是轻松。没有压力，没有强制要求。", type: "自主权" }, { text: "是踏实。不管发生什么，你永远会在我身边。", type: "确定感" }, { text: "是同频。哪怕我词不达意，你也总能瞬间懂我。", type: "精神共鸣" }, { text: "是清晰。凡事有交代，事事有回音。", type: "掌控感" }] },
  { id: 20, question: "当伴侣非常黏你、几乎时刻都要和你在一起时，你的真实感受是？", options: [{ text: "很满足。说明你真的很依赖我，我很重要。", type: "被需要" }, { text: "很想躲。如此的亲密让我觉得是种打扰。", type: "安全距离" }, { text: "有点焦躁。如果连正常生活节奏都被打乱了，我会觉得你不懂事。", type: "秩序感" }, { text: "很受用。这种非我不可的劲儿，最能证明你爱我。", type: "被偏爱" }] },
  { id: 21, question: "两个人坐在一起不说话时，你心里的真实活动是？", options: [{ text: "很难受。这种精神上的断连，让我觉得像陌生人。", type: "精神共鸣" }, { text: "很慌张。猜TA为什么不说话？是不是生气了？", type: "确定感" }, { text: "很舒服。互不干扰，这种松弛感才是最好的。", type: "自主权" }, { text: "很想找点事做。不喜欢这种不知道该干嘛的冷场。", type: "掌控感" }] },
  { id: 22, question: "如果你在这段关系里付出了很多，你最害怕的结果是？", options: [{ text: "怕你是真的不需要。怕我给的东西对你是个负担。", type: "被需要" }, { text: "怕这只是我的一厢情愿。只有我一人在投入。", type: "秩序感" }, { text: "怕你把这当成理所应当。连一点特殊的感动都没有。", type: "被偏爱" }, { text: "怕被赖上。怕你索取更多，让我背上沉重义务。", type: "安全距离" }] },
  { id: 23, question: "当听到“永远”这个词的时候，你下意识的反应是？", options: [{ text: "松了一口气。它能压住我心里所有的不安。", type: "确定感" }, { text: "压力好大。还没发生的事就先锁死，很沉重。", type: "自主权" }, { text: "听听就行。没有行动支撑就是空头支票。", type: "掌控感" }, { text: "很多余。真正的契合是不需要用时间来担保的。", type: "精神共鸣" }] },
  { id: 24, question: "在激烈的争吵中，最让你感到绝望、甚至想放弃的一瞬间是？", options: [{ text: "是TA推开我的时候。说“不用你管”。", type: "被需要" }, { text: "是TA开始胡搅蛮缠的时候。没有任何道理可讲。", type: "秩序感" }, { text: "是TA站在我对立面的时候。帮理不帮亲。", type: "被偏爱" }, { text: "是TA逼我立刻说话的时候。被逼到死角的窒息感。", type: "安全距离" }] },
  { id: 25, question: "哪怕此时此刻什么都没发生，但只要想到这件事，你就会觉得非常有安全感：", options: [{ text: "我知道你会坚定地站在我这边。不权衡利弊。", type: "确定感" }, { text: "我知道生活的方向盘始终握在自己手里。生活不会被打乱。", type: "掌控感" }, { text: "我知道我是不可替代的。我能给你别人给不了的支撑。", type: "被需要" }, { text: "我知道我随时可以做自己。不需要伪装。", type: "自主权" }] },
  { id: 26, question: "你觉得一段失败的感情，最让你觉得意难平的点可能是？", options: [{ text: "“我根本不是你的唯一。”", type: "被偏爱" }, { text: "“我们从未真正交流过。” ", type: "精神共鸣" }, { text: "“我们收场得如此难看。”" , type: "秩序感" }, { text: "“我不该全盘托出。”", type: "安全距离" }] },
  { id: 27, question: "你会因为什么事情而产生强烈的占有欲？", options: [{ text: "当TA遇到麻烦却不找我时。", type: "被需要" }, { text: "当TA对别人也很温柔的时候。", type: "被偏爱" }, { text: "当TA有事故意瞒着我时。", type: "掌控感" }, { text: "当TA和别人聊得能更投机时。", type: "精神共鸣" }] },
  { id: 28, question: "如果伴侣出差或不在家，留你一个人独处一周。你的真实感受是？", options: [{ text: "像放假一样爽。完全属于自己的时间太珍贵了。", type: "自主权" }, { text: "逐渐开始慌张。忍不住确认TA还在意我。", type: "确定感" }, { text: "终于可以透口气了。不需要应对TA的情绪很放松。", type: "安全距离" }, { text: "有点无所适从。没有TA像往常一样依赖我，反而觉得不真实。", type: "被需要" }] },
  { id: 29, question: "如果伴侣做了这件事，你会瞬间下头，甚至考虑分手？", options: [{ text: "言而无信。承诺的不兑现，没法过。", type: "秩序感" }, { text: "拒绝沟通。说“想太多”或者直接回避。", type: "精神共鸣" }, { text: "制造混乱。做事毫无章法搞得生活一团糟。", type: "掌控感" }, { text: "权衡利弊。为了别的东西牺牲了我的利益。", type: "被偏爱" }] },
  { id: 30, question: "如果给你自己写一份“恋爱使用说明书”，你最希望标注的核心法则是？", options: [{ text: "“请坚定地选择我。” 别犹豫，别摇摆。", type: "确定感" }, { text: "“请允许我做自己。” 别打着为我好的名义改造我。", type: "自主权" }, { text: "“请看见我的付出。” 别把一切都当成空气。", type: "被需要" }, { text: "“请给我一点时间。”别一上来就掏心掏肺。", type: "安全距离" }] },
  { id: 31, question: "如果让你用一个词来定义你理想中的关系形态，你希望你们是？", options: [{ text: "合伙人。不仅要讲感情，更要讲公平和逻辑。", type: "秩序感" }, { text: "船长与领航员。有明确方向，有问题能迅速解决。", type: "掌控感" }, { text: "灵魂双生。不用磨合的默契，眼神一对就知道。", type: "精神共鸣" }, { text: "两条相邻的河。有交集，又互不吞没。", type: "自主权" }] },
  { id: 32, question: "在你看来，一个人爱你的最高级表现是？", options: [{ text: "特权。TA对世界冷漠，唯独对我不一样。", type: "被偏爱" }, { text: "托底。无论我变成什么样，TA永远站在我身后。", type: "确定感" }, { text: "依赖。愿意把最脆弱的一面给我看，只让我照顾。", type: "被需要" }, { text: "尊重。懂得站在安全线以外守护我。", type: "安全距离" }] },
  // Part 3
  { id: 33, question: "如果要把你向往的亲密关系画成一幅画，它最像什么？", options: [{ text: "深扎的树根，根脉永不离散。", type: "确定感" }, { text: "并行的云朵，聚散各自自由。", type: "自主权" }, { text: "循轨的星辰，一切尽在预判。", type: "掌控感" }, { text: "对望的山谷，声息悉数回响。", type: "精神共鸣" }] },
  { id: 34, question: "如果要把自己比喻成一种动物，在爱人面前，你更像？", options: [{ text: "温顺的大金毛。你感受到温暖我就满足。", type: "被需要" }, { text: "被驯服的小狐狸。我只认你这一个驯养员。", type: "被偏爱" }, { text: "屯松果的松鼠。未雨绸缪，规划好过冬。", type: "秩序感" }, { text: "林间的小鹿。生性敏感，试探着靠近。", type: "安全距离" }] },
  { id: 35, question: "闭上眼，你觉得最让你感到安稳的那个空间是？", options: [{ text: "避风的暖屋。门窗紧闭，你就在我身旁。", type: "确定感" }, { text: "辽阔的荒原。极目远望，没有任何围栏。", type: "自主权" }, { text: "深谧的书斋。相对无言，灵魂亦能同频。", type: "精神共鸣" }, { text: "整饬的园林。一草一木，皆能如我所愿。", type: "掌控感" }] },
  { id: 36, question: "如果这段爱意走向最终的崩塌，你觉得那个最让你心碎的画面像？", options: [{ text: "枯竭的深井。倾尽所有，再多付出也无回响。", type: "被需要" }, { text: "渐窄的峡谷。步步逼近，被你逼到退无可退。", type: "安全距离" }, { text: "倾塌的廊柱。逻辑崩坏，所有体面悉数碎裂。", type: "秩序感" }, { text: "入海的溪流。泯然众人，再无半分特别。", type: "被偏爱" }] },
  { id: 37, question: "如果“誓言”是一个具体的物品，你希望它是什么？", options: [{ text: "磐石。够重够硬，镇住所有变数。", type: "确定感" }, { text: "风铃。风来时响，风走时静，不束缚。", type: "自主权" }, { text: "契约。白纸黑字，不可违背的守则。", type: "掌控感" }, { text: "潮汐。是引力，不言自明的必然性。", type: "精神共鸣" }] },
  { id: 38, question: "你最喜欢的亲密关系，它的“温度”应该是？", options: [{ text: "滚烫的 100°C。沸腾的热情，全心全意。", type: "被需要" }, { text: "微凉的 20°C。清爽不黏人才长久。", type: "安全距离" }, { text: "恒温的 26°C。永远稳定如初，不会忽冷忽热。", type: "秩序感" }, { text: "偏私的 37°C。隐秘私有，只我有资格触碰。", type: "被偏爱" }] },
  { id: 39, question: "如果爱是一件必须随身携带的物品，你觉得它最像？", options: [{ text: "贴身的护身符。握紧它，熨平内心躁动。", type: "确定感" }, { text: "降噪耳机。戴上它，世界嘈杂消失。", type: "精神共鸣" }, { text: "瑞士军刀。掌控它，帮我解决所有难题。", type: "掌控感" }, { text: "一张空白机票。拥有它，奔向任何自由。", type: "自主权" }] },
  { id: 40, question: "如果有一天真的要分开，你希望那是？", options: [{ text: "燃尽。流干了最后一滴泪才甘心离场。", type: "被需要" }, { text: "退潮。自然而然退去，像没发生过。", type: "安全距离" }, { text: "清算。把账算清，把话说开。", type: "秩序感" }, { text: "绝版。你再也遇不到像我这样的人。", type: "被偏爱" }] },
  { id: 41, question: "你最喜欢的恋爱氛围，像哪种天气？", options: [{ text: "微风过境。万物在自在生长。", type: "自主权" }, { text: "初雪静落。世界只剩下温柔。", type: "被偏爱" }, { text: "秋光朗照。目之所及皆澄澈。", type: "秩序感" }, { text: "深夜雷雨。共度这一刻孤岛。", type: "精神共鸣" }] },
  { id: 42, question: "如果你闭上眼触摸“爱”，手感应该是？", options: [{ text: "晒暖的磐石。温厚干燥，沉稳有力。", type: "确定感" }, { text: "沉陷的丝绒。丝缕相依，无缝贴合。", type: "被需要" }, { text: "顺滑的凉绸。触手清凉，轻盈无压。", type: "安全距离" }, { text: "打磨的古玉。坚实清澈，分寸随心。", type: "掌控感" }] },
  { id: 43, question: "你觉得一段好的亲密关系，味道应该像？", options: [{ text: "雨后的雪松。清冽通透。", type: "自主权" }, { text: "草莓尖尖。第一口咬下去的甜。", type: "被偏爱" }, { text: "晒过的暖棉。纤尘不染。", type: "秩序感" }, { text: "幽远的墨香。沉静悠长。", type: "精神共鸣" }] },
  { id: 44, question: "你希望爱人是哪种光源？", options: [{ text: "壁炉里的火。我时时添柴，一起温暖屋檐。", type: "被需要" }, { text: "恒定的北极星。无惧时空轮转，始终如一。", type: "确定感" }, { text: "窗外的月。温柔清冷，不灼双眼。", type: "安全距离" }, { text: "掌心的灯。随我指引方向，照亮前路。", type: "掌控感" }] },
  { id: 45, question: "如果把与爱人的相处节奏比作一段旋律，你希望它是？", options: [{ text: "深沉的钟摆。起伏有常，步调分明。", type: "秩序感" }, { text: "悠然的哼唱。没固定曲调，轻轻松松。", type: "自主权" }, { text: "山谷里的回音。微弱声音也能得到回应。", type: "精神共鸣" }, { text: "为我独奏。全世界是背景，只有我们。", type: "被偏爱" }] },
  { id: 46, question: "如果爱必须伴随一种痛，你宁愿是？", options: [{ text: "生长痛。负荷生命，换取深度共生。", type: "被需要" }, { text: "钝痛。好过“不知道明天你还在不在”的撕裂。", type: "确定感" }, { text: "幻痛。宁愿隔着距离怀念，也不愿互相伤害。", type: "安全距离" }, { text: "剥离痛。撕掉假面，灵魂赤裸相见。", type: "精神共鸣" }] },
  { id: 47, question: "如果要把你们共度的时间比作一样东西，它应该是？", options: [{ text: "流沙。抓越紧流越快，不如摊开手。", type: "自主权" }, { text: "沙漏。起止随心，进度尽在掌控。", type: "掌控感" }, { text: "琥珀。封存最美瞬间，不被侵蚀。", type: "被偏爱" }, { text: "年轮。一圈一圈，扎扎实实。", type: "秩序感" }] },
  { id: 48, question: "最后，请凭直觉填空：爱是______。", options: [{ text: "定数。唯一答案，永不更改。", type: "确定感" }, { text: "认出。万众之中，你是同类。", type: "精神共鸣" }, { text: "成全。不设枷锁，予你山海。", type: "自主权" }, { text: "滋养。接纳破碎，护你周全。", type: "被需要" }] }
];

// --- 结果配置 (全面优化) ---
const RESULTS = {
  "确定感": {
    type: "确定感",
    archetype: "风暴中的守夜人",
    icon: <Anchor className="w-8 h-8" />,
    quote: "万物皆流变，而我只要一种绝对的定数。",
    cardStyle: "from-blue-800 to-slate-900 shadow-[0_0_50px_-10px_rgba(30,58,138,0.4)] border-blue-800/30",
    accentColor: "text-blue-800",
    radarColor: "#1e40af",
    tabActiveColor: "bg-amber-100 text-blue-900 border-amber-200",
    tabInactiveColor: "bg-white/80 text-blue-900/50",
    themeColor: "bg-blue-800",
    content: {
      base: `在亲密关系中，你最核心的情感偏好其实是稳定与可预期。比起那些虚无缥缈、轰轰烈烈的浪漫桥段，你更倾向于把安全感建立在每一个清晰的互动细节里：说过的话能兑现，计划有变会提前解释，重要的事哪怕没结果也会有回应。对你来说，这种“确定感”从来不是什么死板的条框，而是一种让两个人都活得更踏实的基础设施，是关系的底气。\n\n你的情感底色其实很厚重，甚至带着一种现代人少有的契约精神。你对感情的投入从不打算浅尝辄止，而总是带着一种“既然认定，就想走完一生”的郑重。只要对方给出的态度足够明确，行为的边界足够清晰，你就会表现出极强的韧性：你会自然而然地把对方纳入自己的人生规划，愿意耐下心来磨合，也做好了共同承担现实责任的准备。你并不执着于找一个完美的人，你更看重的是一致性与持续性——关系可以有磕碰，但不该悬而未决；可以有争吵，但不该动辄冷处理或者玩失踪。\n\n也正因如此，你对关系里的模糊与摇摆会表现得格外敏感。对方流露出的那一丁点犹豫、延迟或冷处理，都会让你很难真正心安，因为在你看来，这些信号背后意味着关键信息的缺失。你往往需要通过不断的“确认”来让关系回归清晰：我们现在是什么状态？你的选择还坚定吗？我们是不是还站在同一边？这并不是所谓的控制欲，更不是软弱的依赖，而是你最本能的爱人方式——你需要在确定的地基上安放自己，才敢在那份明确的信号里，毫无保留地交出你的爱。`,
      light: [
        { label: "稳定的情感支撑力", text: "你是关系中定海神针般的存在，具备极强的抗风险韧性。不会因短期矛盾或外界波动轻易放弃联结，始终以长期视角对待关系，能为对方提供可依赖的情感锚点，尤其在关系遭遇压力时，更能展现出坚定的守护姿态。" },
        { label: "纯粹的情感忠诚度", text: "你的情感投入具有极强的排TA性与专注度，拒绝 “骑驴找马”“留退路” 等模糊模式。一旦确立联结，便会毫无保留地全心投入，将 “忠诚” 内化为关系的核心准则，这份纯粹性让对方能感受到强烈的被重视感。" },
        { label: "主动的关系修复力", text: "面对关系裂痕，你倾向于解决问题而非逃避冲突。具备主动沟通、磨合调整的意识，愿意为关系的长久性付出精力，始终以 “巩固联结、延续稳定” 为目标，展现出务实的经营能力。" }
      ],
      shadow: [
        { label: "对模糊信号的过度敏感", text: "难以耐受关系中的信息空白，当对方出现沉默、回避等不确定行为时，易陷入过度解读与自我归因，将中性信号转化为被否定、被厌倦的负面预判，进而引发内心焦虑。" },
        { label: "以体谅为名的需求压抑", text: "因恐惧成为对方的 “负担”，常以 “懂事”“体谅” 为借口，刻意隐藏自身的情感需求与不安。表面上的 “没事，你去忙”，本质是对真实情绪的压抑，长期积累易导致自我消耗与关系失衡。" },
        { label: "对未来的焦虑性预判", text: "受怕失去的深层恐惧驱动，习惯对关系走向做负面预设，难以全然接纳当下的美好。这种对 稳定感的过度渴求，会转化为持续的焦虑，阻碍你沉浸式体验关系中的正向反馈与快乐。" }
      ],
      partner: [
        "你的追问，从不是找茬，是在求一份安心。当你反复问 “去哪了”“在干嘛”“爱不爱我” 时，别嫌我烦 —— 那一刻我正被不安包裹。你不用跟我讲道理，只要抱抱我说 “我在，别怕”，就够了。",
        "你的 “报备”，是我的定心丸。我不要求你秒回消息，但真的怕你突然失联。如果你要忙、或者心情不好想静一静，提前说一句 “我忙会儿，晚点找你”，就能让我从心慌落到踏实。",
        "关键时刻，请坚定地偏向我。我不用你对抗全世界，但需要知道：在我和别人之间，你会本能地护着我。任何犹豫、迟疑，或是 “先讲道理再顾我”，在我眼里都会变成 “我不重要” 的信号。"
      ],
      self: `深度溯源：看见那个一直在扫雷的你\n\n你对确定感的强烈需求，其实既不是矫情，也不是单纯地想要讨一个承诺。它更像是一套你为了保护自己而练就的预警系统：你必须尽快判断这段关系是否安全，好把那些被抛下的风险提前排除掉。真正让你难受的，往往不是对方失联的那几个小时，而是信息缺失后留下的那段空白。因为在亲密关系里，人的大脑天生就有补全空白的本能，而我们又习惯用最坏的可能性去填满未知——对你的神经系统来说，宁愿误判危险，也不敢漏掉危险。于是你开始反复回看、不停推演、寻找线索，像是在一段关系里做着一场无声的排雷。\n\n这种模式的根源，通常能追溯到两个方向。\n\n第一种可能，是你曾在过往的重要关系里，反复经历过那种“落空感”。在某些你需要回应的关键时刻，对方却选择了沉默、逃避甚至直接消失；事后TA们也并不觉得这有什么大不了，只是敷衍着翻篇，甚至反过来责怪你多想。虽然不是每次都如此，但只要有那么几次深刻的记忆，就足以让你的大脑形成肌肉记忆：把一切“未知”都当成危险信号来处理。于是你不得不本能地追求明确，试图通过不断确认来补齐缺失的信息，逼自己快点拿到一个确定的答案。\n\n另一种可能，则是你天生对连接的信号就比别人更敏锐。有些人注定更在意关系的质量，这并不代表软弱，只是系统设定的不同。一旦关系中出现了模糊地带，你就会比别人更快地进入一种“高唤醒状态”：你的心跳、呼吸和所有的注意力都会被拉向同一个终极问题——我们还好吗。\n\n所以你渴求的确定感，本质上是在争取一种心理上的落地感。你真正想确认的不仅是对方的态度，更是彼此的位置：你想知道在今天、明天、下一次争论、甚至遇到风雨时，你们是不是依然站在同一边。说得更深一点，你并不是真的想控制对方，你只是想控制那种让人抓狂的“悬空感”。你不一定害怕冲突，你更怕的是关系突然失去了温度却没有任何解释——那种无法被命名的撤离，对你来说比吵架更像是一种抛弃。看清了这一点，或许你能更理解自己一些。你并不是因为卑微才需要确定感，你只是在努力把亲密关系变成一个可预测、可栖身的避风港。只是你也要记得，你本就值得拥有更稳定的回应，也值得慢慢学会一种更省力、更从容的安心方式，而不是永远靠独自扫雷来确认安全。`,
      reshape: `重塑：把“锚”抛回自己手里\n\n1. 练习事实归因：停止对模糊信号的灾难化解读。\n你习惯的读心术，本质是把不确定自动转化为被否定的负面预判。试着用事实 + 合理假设 替代脑补剧情。当对方沉默时，别想 “TA厌倦我了”，而是告诉自己：“TA现在没说话（事实），可能是工作累了 / 在处理私事（合理假设），和我们的关系无关”。\n\n2. 建立爱的韧性认知：相信关系的稳定性不依赖即时回应。\n你总怕 “不回应 = 爱消失”，但真正的亲密关系，不是时刻在线的热烈，而是哪怕有间隙，也不会断裂的韧性。爱不是持续输出的电流，而是有蓄电功能的电池—— 偶尔的沉默、疏离，只是暂时的能量补给，不是电量耗尽。\n\n3. 构建自我价值支撑体系：把情绪重心从对方身上收回。\n培养独立于关系的快乐来源，关注自我需求的满足。当你自身的 “快乐账户” 足够充盈，就不会再依赖对方的 “情绪转账”。`
    },
    blessing: "愿你在世事浮沉的人间，能遇见一个懂你敏感、护你不安的人。\n\n更愿你修炼出一颗稳稳的内心：最坚实的依靠从不是别人的承诺，而是自己给的底气；最恒久的确定感，也从不是来自外界的安稳，而是源于内心的自洽与从容。"
  },
  "被需要": {
    type: "被需要",
    archetype: "以付出为锚的守护者",
    icon: <Heart className="w-8 h-8" />,
    quote: "没有你，我只是一片废墟。",
    cardStyle: "from-amber-500 to-orange-700 shadow-[0_0_50px_-10px_rgba(245,158,11,0.4)] border-amber-500/30",
    accentColor: "text-amber-700",
    radarColor: "#d97706",
    tabActiveColor: "bg-teal-50 text-orange-800 border-teal-200",
    tabInactiveColor: "bg-white/80 text-orange-800/50",
    themeColor: "bg-amber-600",
    content: {
      base: `在亲密关系里，最能让你感到踏实的瞬间，往往来自那种“被对方托付”的时刻。对你来说，爱不仅仅是口头上的情绪表达，更是一种真实可触碰的连接：你渴望深度参与对方的生活，也希望对方愿意把生命里的一部分重量交到你手里。当你发现自己能帮上忙、被对方无条件信任、被纳入TA最核心的生活半径时，你才会清晰地感知到：我们是真的在一起。\n\n你表达爱的方式总是很务实，甚至带点不动声色的温柔。你会下意识地留意对方的状态和生活里的细碎需求，在问题出现前，就先做好了让对方省心的安排。当对方陷入低谷或遇到麻烦，你会立刻切换到“支持模式”，帮TA理顺乱成一团的杂事，也帮TA安放好无处投递的情绪。这些举动在你看来并不是为了换取回报的筹码，而是你最本能的亲密语言——你习惯通过照顾与承担，把一段虚无的关系打磨得更有质感、更有温度。\n\n正因如此，你对关系中“互相支撑”的信号会格外敏感。比起那种界限分明、各自独立到几乎没有交集的相处模式，你更向往那种彼此需要、相互靠得住的生命形态。对你而言，被对方需要从来不是什么沉重的负担，而是一种被坚定选择、被深度信任的勋章。这种“被需要感”，正是你在亲密关系里最自然、也最坚固的归属感来源。`,
      light: [
        { label: "靠谱的务实支撑力", text: "你是对方生活里最踏实的后盾，从来不会只说漂亮话。比起口头安慰，你更愿意用实打实的行动帮忙，那种 “不管有事没事，我都在” 的态度，能让TA真真切切感受到安全感。" },
        { label: "暖心的情感联结力", text: "你总能通过付出和被依赖，把感情粘得很牢。你特别会察言观色，能捕捉到TA没说出口的需求。这种被看见、被照顾的感觉，会让TA越来越依赖你。" },
        { label: "清醒的互惠平衡感", text: "你不是那种一味付出的傻好人，心里很清楚感情需要你来我往。你愿意为关系兜底，但也盼着对方能看见你的付出，偶尔也回应你的需求。" }
      ],
      shadow: [
        { label: "价值感绑在“被需要”上", text: "你总不自觉把 “TA需不需要我” 和 “我重不重要” 绑在一起。要是TA暂时能自己处理事情，没怎么依赖你，你就容易胡思乱想，甚至悄悄觉得自己没那么有价值了。" },
        { label: "不敢直说“我也想被你需要”", text: "你心里其实很期待TA主动找你帮忙，但又怕说出来会给对方压力，更怕被拒绝。所以你宁愿默默付出，等着对方主动来需要自己，慢慢就变成了失落和委屈。" },
        { label: "过度承担把自己累垮", text: "因为悄悄担心TA累着，也怕TA不再需要自己，你会不自觉把好多活都揽过来。久而久之，付出变成了沉重的负担，你陷入 “越付出越累，越累越怕TA离开” 的循环里。" }
      ],
      partner: [
        "TA 说我来吧，其实是最直接的爱意表达。别随口说不用，在 TA 心里，接受帮助是对 TA 价值的肯定。你越是拒绝，TA 心里越容易悄悄怀疑自己是不是多余的。",
        "主动向 TA 求助，是最珍贵的认可。你不必假装什么都能扛，偶尔说一句搞不定，会让 TA 瞬间感受到被信任、被需要的重量。",
        "TA 的过度照顾，背后藏着怕失去你的不安。当你觉得 TA 做得太多时，别直接反驳。更温柔的方式是抱住 TA，告诉 TA 我知道你心疼我，但你已经很重要了，不用这么拼命。"
      ],
      self: `深度溯源：你用托付与回应来感知爱\n\n从依恋与自我价值调节的角度看，你对被需要的渴望，很多时候并不是单纯地热衷于照顾别人。更像是一套你早已内化的生存逻辑：只要我能提供支持，我就不会被忽略；只要我对你有用，我们的连接就会变得更牢固。于是，你在关系里会本能地切换到“照料者模式”：习惯性地先观察对方的状态，习惯性地补位，习惯性地把烂摊子收拾好。你追求的未必是忙碌本身，而是那种实实在在的、不可替代的存在感。\n\n这种模式的形成，往往和你过往对价值的理解有关。可能是你在成长中习惯了用“懂事”和“解决问题”来换取认可；也可能是你在某段不靠谱的关系里受过伤，才学会了用付出来绑定连接。你可能很早就擅长观察周围的氛围，擅长不让场面崩掉，擅长把别人拉回正轨。久而久之，你的大脑形成了一种思维定式：只要我能稳住你，我就能稳住这段关系。\n\n所以，真正能刺痛你的，往往不是对方犯了错，而是当你伸出手时被推开，或是你的付出被当成了理所当然。特别是当对方宁愿向外人求助，也不愿麻烦你时，那种强烈的“失重感”会让你瞬间陷入自我怀疑：如果我不再提供价值，我在你心里还剩下什么位置？ 你会发现自己陷入了一种矛盾：既想靠近，又怕变得多余。这种委屈的底色，其实是你把安全感全都押在了“被需要”这件事上，一旦对方不接招，你就很难确认自己是否依然重要。\n\n这种模式的代价，就是你一直在“过度承担”。你不知不觉成了关系里的主力修复者，把对方的情绪、生活节奏甚至是人生选择都扛在了自己肩上。你确实很能扛，也真的很可靠，但这份可靠有时会像一层壳，遮住了你内心深处的需求——你同样渴望被心疼、被看见、被好好感谢，只是你更习惯用行动去爱，而不是开口去要。\n\n更深一层看，你渴望的并不是被当作解决方案，而是被当作一个对TA有分量的人。被需要在你这里，往往等同于被优先选择。也因此，接下来的调整，并不是要你变得冷漠或停止付出，而是要把“爱”和“有用”这两件事慢慢分开。你可以继续温柔，但你不必每一次都靠“救场”来证明自己的价值。`,
      reshape: `重塑：把价值从 “付出” 里解放出来\n\n1. 先学会不付出，也敢安心被爱。\n你习惯了用自己能做什么来证明重要性，却忘了关系的核心是彼此需要，而非自己必须有用。每天睡前花两分钟，回想当天自己没付出却依然被惦记、被关心的小事。\n\n2. 坦然说我也需要被照顾，不用硬撑万能者。\n你总怕麻烦别人，习惯了扮演照顾TA人的角色，却忘了核心关系动机里的连结，从来都是双向流动的。你可以试着主动表达自己的需求，不用觉得提要求是自私。\n\n3. 拓展自我价值的边界，不止于被TA人需要。\n根据人际关系理论，一个人的价值感越多元，就越不会在单一关系里过度焦虑。投入工作、深耕爱好，你会发现除了爱情，还有很多人在乎你、需要你。`
    },
    blessing: "愿你遇见这样一个人：TA会珍惜你为TA做的每一件事，也会主动为你分担疲惫；TA会依赖你的照顾，也会把你的需求放在心上。\n\n更愿你慢慢活成自己的底气：不用靠付出换爱，不用靠有用换存在感，哪怕什么都不做，也能坦然相信 “我值得被好好爱着”。"
  },
  "掌控感": {
    type: "掌控感",
    archetype: "为关系掌舵的同行者",
    icon: <Zap className="w-8 h-8" />,
    quote: "我抛开了所有理智，只求你结束我的痛苦。",
    cardStyle: "from-red-800 to-slate-900 shadow-[0_0_50px_-10px_rgba(159,18,57,0.4)] border-rose-900/30",
    accentColor: "text-rose-900",
    radarColor: "#881337",
    tabActiveColor: "bg-slate-100 text-rose-900 border-slate-200",
    tabInactiveColor: "bg-white/80 text-rose-900/50",
    themeColor: "bg-rose-900",
    content: {
      base: `在亲密关系里，你最核心的需求从不是控制对方，更而是希望两个人都拥有共同管理现实的能力。你的亲密底色更像两人共掌舵的船，得提前校准航向、明确规则、同步节奏，所关注的焦点通常落在情境本身：事情发生了，信息要清楚；分歧出现了，路径要明确；局面变复杂了，至少要知道下一步怎么走。\n\n所以当出现临时变动、沟通断点或悬而未决的冲突时，你会更容易进入问题聚焦的处理模式。你会下意识想弄明白原因、影响范围、可选方案，以及谁来做什么、做到什么程度。你不一定喜欢反复纠缠情绪细节，你更在意这件事最终能不能被妥善处理。对你来说，不清不楚会消耗心力；一旦被说清楚、被安排到位，你反而更容易放松下来。\n\n你真正渴望的，是一种深度协作的默契。我们可以有分歧，但必须能谈出共识；可以有情绪，但不能让情绪直接接管决策；甚至可以犯错，但大家得愿意一起复盘，调整以后的相处流程。你最欣赏的特质是“靠谱”与“担当”，是面对现实难题时的不逃避、不甩锅。你追求的掌控感，本质上是一种共同应对的能力——遇到事，我们不是互相消耗，而是并肩把它解决掉。`,
      light: [
        { label: "清晰的关系梳理力", text: "你总能一眼看穿矛盾的关键，不会让误会越积越深。不管是彼此的界限划分、相处节奏的调整，你都擅长把模糊的事说清楚，推动双方找到都认可的方式。" },
        { label: "务实的问题突破力", text: "面对关系里的卡点，你从不会拖着或逃避。你行动力强，更愿意主动想办法、做调整，而不是任由问题发酵。这份不推卸、敢担当的态度，让关系有了方向感与推动力。" },
        { label: "靠谱的关系托底力", text: "和你在一起，对方会觉得特别踏实。你不会让感情停留在 “凑活过” 的状态，会主动规划未来、协调遇到的矛盾，用理性和行动为这段关系兜底。" }
      ],
      shadow: [
        { label: "对无序的极致焦虑", text: "一旦关系脱离预设的轨道 —— 比如对方做事没计划、总回避深入沟通，你会比常人更容易陷入慌乱，觉得整段关系摇摇欲坠。" },
        { label: "独自掌舵的疲惫感", text: "你习惯了做关系里 “把舵的人”，默默扛起梳理节奏、解决问题、规划方向的责任。久而久之，身心俱疲却很难放手，总担心自己一松劲，这段关系就会乱成一团。" },
        { label: "同步期待带来的压力", text: "你对自己要求严格，也会不自觉地期待对方能跟上。当对方跟不上你的步调时，你容易感到失望甚至烦躁，却忘了每个人都有自己的处事节奏。" },
        { label: "理性掩盖下的情绪忽视", text: "你太擅长用逻辑分析问题，以至于自己的委屈、疲惫常常被忽略。你习惯了先处理事情，再照顾情绪，甚至忘了自己也需要被看见。" }
      ],
      partner: [
        "TA更在意的是局面能不能被稳住，而不是谁赢谁输。当 TA主动说想聊聊，只是想和你一起把关系捋顺，拉回彼此都安心的状态，不用各自猜来猜去。",
        "TA需要的是协作感，而不是服从。你可以不同意，也可以有自己的节奏，但请把你的想法讲具体：你在担心什么、你能做到什么、你希望怎么安排。清晰的表达会让TA立刻降压。",
        "当矛盾出现时，TA很容易先切到处理模式，急着把问题落地。你可以温和地让TA慢半拍，先把情绪接住（TA很可能会忽视自身情绪），再一起推进解决；也别把TA的推进误读成强势或否定。更好的方式是先确认感受，再推进处理：我知道你现在很着急，我们先缓两分钟，我在这儿；然后我们把要解决的点列清楚，定一个下一步。"
      ],
      self: `深度溯源：你把清晰当作一种安全感\n\n你对掌控感的需求，往往不是从想掌控别人开始的，而是从你对不确定性的身体反应开始的。对你来说，未知很少是中性的空白，它更像一个警报提示。当遇到信息不全等充满着模糊性的场景时，你的内心会立刻感到急迫，并将注意力立刻拉到当前的未知当中。\n\n更关键的是，这套反应在你长期的生活经验里，已经形成了一个稳固的正反馈。你之所以选择去梳理、去主导，并不是为了占上风，而是因为这套方法确实“管用”——每一次当你重新把事情梳理清晰，那种由于模糊带来的不适感就会明显消失，事情也随之回到了你认为“正确”的轨道上。你的大脑已经记住了这种获得掌控后的轻松感，久而久之，它就成了你应对世界时的默认策略。\n\n同时，你的情绪调节方式也更偏向“行动派”。相比于纯粹的言语安抚，你更信任那些看得见、摸得着的东西：明确的计划、商定好的规则、清晰的分工和确定的时间点。这并不代表你不在乎感受，只是你更习惯于用“处理”来安放感受。只有把混乱整理成结构，把虚无的焦虑转化成切实的行动，你才能重新找回那种踏实的安全感。\n\n因此，所谓的掌控感在你这里，更像是一种自我保护的本领：你用清晰来对抗不确定，用闭环来对抗悬而未决，用协作来对抗那种孤立无援的无助感。而这种方式，在一次次的互动中被反复验证，成了你最坚固的盔甲。你在亲密关系里最看重的，也常常是协作质量。你可以接受彼此有分歧，也可以接受关系有波动，但你唯独很难长时间忍受那种含混、拖延或者没有结论的状态。你真正需要的，是一种高度可靠的同盟感——哪怕天塌下来，我们也能一起把它处理掉，而不是让你一个人被留在那种不清不楚的迷雾里，独自损耗。`,
      reshape: `重塑：允许关系有 “不掌控” 的空间\n\n1. 接纳适度失控，关系不必事事精准。\n不用逼自己抓牢所有细节，偶尔偏离预期不是出错。给关系一点缓冲的余地，也给自己松松紧绷的神经。\n\n2. 放下全能责任，学会把担子分出去。\n你不是关系里唯一的责任人。当你又习惯性想包揽所有事时，试着停一停，把部分责任交出去。学会依赖，学会放手，才是对自己的温柔。\n\n3. 允许自己不懂事，暴露脆弱从来不是软弱。\n你不用永远做那个最清醒、最能扛的人。累到撑不住的时候，不用硬撑着说没事。承认自己的无力，不是软弱，而是敢对自己诚实。`
    },
    blessing: "愿你遇见一个能和你并肩扛事、一起决策的人，不用再让你独自做那个负责全局的“大人”。\n\n往后余生，既有掌舵的底气，也有被照顾的福气，让世界在你稳住别人的同时，也悄悄稳住你。"
  },
  "被偏爱": {
    type: "被偏爱",
    archetype: "渴求例外的驯养者",
    icon: <Sparkles className="w-8 h-8" />,
    quote: "你要永远为你驯服的东西负责。",
    cardStyle: "from-pink-400 to-rose-600 shadow-[0_0_50px_-10px_rgba(244,114,182,0.4)] border-pink-400/30",
    accentColor: "text-pink-600",
    radarColor: "#db2777",
    tabActiveColor: "bg-slate-50 text-pink-700 border-slate-200",
    tabInactiveColor: "bg-white/80 text-pink-700/50",
    themeColor: "bg-pink-500",
    content: {
      base: `在亲密关系里，你最在意的其实并不是单纯的“被喜欢”，而是那种“被偏爱”的特殊感。你始终需要一种明确的信号，来确认自己在对方心里的位置：我不是一个随时可以被替换的选项，也不是你顺带照顾到的某个人。我是那个会被你优先考虑、会被你坚定选择、甚至会在某些关键时刻被你放进“例外”清单里的人。对你来说，这并不是在追求什么矫情的特权，而是一种对关系定位最基本的确认。\n\n你对细节很敏感，因为偏爱常常就藏在细节里。你并不看重礼物有多贵重，或者情话有多甜，你在意的是自己有没有被认真地记住、被用心地对待。你会观察对方是否愿意为你多走那一步，是否在面临取舍时把你放在更重要的天平上，是否在你感到脆弱或被人误解的时候，会第一时间先靠近你、先保护你。这些细微的小动作，直接决定了你对这段关系温度和可靠性的判断。\n\n正因如此，你很难从那种“对所有人都一样”的博爱中获得真正的满足。你并不是要求对方把整个世界都推开，你只是希望这份爱能有清晰的指向性：温柔可以是一种底色，但在面对你时，它必须变得更具体、更坚定。你真正在意的，往往是关键时刻的站位问题——当事情变得复杂、立场开始摇摆时，你是否依然能感觉到对方在坚定地向你靠拢。只要这种偏向是清晰可见的，你反而会变得无比松弛，也更愿意交付出你全部的信任。`,
      light: [
        { label: "深情且坚定的专注度", text: "一旦认定一个人，你会全身心投入，给出稳定又纯粹的爱意回馈。你的爱不是泛泛的好，而是带着 “只对你” 的专属感，让对方能清晰感受到被珍视。" },
        { label: "细腻入微的洞察力", text: "你能捕捉到别人忽略的细节 —— 记得TA随口提的喜好、察觉TA没说出口的情绪。这种 “被真正看见” 的体贴，让关系充满温度。" },
        { label: "用心经营独特联结", text: "你擅长创造属于你们的专属记忆，可能是只有彼此懂的暗号，可能是优先考虑对方的习惯，这些 “别人没有” 的小细节，让关系变得格外深刻动人。" },
        { label: "推动关系真诚深度", text: "你的认真会带动对方更坦诚地对待感情，不敷衍、不模糊，逼着彼此直面内心的需求，让关系在真实的互动里越走越近。" }
      ],
      shadow: [
        { label: "对差别对待的极致敏感", text: "对方对别人多一份耐心、多一句关心、多一次迁就，你心里的天平就会悄悄倾斜。不是小气，是怕自己的 “特别” 被稀释，怕那份独有的偏爱慢慢消失。" },
        { label: "陷入过度求证的内耗", text: "你会忍不住反复琢磨TA的言行，哪怕是一句随口的话，都要从中寻找 “TA到底有没有更在乎我” 的答案，越想越焦虑。" },
        { label: "怕落空的防御性退缩", text: "一旦感觉自己不再特别，你会下意识收回深情。不是冷漠，是怕自己毫无保留地付出，最后只换来和别人一样的待遇。" },
        { label: "小事放大的不安触发", text: "一个敷衍的回应、一次被排在后面的选择，在你眼里都会变成 “我不够重要” 的信号，轻易就触动内心的敏感神经。" }
      ],
      partner: [
        "TA要的从不是更多，而是独一份。不用送昂贵的礼物，但若你记得TA随口提的喜好，或是在众人面前下意识护着TA，这种只对TA有的用心，才是最让TA安心的偏爱。",
        "当TA因为小事受伤时，先别急着纠正和分析。避免用你想太多这类话去压掉TA的感受。先抱抱TA，比讲道理管用得多。",
        "主动表达偏爱是TA的刚需，不是加分项。偶尔说一句你在我心里和别人不一样，在关键节点上主动站位，比事后解释更能消除TA对可替代性的担忧。"
      ],
      self: `深度溯源：看见那个渴望被优先选择的小孩\n\n你对被偏爱的渴望，往往不是想要更多，而是想要更明确。它关乎关系地位的确认：在你这里，我是不是优先的，是不是会被坚定地选择，是不是在关键时刻你会站在我这边。你需要的并不是轰烈的证明，而是一种专属性的信号，让你知道自己不是可替代的，而是被认真放在心上的那一个。\n\n这种心理倾向，通常源于一种内在的认知：爱是会被拿来比较，甚至是被反复权衡的。所以你的雷达会异常敏锐地扫描那些关于“排序”的线索。比如对方对别人表现出同样的温柔、在你面前过度夸赞TA人、在你脆弱时却保持所谓的“中立”、遇到冲突时先忙着讲客观大道理……这些细节在别人眼里或许只是性格使然，但在你这里，它们全是地位下降的信号。你未必是在意那件事本身，你真正在意的是它背后的那个结论：我是不是从你的“例外”，变成了你的“普通”？\n\n这这种心态往往有着很深的源头。它可能来自某些反复形成的经验：比如你发现必须达到某种门槛、表现得足够好、足够出众，才能换来那份明确的偏向；又或者是在后来的感情里，你曾体验过那种微妙的“降温”——对方没有直接抛弃你，却在权衡利弊后把你放在了一个可有可无的位置。久而久之，你把“被偏爱”当成了一种必要的证据：只有确认你对我不一样，我才敢放心地把自己交出去。\n\n于是，你在关系里很容易陷入一种自我保护的循环。你下意识地寻找专属于你的确认来让自己心安，可一旦这种确认变少了，你的不安感就会成倍增长；为了对抗这种不安，你会更迫切地想要一个明确的站位，甚至会忍不住去试探、去比较、去反复确认，以至于有时会被不理解的人贴上“作”的标签。\n\n但如果你能看透这一层，就会明白，渴望偏爱并不等于任性，那是你用来稳住自我价值和定位的一种方式。你真正需要的，并不是让对方对全世界冷漠，而是希望TA对你的爱能更具体、更有边界感：在做选择时先想到你，在起冲突时不把你丢在对立面，在关键时刻给出清晰的“站队”信号。当这种专属性被稳定地给到时，你反而会变得前所未有的松弛，不再需要通过反复证明来确认自己值得被选，而是能安稳地把爱落进平凡的日常里。`,
      reshape: `重塑：先学会自己偏爱自己\n\n1. 接纳敏感，它不是缺点。\n不用骂自己小心眼，你的敏感只是因为太在乎被特别对待。当你因为小事难过时，先对自己说一句我知道你只是怕没被偏爱，这份情绪没有错。\n\n2. 自己先给足自己独一份的宠爱。\n别总等着别人来证明你的特别，你可以先主动偏爱自己：想吃的东西不用等别人买，自己去尝；想做的事不用盼着别人陪，自己去做。你值得被偏爱，这份偏爱不用依赖任何人。\n\n3. 学会直白表达需求，不用猜来猜去。\n不用让对方费力猜测你的想法，直接说出来更省心。清晰的需求才能换来精准的回应，直白表达从来都不是自私，是对自己的负责。`
    },
    blessing: "愿你遇见明目张胆的偏爱，有人把你放在心尖上，让你清清楚楚感受到，自己就是那个不可替代的例外。\n\n更愿你自带自我偏爱的底气，不用依赖别人的特殊对待，也能笃定自己值得所有美好 —— 往后余生，被爱眷顾，更被自己偏爱。"
  },
  "精神共鸣": {
    type: "精神共鸣",
    archetype: "灵魂旷野的寻觅者",
    icon: <Eye className="w-8 h-8" />,
    quote: "我们相遇在精神的旷野，无需言语便已相通。",
    cardStyle: "from-violet-600 to-indigo-900 shadow-[0_0_50px_-10px_rgba(124,58,237,0.4)] border-purple-500/30",
    accentColor: "text-purple-700",
    radarColor: "#9333ea",
    tabActiveColor: "bg-yellow-50 text-purple-900 border-yellow-200",
    tabInactiveColor: "bg-white/80 text-purple-900/50",
    themeColor: "bg-purple-600",
    content: {
      base: `在亲密关系里，你最核心的需求从来不是占有或依赖，甚至不是那些流于表面的日常陪伴，而是一种灵魂层面的同频共振——是你的思想被看见，观点被呼应，内心深处那些无人察觉的褶皱被温柔地抚平。\n\n日常寒暄的温暖固然是关系的养分，却永远替代不了 “你一句话戳中我未说出口的心事” 的心灵碰撞。你对浅层关系有着近乎本能的疏离感，没有精神交流的亲密，对你来说像一个缺了核心的空壳，再热闹也填不满内心的荒芜。你并不要求对方永远和你观点一致，你更在意的是被看见：当你在表达时，你不是在对着空气独白，而是在和一个真实的心智交互。\n\n正因如此，当关系里长期缺少有效的深度交流，你会比别人更容易感到失落。可一旦遇到那个能在思维深处与你同频的人——能听懂你话里的潜台词，能接住你突如其来的奇思妙想，你就会立刻卸下所有的防备，毫无保留地投入其中。对你而言，沉默本身并不一定可怕，可怕的是沉默背后那份彻底的断连；分歧本身也未必是问题，问题是彼此无法理解、无法回应、更无法形成一套共同的语言。你所追求的精神共鸣，本质上是一种意义层面的深度连接：我们不仅仅是在物理空间里一起生活，更是在同一条理解世界的路上，并肩同行。`,
      light: [
        { label: "思想共振的活力感", text: "你带对方的不只是爱情，更是共同成长的可能 —— 你愿意交换观点、讨论本质，也愿意把对方拉进更大的世界里，让亲密不止停在日常琐碎，而是持续向外生长。" },
        { label: "深层共情的理解力", text: "你懂得 “倾听” 的真正意义，不只是听表面的话，更能读懂背后的想法与情绪，让对方真切感受到被理解的安心。你给出的回应往往有针对性，而不是被敷衍安慰。" },
        { label: "持续焕新的新鲜感", text: "和你在一起从不会陷入枯燥重复，思维的碰撞、观点的交流，总能为关系注入新灵感，永远有聊不完的话题。" },
        { label: "理性与感性的平衡感", text: "你既擅长深度思考，也能传递细腻的情绪支持，你不会把关系困在聊得来这种单一维度，而是能同时提供理解、温度与精神上的靠近。" }
      ],
      shadow: [
        { label: "浅层关系的低耐受度", text: "如果一段关系长期只停留在 “吃了没”“在干嘛” 的琐事寒暄，没有深入的思想交流，你会慢慢失去存在感，想要抽离。" },
        { label: "将“不理解”等同于“不在意”", text: "对方未必不爱你，只是没能跟上你的思维深度，但这种 “聊不到一块” 的距离，在你心里会被放大成 “你不懂我，也不在乎我”。" },
        { label: "精神错位的高敏感度", text: "一旦对方的观点、节奏、对世界的态度不再与你同频，你对这段关系的期待会迅速下降，很难再找回最初的热情。" },
        { label: "忽略日常幸福的价值", text: "有时候你太执着于灵魂契合，反而会忽视相处中的小温暖 —— 比如默默的陪伴、笨拙的关心，这些普通的幸福其实也能滋养关系。" }
      ],
      partner: [
        "TA在意的不是你会不会聊天，而是你愿不愿意进入TA的世界。比起频繁问候，更有效的是给有内容的回应：复述你听到的重点、说出你的理解、再补一个你自己的观点或提问。让TA感到你在认真接住。",
        "当TA和你聊起那些好似“无用”的话题时，不是为了争辩，而是悄悄递来靠近的信号。那些抽象的探讨，本质上是 TA想看看：你愿不愿意放下琐碎，在精神上陪 TA一会儿。",
        "你不用懂多少深奥理论，也不用读遍天下书，但请别关闭对内心和世界的探索欲。TA从来没要求你成为思想家，只是希望你别用 “想那么多干嘛” 敷衍 TA的认真。",
        "如果你暂时接不住，也可以直接说明状态并约时间：我现在脑子有点乱，但我很想听你说。我们晚饭后/睡前留二十分钟认真聊。对TA来说，约定的深度交流比即时但敷衍的回应更重要。"
      ],
      self: `深度溯源：你把被理解当作亲密的入口\n\n对你来说，衡量一段关系亲疏的单位，从来不是相处的时长，而是彼此理解的深度。你其实并不追求时刻的黏腻，也不怎么依赖刻意的仪式感，但你唯独没法在一种“错位”的关系里待太久。最让你感到疲惫的，往往不是沉默，而是那种擦肩而过式的交流：你说了很多，对方回得也快，可核心的意思总是对不上焦。你想深挖背后的原因，TA却只给你一个定论；你在坦露当下的感受，TA在忙着给建议；你抛出一个困惑想找人探讨，TA却把它当成随口吐槽，笑笑就略过了。这种看似热络的互动，其实最消耗人——面子上风平浪静，心里却越来越空。\n\n这里面有个很关键的机制：你有一个很特别的习惯：你习惯通过“被理解”来完成自我的情绪消解。你表达的时候，往往不只是在宣泄心情，你可能在梳理一个还没定型的想法，或者一段还没理顺的感受。你需要的不是一个答案，而是一个能跟上你思路的对手。如果对方能精准地捕捉到你在意的点，哪怕TA不完全认同，只要TA能接住你没说完的那半句话，或者给出一个言之有物的回应，你整个人就会立刻松弛下来。心理学上把这叫作“同调”：对方不仅仅是在听你说话，而是真的进入了你的内心世界，去感知那个活生生的你，而不是只处理你发出的文字。这种安全感是无可替代的——因为在TA面前，你不需要反复解释，也不必把自己修剪得足够简单才会被接纳。\n\n所以你对浅层互动的低耐受，并不是挑剔，而是你对误读很敏感。你会很快分辨出两种回应：一种听起来很热情，却总在偏题；另一种话未必多，但每一句都能稳稳地落在你心里那个点上。前者会让你觉得心累，因为你必须不断地去纠正、去补充、去翻译，还要压抑住那种“TA还是不懂我”的失落。而只有后者，才会让你觉得正在被认真对待——因为你们在用同一套语言，去处理同一个层面的问题。\n\n如果这种精神上的共鸣长期缺席，你通常不会选择大吵大闹，而是会表现出一种“无声的收缩”。你会先把那些复杂的心思收回来，再把敏感的情绪藏起来，最后把原本深入的表达退回到最安全的表层。在外人眼里，你只是变冷淡了、话少了，可实际上，你只是在节省心力。你在心里默默地做出了判断：既然被理解是一种奢侈，那就没必要把最真实、最贵重的那个自己，反复拿出来被辜负。 你想要的共鸣，说到底其实只有一件事——当我把真实的自我交付出去时，它能被准确地接住，而非任由它坠落。`,
      reshape: `重塑：允许自己的灵魂 “多元栖息”\n\n1. 接纳你的深度需求，它从不是缺点。\n你天生自带对深度连接的敏感，这份对意义、对共鸣、对思想碰撞的渴望，是你最独特的珍贵特质。\n\n2. 不把所有期待，都压在一个人身上。\n如果伴侣暂时跟不上你的思维节奏，不用焦虑。那些关于人生、理想、世界的深度思考，完全可以分给志同道合的朋友、书籍或创作。\n\n3. 学会在普通日子里，发现藏着的连接。\n试着放慢追逐 “灵魂契合” 的脚步，多留意日常相处里的小默契。这些看似浅层的互动，其实都在悄悄拉近距离。`
    },
    blessing: "愿你这一生，既能遇见共享柴米油盐的人，也能遇见共赴精神旷野的伙伴。\n\n也愿你在无人完全懂你的时刻，依然坚信：你的思考、你的独特，本身就是最珍贵的礼物，无需向谁证明。"
  },
  "自主权": {
    type: "自主权",
    archetype: "守望星空的风之子",
    icon: <Wind className="w-8 h-8" />,
    quote: "我爱你，却不愿用爱束缚你。",
    cardStyle: "from-sky-400 to-blue-600 shadow-[0_0_50px_-10px_rgba(14,165,233,0.4)] border-sky-300/30",
    accentColor: "text-sky-600",
    radarColor: "#0284c7",
    tabActiveColor: "bg-white text-sky-600 border-sky-100",
    tabInactiveColor: "bg-white/60 text-sky-800/50",
    themeColor: "bg-sky-500",
    content: {
      base: `在亲密关系里，你最核心的需求从不是占有或依赖，而是“在爱里守住自我” 的自由——你并不抗拒亲密，你抗拒的是被亲密吞没。你希望爱发生在两个各自完整的人之间，而不是把彼此变成彼此的附属。靠近对你不难，难的是靠近之后仍然能按自己的节奏呼吸。\n\n你愿意投入，也愿意分享，但你需要留出一块只属于自己的空间：不一定是物理距离，更像是选择权。你可以解释，但不喜欢被审问；你可以回应，但不想被实时追踪；你愿意照顾对方的感受，但不希望用持续迎合来换取和平。当这份边界被理解，你反而更松弛，爱也更稳定。相反，一旦对方频繁追问、要求报备、替你做决定，你的系统会立刻收缩，想退一步，不是因为你不爱了，而是因为你在保护自我不被覆盖。\n\n所以你理想的亲密，是连接而不捆绑。你希望彼此有各自的生活、兴趣和社交，也希望对方能理解你需要独处、沉默、整理自己的时刻。对你而言，自主权不是冷淡，它是一段关系能走远的前提：当你被允许做自己，你才更愿意长期地留在爱里。`,
      light: [
        { label: "让人舒展的松弛感", text: "你从不会要求对方 “秒回消息”“事事报备”，也不会干涉TA的社交圈、兴趣爱好，让对方觉得和你在一起不用紧绷，能安心做自己。" },
        { label: "清晰坚定的边界感", text: "你懂得尊重自己的空间，也从不越界干涉别人的选择，不会用 “爱” 为名绑架对方的生活，这种分寸感让关系始终保持舒展。" },
        { label: "自我负责的情绪力", text: "你很少把所有情绪都丢给对方消化，遇到压力、困惑时，更习惯自己先梳理、自己承担，不会过度依赖对方的安慰。" },
        { label: "轻盈不沉重的爱意", text: "你不喜欢戏剧化的争吵、黏腻的捆绑，也不会提过度苛刻的要求，你的爱像春风一样自然 —— 不用刻意维系，却能让彼此在自在的氛围里感受到温暖。" }
      ],
      shadow: [
        { label: "对“过度靠近”的本能抗拒", text: "只要对方表现出过度依赖、频繁追问、或是试图掌控你的节奏，哪怕没有恶意，你也会下意识想后退，容易让对方误以为你 “不够爱”。" },
        { label: "习惯“独自消化”的封闭性", text: "你太擅长自己处理情绪和问题，常常忘了对方也希望参与你的世界 ——哪怕只是听你吐槽、陪你分担，你也会下意识说 “没事”。" },
        { label: "对“束缚”的过度预判", text: "只要稍微感受到一点被期待、被要求的压力，你就会立刻警觉，甚至提前撤退，把 “可能被束缚” 的预判当成事实。" },
        { label: "“清淡表达”的误解风险", text: "你在意一个人时，表达方式也不会太浓烈。这种清淡的态度，很容易让对方感受不到你的在意，陷入 “TA到底爱不爱我” 的猜疑。" }
      ],
      partner: [
        "TA需要独处，不是疏远。TA从不是不爱你，而是只有把自己的情绪和节奏整理好，才能更好地爱你。你可以表达想念，但尽量不要用追问、查岗、立刻回我来制造压力，给TA一点自己掌控节奏的余地。",
        "把关心做成邀请，而不是要求。比如你愿意跟我说就说，不想说也没关系；我想你了，你有空再回我。越是让TA有选择权，TA越会主动分享。",
        "避免替TA做决定或用为你好来推动改变。更有效的是把你的需求说清楚，然后一起协商：我会担心，是因为___；我希望我们可以___。让TA参与制定规则，而不是被动接受规则。"
      ],
      self: `深度溯源：你把选择权当作安全感\n\n你对自主权的需求，常常不是对亲密没兴趣，而是你对被干预的信号很敏感。对你来说，安全感很大一部分来自我还能决定。决定我什么时候靠近，什么时候安静一下，什么话想说，什么暂时不说。自主权一旦被拿走，你的身体会先反应，哪怕你理性上知道对方是在关心，你也会本能地紧起来。\n\n很多时候，你不是怕爱，而是怕爱变成一种管理。那种感觉很具体：你的时间被默认占用，你的行程需要解释，你的边界被当作不够爱；你刚想独处，对方就追问是不是生气了；你表达不同意见，却被当成在反抗。甚至连关心都可能带着一种隐形的方向感，好像你应该按对方觉得对的方式生活。久了你会形成一个非常清晰的内在规则：只要我的空间被尊重，我就能很亲密；一旦空间被侵入，我就会先退一步，把自己捞回来。\n\n从心理学机制看，这里常常有两股力量在一起工作。第一股叫反抗心理。人一旦感觉到自由被收窄，就会本能地想把空间夺回来，哪怕原本愿意配合。第二股来自自我决定理论里的自主需要。你更依赖自主来维持能量与自我一致性。你需要按自己的节奏调节注意力、情绪、社交浓度。自主权对你不是态度，是你维持稳定的底层条件。这也解释了你在关系里很容易对某些行为敏感。查岗式关心、替你做决定、要求实时回应、用爱当理由来干预你的时间和边界，这些动作本身不一定多严重，但它们传递的信号很明确：你宁愿少一点亲密，也不愿意在关系里慢慢失去自己。\n\n更有意思的是，你的亲密常常是被尊重唤醒的。越是被允许保留空间，你越愿意主动靠近，愿意更真诚、更稳定地投入。所以你的核心渴望其实很清晰：在爱里仍然是一个完整的人。你想要的不是没有牵挂的自由，而是可以选择的亲密。你希望对方爱的是原本的你，而不是被调教之后更方便相处的版本。对你来说，最深的安全感来自一句很朴素的体验：我留在这里，是因为我愿意。`,
      reshape: `重塑：在自由与亲密间找到平衡\n\n1. 接纳你的边界需求，它从不是冷漠。\n你对自由和边界的珍视，是保护真实自我的重要特质，从来不是缺点。你值得被爱，更值得被尊重本来的节奏。\n\n2. 温柔划定边界，不用刻意推开别人。\n不用等对方越界了才仓促后退，不如在关系里主动说清自己的节奏。清晰的边界从不是推开别人，而是给彼此一份安心的约定。\n\n3. 试着适度敞开，不用一直独自硬扛。\n你可以保留自己消化情绪的习惯，但不用逼自己把所有心事都藏在心里。适度的敞开不是失去自由，而是让对方知道：你不是不想靠近，只是需要一点时间整理自己。`
    },
    blessing: "愿你始终保有做自己的勇气和节奏，不用为了爱妥协，不用为了自由假装冷漠。\n\n往后余生，你既是自由的风，也能拥有安稳的岸，在爱里自在呼吸，在自我里闪闪发光。"
  },
  "安全距离": {
    type: "安全距离",
    archetype: "迷雾中的试探者",
    icon: <Shield className="w-8 h-8" />,
    quote: "待人如执烛，太近灼手，太远暗生。",
    cardStyle: "from-emerald-600 to-teal-800 shadow-[0_0_50px_-10px_rgba(5,150,105,0.4)] border-emerald-600/30",
    accentColor: "text-emerald-700",
    radarColor: "#059669",
    tabActiveColor: "bg-orange-50 text-emerald-800 border-orange-100",
    tabInactiveColor: "bg-white/80 text-emerald-800/50",
    themeColor: "bg-emerald-700",
    content: {
      base: `在亲密关系里，你最核心的需求从来不是那种轰轰烈烈的双向奔赴，而是一种“安全第一”的踏实靠近。你其实既不是冷淡，也不是所谓的慢热，只是心里自带了一层“安全缓冲带”。就像走进一间陌生的房间，你总会下意识地先看清门有没有锁、灯亮不亮、出口在哪——只有在确认环境是无害的之后，你才会更自然地卸下防备，向对方走近。\n\n你的亲密节奏始终带着一种审慎的克制。你习惯先观察一个人如何处理边界，如何对待负面情绪，以及如何在冲突中开口说话。你在意的从来不是最初的热度，而是长久的稳定性。那些过快的推进、过密的追问，或者是过强的情绪拉扯，都会让你本能地想往后撤一步。这并不是你在推开对方，而是你在保护自己，不让自己被迫进入一个还没准备好的深度。对你来说，信任不是凭空产生的，而是需要时间一点点“养”出来的。\n\n正因如此，你更适合那种懂分寸、能给足你空间的人。对方不需要时刻向你证明爱，但一定要尊重你的节奏：你愿意分享，但希望是自发地打开心扉；你渴望亲密，但非常不喜欢被逼着给关系“升级”。当这种微妙的安全距离被守住时，你反而会表现得越来越放松，也越来越稳定。你对关系的态度通常是宁缺毋滥——在确定对方值得之前，你会保持足够的谨慎；可一旦真的认定了，你就会比谁都要认真。`,
      light: [
        { label: "慎重长情的定心丸", text: "你不会轻易开始一段关系，但一旦确认，就会把人放进心里认真对待。你的投入更像长期型的可靠，不急着许诺，却更愿意用持续的行动维持联结。" },
        { label: "亲疏有度的平衡感", text: "既不会黏腻到让人窒息，也不会疏远到让人不安，总能精准拿捏 “刚刚好” 的距离，让彼此在亲密中保留独立，在独立中感知联结。" },
        { label: "克制稳健的情绪力", text: "你不太会把情绪随手丢给对方，也较少在冲动时做伤害性的决定。你更倾向于先缓一缓、想清楚，再表达和处理，让关系不被情绪的浪头带跑。" },
        { label: "张弛有道的分寸感", text: "和你相处通常不需要时刻迎合，也不必担心被突然拉扯。你能提供一种不逼迫、不侵入的舒适尺度，让人更容易放下防备，关系也更容易走长久。" }
      ],
      shadow: [
        { label: "节奏错位的孤独感", text: "你的 “慢试探” 总与TA人的 “快节奏” 错位，不是不愿靠近，而是很少有人能读懂你需要时间确认的谨慎。" },
        { label: "被催后的防御性退缩", text: "只要对方急于推进关系、用力催促，哪怕没有恶意，你也会下意识后退自保。可对方往往把这份退缩当成“没兴趣”，误会层层叠加。" },
        { label: "观察期的无限内耗", text: "总想着 “再确认一次”“再等等看”，越观察越不敢迈出关键一步，把关系困在原地。" },
        { label: "情绪表达的信息断层", text: "习惯把想法、担忧、需求都藏在心里，从不轻易外露。对方猜不透你在想什么，也不知道该如何靠近，久而久之便会感到疲惫。" }
      ],
      partner: [
        "TA的慢，从来不是没感觉，是怕真心错付才不敢太快。如果你催得太急、推得太猛，只会触发我的自我保护。你看到的 “慢半拍”，其实是我在认真掂量、想把关系走稳。",
        "TA很难在带着冲动的氛围里说心里话。如果你能先放下评判，不着急反驳、不随便贴标签，我反而会慢慢卸下防备，把藏在心里的话都告诉你。",
        "一直都靠谱的踏实感，比一次性的盛大浪漫更重要。你其实不需要费尽心思去讨好，只要能维持一份稳定的可靠，让TA真切地感受到“你一直都在”，TA才敢真正卸下心里所有的防备，一步步向你靠近。"
      ],
      self: `深度溯源：你把边界当作亲密的前提\n\n你之所以在亲密关系里强调安全距离，往往不是因为你不想要爱，而是因为你比别人更清楚“靠近”的代价。对你来说，亲密并不全是甜蜜的收益，它往往伴随着被追问、被解读、被要求立刻表态的风险，甚至被迫在情绪还没沉淀好时就得把自己彻底摊开。于是，你本能地把“距离”当成了一个调节阀——只有先把强度降到你能承受的范围内，你才能保持清醒，也才能有余力继续留在关系里。\n\n更深层的原因，通常和你过往的边界经验有关。你可能很早就领教过那种让人窒息的靠近方式：对方走进你，不是为了理解你，而是为了管理你、定义你。关心变成了盘问，想念变成了查岗，所有的担心最终都指向了干预。当你试图表达不适，对方甚至会替你定义感受，说你“想太多”或者“太敏感”。久而久之，你学会了一套很现实的生存规则：保持一点距离，反而更安全。这种后撤不是为了推开对方，而是为了保住那个不被覆盖的自我。\n\n还有一条更隐蔽的线索，是你对“自我暴露”的风险评估极高。你并不是不愿意坦诚，而是你太清楚，坦诚一旦落到不合适的人手里，会变成指责你的把柄，或者误解你的素材。你说出脆弱，对方却急着纠正你；你说出需求，对方却觉得你在施压。于是，你学会了把表达拆成一个个“小份”，像试金石一样投石问路。接得住，你就多说一点；接不住，你就立刻收回来。这种“慢”，从来不是矫情，而是一种极其精准的自我保护。\n\n对你来说，安全距离还有一个核心功能：维持你的情绪窗口。那些突如其来的冲突、步步紧逼的询问、强行升级关系的压力，都会让你的情绪强度瞬间爆表。为了不让系统崩溃，你会选择“关机式降温”——先撤退、先沉默、先独处。外人常把这看作是冷暴力或回避，但对你而言，那是在避免失控，是在给自己争取整理思绪的时间。等回到了稳定的状态，你反而能给出更真实、更有温度的回应。\n\n所以，你一直在筛选的，从来不是“爱不爱”这种抽象的大问题，而是一种具体的能力：对方能不能在你退后时不去“追杀”，在你沉默时不搞“逼供”，在你表达时不忙着“反扑”。你要确认的，是亲密与尊重能不能共存。只要这个前提被反复验证是安全的，你其实会越开越大方，越靠越稳定。你从来不是不想靠近，你只是在找一种不会让自己受伤的、体面的靠近方式。`,
      reshape: `重塑：允许自己慢慢靠近，慢慢相信\n\n1. 接纳自己的节奏，不用自责太冷。\n你的慢，是对关系的认真，是对自己的保护，从来不是缺点。你有权利按自己的方式靠近想要的关系。\n\n2. 试着小步敞开心扉，不用一步到位。\n不用逼自己立刻全盘托出。可以从分享细微的情绪、简单的想法开始。一点点打开自己，既不会让你感到压力，也能让对方慢慢读懂你的心意。\n\n3. 直白说出你的需要，不用让对方猜。\n不用让对方一直揣摩你的想法，温柔地把需求说清楚就好。清晰的表达从来不是矫情，而是减少误会的钥匙。`
    },
    blessing: "愿你遇见这样一个人：不催你交卷，不逼你前行，愿意陪着你慢慢来。\n\n更愿你往后的亲密、友情与合作里，不再被贴冷漠的标签。也愿你有一天，能在真正安全的关系里，轻轻告诉自己：这次，我可以试着比从前再靠近那么一点点。"
  },
  "秩序感": {
    type: "秩序感",
    archetype: "构建未来的建筑师",
    icon: <Grid className="w-8 h-8" />,
    quote: "于无常中建立坐标，在逻辑里供奉温柔。",
    cardStyle: "from-slate-700 to-gray-900 shadow-[0_0_50px_-10px_rgba(51,65,85,0.4)] border-slate-600/30",
    accentColor: "text-slate-700",
    radarColor: "#475569",
    tabActiveColor: "bg-white text-slate-800 border-gray-300",
    tabInactiveColor: "bg-white/70 text-slate-600/50",
    themeColor: "bg-slate-700",
    content: {
      base: `在亲密关系里，你最核心的需求是秩序感。你不一定需要日子多精彩，但你很在意相处有没有稳定的规则和一致的标准。你会通过那些可预期的习惯、清晰的规则、以及对等的责任感来确认安心。浪漫固然是加分项，但对你来说，“靠谱”才是底色。你在意的往往是这些实实在在的细节：说出口的承诺能不能兑现，计划有变动能不能提前有个交代，遇到分歧时，大家手头是否有一套共同认可的处理方式。\n\n如果标准忽高忽低、安排总是临时起意、问题全靠情绪掩盖过去，会让你迅速感到疲惫。因为对你而言，这些不只是琐事，它们会带来巨大的隐形成本：你的时间被浪费，精力被无谓地消耗，甚至连内心的公平感也会被稀释。你会因此感到迷茫，不知道到底该按什么逻辑去和对方相处。你打心底里不相信那种“随缘式”的相处能走得远，你认定了长期关系的根基，必须扎在坦诚沟通和明确共识的土壤里。\n\n因此，你理想中的亲密更像一个清晰的共同体：我们不是只靠虚无缥缈的情绪撑着过日子，而是靠着共识和契约感在深度协作。你会由衷地欣赏那种守信、守时、说到做到的人，也愿意和对方一起，把生活搭建成一个更省力、更高效的系统。对你而言，稳定从来不等于无趣，它更像是一种坚实的底色——只有让关系不再靠运气来运行，爱才更有机会在漫长的岁月里，长久地生根发芽。`,
      light: [
        { label: "规则清晰的共识力", text: "你擅长把模糊的期待说清楚，把容易扯皮的地方提前对齐，让相处有章可循，减少反复消耗。" },
        { label: "承诺落地的兑现力", text: "你更在乎说到做到。答应的事会记得、会推进、会收尾，这种一致性会让关系变得更可依赖。" },
        { label: "对等公平的边界感", text: "你天然关注责任是否对等、标准是否一致。你不一定强势，但你很难接受双标和随意，这让关系更不容易失衡。" },
        { label: "长期运行的建设力", text: "你愿意把爱放进日常：节奏、分工、规划、习惯的磨合。你提供的是一种能长期过下去的稳定底盘。" }
      ],
      shadow: [
        { label: "对模糊状态零容忍", text: "同一件事今天一个说法明天一个说法，或临时变更却没交代，容易让你迅速不舒服，因为这会动摇你对关系可靠性的判断。" },
        { label: "容易把偏好升级成规则", text: "当你很在意秩序时，某些生活偏好可能会被你当成应当如此，结果对方会感到被要求，你也会觉得对方不配合。" },
        { label: "重秩序易轻共情流动", text: "你倾向尽快把问题说清、定规则、做决定。但对方有时先需要被安抚和消化，若直接进入复盘模式，容易让人感到情绪被跳过。" },
        { label: "对回避沟通者易失耐心", text: "你的要求其实很简单，只是希望对方愿意坐下来坦诚聊聊，但这在很多关系里难实现，久而久之便会因反复消耗失去耐心。" }
      ],
      partner: [
        "对TA来说，坦诚本身就是最踏实的爱。愿意和TA一起商量相处规则、分工和彼此的期待，对TA来说就是被尊重、被当成平等伙伴的最好证明。",
        "长时间的模糊状态，会慢慢耗光TA对关系的安全感。如果你总用顺其自然、先这样吧回避聊关系本身，TA只会越来越焦虑。",
        "当TA提议我们坐下来好好聊聊，请一定认真对待。TA不是要审判谁，只是想把误会捋清、把委屈讲开。你如果愿意和TA一起面对，TA对这段关系的信心会成倍增加。"
      ],
      self: `深度溯源：你把爱结构化来获取安全感\n\n你对秩序感的需要，常常不是因为你爱较真，而是因为你很早就看清了一件事：关系能不能走远，很多时候不取决于情绪有多浓，而取决于相处方式是否稳定。标准是否一致，边界是否清楚，承诺是否算数，这些在你这里不是挑剔，也不是生活洁癖，而是一种保持基本尊严感的方式。它让你知道自己不是靠忍耐在硬撑关系，也不是靠运气在赌对方的状态。\n\n这种需求通常不是凭空产生的，它更像是在长期的生活经验里打磨出来的偏好。在经历过一些起伏后，你形成了一个深刻的结论：当一段关系的评价标准忽高忽低、说法前后不一、责任边界模糊时，最先崩塌的往往不是某件具体的小事，而是彼此间的信任与公平感。你比很多人都更敏锐地意识到，模糊最容易滋生“双标”，随意最容易让责任流失，而最后被迫去承受所有后果、去兜底的那个人，往往是那个更讲道理、更重感情的人。\n\n还有一个更底层的机制是，你会用结构来安放不确定。清晰本身就是一种最高级的心理调节。把话说到位，把标准定下来，把边界讲明白，你整个人才会明显地松弛下来。因为这意味着未来的走向是可预期的，分歧是有章可循的，风险也是可以被提前看见的。所以，你真正追求的秩序，并不是要把生活变成死板的条条框框，而是想建立一种可依赖的合作模式：承诺要兑现，变更有交代，问题有收尾，规则对双方都算数。有秩序的爱，你反而更愿意卸下防备，把那颗紧绷的心放回肚子里，去全神贯注地感受爱本身。`,
      reshape: `重塑：把秩序变成可呼吸的框架\n\n1. 把你的“在意”，翻译成具体的标准。\n别让那些关于秩序的需求，变成你心里默默进行的隐形扣分。你可以大大方方地把标准讲清楚：哪些事必须提前商量，哪些事可以随性改动，改了之后该如何补偿。当规则从“潜台词”变成明面上的共识，对方才有了努力的方向，而你也就不必再独自承担那份“等对方领悟”的疲惫。\n\n2. 厘清原则、规则与偏好的界限。\n不是所有不顺眼都要立刻纠正。把守信、公平感放在不可撼动的“原则层”；把分工和生活节奏放在可以商量的“规则层”；而那些琐碎的个人习惯，则留给互不干涉的“偏好层”。当偏好被允许存在差异时，你所追求的秩序才不会变成一种令人窒息的压迫，而是一种良性的保护。\n\n3. 允许合理的的变动，但要求有交代和收尾\n你真正受不了的往往不是变化，而是变化之后没有解释、没有补救、甚至没有下一次的改进。试着给关系建立一个简单的“应急流程”：说明原因、给出替代方案、约定最终的收尾方式。这种有来有回的处理方式，既能给生活留出必要的弹性，也能让你在变化中依然能感受到那份沉甸甸的可信度。`
    },
    blessing: "愿你遇见这样的同行者：不回避问题，不敷衍沟通，愿意把问题说清，把分歧谈透，和你一起把日子过得有条理、有着落。让秩序不再是负担，而是彼此安心的底气。\n\n也愿你始终懂得：你那份对清晰的追求、对原则的守候，以及从不肯随波逐流的坚持，从来不是什么苛求，而是你送给这段关系最珍贵的礼物。"
  }
};

// 雷达图的维度
const ALL_DIMENSIONS = ["确定感", "被需要", "掌控感", "被偏爱", "精神共鸣", "自主权", "安全距离", "秩序感"];

// 结果页 Tab 配置
const RESULT_TABS = [
  { id: 'base', label: '亲密底色' },
  { id: 'light_shadow', label: '光影图谱' },
  { id: 'partner', label: '给爱人' },
  { id: 'self', label: '爱自己' },
  { id: 'reshape', label: '重塑' },
];

export default function SoulScan_StainedGlass() {
  const [step, setStep] = useState('landing');
  const [showInput, setShowInput] = useState(false);
  const [code, setCode] = useState('');
  const [errorMsg, setErrorMsg] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  
  const [currentQIndex, setCurrentQIndex] = useState(0);
  const [answers, setAnswers] = useState({}); 
  const [results, setResults] = useState({ primary: null });
  const [currentPart, setCurrentPart] = useState(null);
  const [showPartModal, setShowPartModal] = useState(false);
  
  // 动画状态
  const [cardState, setCardState] = useState('idle'); 
  const [showFinal, setShowFinal] = useState(false);
  const [chartData, setChartData] = useState([]);
  const [activeTab, setActiveTab] = useState('base');
  
  // 滚动容器 Ref
  const scrollContainerRef = useRef(null);

  // --- 1. 登录交互 ---
  const handleVerify = async () => {
    setErrorMsg('');
    const inputCode = code.trim();

    if (!inputCode) {
      setErrorMsg('请输入兑换码，不能为空');
      return;
    }

    setIsLoading(true);

    try {
      const { data, error } = await supabase
        .from('codes')
        .select('*')
        .eq('code', inputCode)
        .single();

      if (error || !data) {
        throw new Error('未找到该兑换码');
      }

      if (data.used_count >= data.max_uses) {
        throw new Error('该兑换码已被使用，请购买新码');
      }

      const { error: updateError } = await supabase
        .from('codes')
        .update({ used_count: data.used_count + 1 })
        .eq('code', inputCode);

      if (updateError) {
        throw new Error('系统繁忙，请重试');
      }
      
      setIsLoading(false);
      handlePartTransition(0);

    } catch (err) {
      console.error(err);
      setIsLoading(false);
      setErrorMsg(err.message || '兑换码无效或已被使用');
    }
  };

  const handlePartTransition = (index) => {
    const part = PARTS_CONFIG.find(p => index >= p.startIndex && index <= p.endIndex);
    const isPartStart = part && index === part.startIndex;
    
    if (isPartStart) {
      setCurrentPart(part);
      setStep('partIntro');
    } else {
      setStep('quiz');
    }
  };

  const handleSelectOption = (type) => {
    setAnswers(prev => ({
      ...prev,
      [currentQIndex]: type
    }));
  };

  const handleNext = () => {
    if (!answers[currentQIndex]) return;

    const currentPartConfig = PARTS_CONFIG.find(p => currentQIndex >= p.startIndex && currentQIndex <= p.endIndex);
    const isEndOfPart = currentPartConfig && currentQIndex === currentPartConfig.endIndex;

    if (isEndOfPart) {
      setShowPartModal(true); 
    } else {
      const nextIndex = currentQIndex + 1;
      setCurrentQIndex(nextIndex);
      if (scrollContainerRef.current) {
        scrollContainerRef.current.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }
  };

  const confirmNextPart = () => {
    setShowPartModal(false);
    const nextIndex = currentQIndex + 1;
    
    if (nextIndex < QUESTIONS.length) {
      setCurrentQIndex(nextIndex);
      handlePartTransition(nextIndex); 
      if (scrollContainerRef.current) {
        scrollContainerRef.current.scrollTo({ top: 0, behavior: 'smooth' });
      }
    } else {
      finishQuiz();
    }
  };

  const handlePrev = () => {
    const currentPartConfig = PARTS_CONFIG.find(p => currentQIndex >= p.startIndex && currentQIndex <= p.endIndex);
    if (currentPartConfig && currentQIndex > currentPartConfig.startIndex) {
      setCurrentQIndex(currentQIndex - 1);
    }
  };

  const finishQuiz = () => {
    setStep('analyzing');
    
    const finalScores = {};
    Object.values(answers).forEach(type => {
      finalScores[type] = (finalScores[type] || 0) + 1;
    });

    const sortedScores = Object.entries(finalScores).sort((a, b) => b[1] - a[1]);
    const primaryKey = sortedScores[0][0];

    const radarData = ALL_DIMENSIONS.map(type => ({
      subject: type,
      A: finalScores[type] || 0,
      fullMark: 8
    }));

    setTimeout(() => {
      setResults({ primary: primaryKey });
      setChartData(radarData);
      setStep('result_card');
    }, 2500);
  };

  const handleCardClick = () => {
    if (cardState !== 'idle') return;
    
    setCardState('flipped');
    
    setTimeout(() => {
       setCardState('pausing');
       
       setTimeout(() => {
         setCardState('shaking');
         if (typeof navigator !== 'undefined' && navigator.vibrate) {
             navigator.vibrate([50, 50, 100, 50, 200, 100, 500]);
         }

         setTimeout(() => {
            setCardState('exploding');
            
            setTimeout(() => {
                setShowFinal(true);
                if (scrollContainerRef.current) {
                    scrollContainerRef.current.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }, 800);
         }, 1200); 

       }, 2000);
    }, 1000);
  };

  const progress = ((currentQIndex + 1) / QUESTIONS.length) * 100;
  const displayData = RESULTS[results.primary];
  const currentPartConfig = PARTS_CONFIG.find(p => currentQIndex >= p.startIndex && currentQIndex <= p.endIndex);
  const isPartFirstQuestion = currentPartConfig && currentQIndex === currentPartConfig.startIndex;

  return (
    <div className="h-[100dvh] flex flex-col bg-[#FDFBF9] text-[#4A4A4A] font-sans selection:bg-rose-100 overflow-hidden">
      
      <Head>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet" />
      </Head>

      {/* 顶部栏 */}
      {step !== 'landing' && step !== 'partIntro' && !showFinal && (
        <nav className="flex-none w-full bg-white/80 backdrop-blur-md z-50 border-b border-stone-100 px-6 py-4 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <Sparkles className="w-4 h-4 text-rose-400" />
            <span className="font-serif font-bold tracking-widest text-stone-800 text-xs">SOUL SCAN</span>
          </div>
          {step === 'quiz' && (
            <span className="text-[10px] font-mono text-stone-400 bg-stone-100 px-2 py-1 rounded">
              {currentQIndex + 1} / {QUESTIONS.length}
            </span>
          )}
        </nav>
      )}

      {/* --- Main Content Area (Scrollable) --- */}
      <main ref={scrollContainerRef} className="flex-1 overflow-y-auto relative scroll-smooth">
        
        {/* --- Landing Page --- */}
        {step === 'landing' && (
          <div className="min-h-full flex flex-col relative overflow-hidden">
            <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full bg-gradient-to-br from-rose-200/40 to-orange-100/40 blur-[80px]" />
            <div className="absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] rounded-full bg-gradient-to-tl from-blue-200/40 to-purple-100/40 blur-[80px]" />

            <div className="flex-1 flex flex-col justify-center items-center px-8 z-10 animate-fade-in relative py-12">
              <div className="mb-8 p-4 bg-white/50 backdrop-blur-sm rounded-2xl shadow-sm border border-white/60">
                 <Lock className="w-8 h-8 text-stone-700 opacity-80" />
              </div>
              
              <div className="text-center space-y-4 mb-12">
                <h1 className="text-4xl font-serif font-bold text-stone-800 tracking-wide">
                  情感欲望测评
                </h1>
                <p className="text-sm font-light text-stone-500 tracking-[0.2em] uppercase">
                  Unlock Your Hidden Desires
                </p>
                <p className="text-sm text-stone-600 leading-relaxed max-w-xs mx-auto pt-4">
                  48项核心动机拆解，揭示你的情感欲望。<br/>
                  探索那些未被说出口的渴望。
                </p>
              </div>

              <div className="w-full max-w-xs space-y-4 min-h-[140px]">
                {!showInput ? (
                  <button 
                    onClick={() => setShowInput(true)}
                    className="w-full bg-stone-900 text-white py-4 rounded-xl font-bold text-sm shadow-xl hover:scale-[1.02] transition-all duration-300 flex items-center justify-center gap-2"
                  >
                    <Key className="w-4 h-4" />
                    我已有兑换码
                  </button>
                ) : (
                  <div className="space-y-3 animate-slide-up">
                    <input 
                      type="text" 
                      value={code}
                      onChange={(e) => setCode(e.target.value)}
                      placeholder="请输入你在小红书获得的兑换码"
                      className="w-full p-4 bg-white/80 border border-stone-200 rounded-xl outline-none text-center focus:ring-2 focus:ring-rose-200 transition-all placeholder:text-xs"
                    />
                    <button 
                      onClick={handleVerify}
                      disabled={isLoading}
                      className="w-full bg-stone-900 text-white py-4 rounded-xl font-bold text-sm shadow-lg hover:bg-stone-800 transition-colors flex items-center justify-center gap-2"
                    >
                      {isLoading ? <RefreshCw className="w-4 h-4 animate-spin" /> : '开始解锁'}
                    </button>
                    {errorMsg && (
                      <p className="text-xs text-red-500 text-center bg-red-50 py-2 rounded-lg">
                        {errorMsg}
                      </p>
                    )}
                  </div>
                )}
              </div>

              <div className="mt-16 text-center">
                <p className="text-xs text-stone-400 mb-2">如何获得兑换码？</p>
                <div className="inline-flex items-center gap-1 text-xs text-rose-500 bg-rose-50 px-3 py-1.5 rounded-full cursor-pointer hover:bg-rose-100 transition-colors">
                  <Search className="w-3 h-3" />
                  <span>前往小红书搜索【柚子的心理小屋】</span>
                </div>
              </div>
              
              <div className="mt-auto pt-12 text-center">
                 <p className="text-[10px] text-stone-300 tracking-widest opacity-60">柚子的心理小屋 · 原创出品</p>
              </div>
            </div>
          </div>
        )}

        {/* --- Part Intro --- */}
        {step === 'partIntro' && currentPart && (
          <div className="min-h-full bg-stone-900 flex flex-col justify-center items-center text-center p-8 animate-fade-in relative overflow-hidden">
             <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-10" />
             <div className="relative z-10 max-w-sm flex-1 flex flex-col justify-center">
               <span className="text-rose-300/80 text-[10px] tracking-[0.4em] uppercase mb-6 block">Chapter</span>
               <h2 className="text-2xl font-serif font-bold mb-6 text-rose-50 tracking-wide">{currentPart.title}</h2>
               <div className="w-8 h-1 bg-rose-500/50 mx-auto mb-8 rounded-full"></div>
               <p className="text-lg font-serif italic text-white/90 mb-8 leading-relaxed px-4">
                 {currentPart.quote}
               </p>
               <p className="text-xs text-stone-400 leading-6 mb-12 px-6">
                 {currentPart.desc}
               </p>
               <button 
                 onClick={() => setStep('quiz')}
                 className="group flex items-center gap-2 mx-auto text-rose-200 border border-rose-200/20 px-8 py-3 rounded-full hover:bg-rose-200/10 transition-all text-xs tracking-widest"
               >
                 CONTINUE
                 <ChevronRight className="w-3 h-3 group-hover:translate-x-1 transition-transform" />
               </button>
             </div>
             
             <div className="flex-none pt-8 pb-4 w-full text-center">
                <p className="text-[10px] text-stone-500 tracking-widest opacity-40">柚子的心理小屋 · 原创出品</p>
             </div>
          </div>
        )}

        {/* --- Quiz --- */}
        {step === 'quiz' && (
          <div className="min-h-full flex flex-col pt-14 px-6 animate-slide-up max-w-md mx-auto w-full relative">
            
            <div className="w-full h-1 bg-stone-100 rounded-full mb-5 overflow-hidden flex-none">
              <div 
                className="h-full bg-rose-400 transition-all duration-500 ease-out"
                style={{ width: `${progress}%` }}
              />
            </div>
            
            <div className="flex-1 flex flex-col pb-32">
               <div className="mb-2">
                 <span className="text-[10px] font-bold tracking-widest uppercase text-rose-400 bg-rose-50 px-2 py-1 rounded inline-block mb-2">
                   {currentQIndex < 16 ? 'Reality' : currentQIndex < 32 ? 'Emotion' : 'Soul'}
                 </span>
                 <h2 className="text-base font-medium leading-snug text-stone-800">
                   {QUESTIONS[currentQIndex].question}
                 </h2>
               </div>
               
               <div className="space-y-2">
                 {QUESTIONS[currentQIndex].options.map((opt, idx) => {
                   const isSelected = answers[currentQIndex] === opt.type;
                   return (
                     <button
                       key={`${currentQIndex}-${idx}`} 
                       onClick={() => handleSelectOption(opt.type)}
                       className={`w-full text-left p-3.5 border rounded-xl shadow-sm transition-all duration-200 active:scale-[0.98] group relative overflow-hidden
                         ${isSelected 
                           ? 'bg-rose-50 border-rose-400 shadow-md' 
                           : 'bg-white border-stone-100 hover:border-rose-200'}`}
                     >
                       <div className="relative z-10 flex items-start gap-3">
                         <div className={`w-4 h-4 rounded-full border mt-0.5 flex-shrink-0 transition-colors 
                           ${isSelected ? 'border-rose-500 bg-rose-500' : 'border-stone-300'}`} 
                         />
                         <span className={`text-sm leading-relaxed ${isSelected ? 'text-rose-900 font-medium' : 'text-stone-600'}`}>
                           {opt.text}
                         </span>
                       </div>
                     </button>
                   );
                 })}
               </div>
               
               {/* 底部流式原创说明 */}
               <div className="mt-auto pt-12 pb-4 text-center opacity-60">
                  <p className="text-[10px] text-stone-400 tracking-widest">柚子的心理小屋 · 原创出品</p>
               </div>
            </div>
          </div>
        )}

        {/* --- Analysis --- */}
        {step === 'analyzing' && (
          <div className="min-h-full flex flex-col justify-center items-center text-center bg-stone-900 text-white">
            <div className="relative w-24 h-24">
              <div className="absolute inset-0 border-2 border-stone-800 rounded-full" />
              <div className="absolute inset-0 border-2 border-rose-400 rounded-full border-t-transparent animate-spin" />
              <div className="absolute inset-0 flex items-center justify-center">
                <Sparkles className="w-8 h-8 text-rose-300 animate-pulse" />
              </div>
            </div>
            <h3 className="mt-8 text-base font-serif font-bold text-rose-50 tracking-wide">生成欲望图谱...</h3>
            <p className="text-[10px] text-stone-500 mt-2 font-mono tracking-widest uppercase">Calculating</p>
          </div>
        )}

        {/* --- Result Step 1: Card Reveal Animation --- */}
        {step === 'result_card' && !showFinal && (
          <div className="min-h-full flex flex-col items-center justify-center animate-fade-in p-6 bg-stone-900 relative overflow-hidden">
            
            <div className={`absolute inset-0 z-50 bg-white pointer-events-none transition-opacity duration-[800ms] ease-in ${cardState === 'exploding' ? 'opacity-100' : 'opacity-0'}`}></div>

            <p className={`text-center text-[10px] text-stone-400 mb-8 tracking-[0.2em] uppercase transition-opacity ${cardState !== 'idle' ? 'opacity-0' : 'opacity-100'}`}>
               Tap to Reveal
            </p>
            
            <div 
              className="relative w-full max-w-sm aspect-[3/5] perspective-1000 cursor-pointer group"
              onClick={handleCardClick}
            >
              <div className={`relative w-full h-full transform-style-3d 
                  ${cardState !== 'idle' ? 'rotate-y-180' : ''} 
                  ${cardState === 'shaking' ? 'animate-violent-shake' : ''}
                 `}
                 style={{ transition: 'transform 1.0s cubic-bezier(0.6, -0.28, 0.735, 0.045)' }}
              >
                <div className="absolute inset-0 backface-hidden bg-stone-800 rounded-[2rem] shadow-2xl border border-white/10 flex flex-col items-center justify-center h-full w-full">
                  <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20" />
                  <Sparkles className="w-16 h-16 text-rose-200/50 mb-6 animate-pulse" />
                  <h3 className="text-rose-100/90 text-lg font-serif tracking-widest">点击揭晓</h3>
                  <p className="absolute bottom-8 text-[10px] text-white/20">柚子的心理小屋</p>
                </div>

                <div className={`absolute inset-0 backface-hidden rotate-y-180 rounded-[2rem] overflow-hidden flex flex-col items-center justify-center text-white p-8 
                  bg-gradient-to-br ${RESULTS[results.primary].cardStyle} backdrop-blur-xl border border-white/30 relative h-full w-full`}>
                  <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/noise.png')] opacity-10 mix-blend-overlay" />
                  <div className="relative z-10 flex flex-col items-center justify-center h-full px-4 text-center">
                      <div className="w-24 h-24 mb-8 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20 shadow-[0_0_30px_rgba(255,255,255,0.1)]">
                        {RESULTS[results.primary].icon}
                      </div>
                      <p className="text-[10px] tracking-[0.2em] uppercase text-white/60 mb-2">你的情感欲望是——</p>
                      <h2 className="text-4xl font-serif font-bold mb-6 drop-shadow-lg tracking-wider">{results.primary}</h2>
                      <div className="w-12 h-[1px] bg-white/40 mb-6"></div>
                      <p className="text-sm font-serif italic text-white/90 leading-7 opacity-90 max-w-[80%]">
                        {RESULTS[results.primary].quote}
                      </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* --- Result Step 2: Final Share Page (Poster Optimized) --- */}
        {showFinal && displayData && (
          <div className="min-h-full flex flex-col animate-fade-in-slow bg-[#FAFAFA] pb-12 relative">
            
            <div id="poster-area" className="bg-[#FAFAFA] relative">
                <div className={`pt-14 pb-16 px-6 rounded-b-[3.5rem] shadow-2xl bg-gradient-to-b ${displayData.cardStyle} text-white relative overflow-hidden`}>
                  <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/noise.png')] opacity-[0.03]" />
                  <div className="absolute top-[-20%] right-[-20%] w-[80%] h-[80%] rounded-full bg-white/10 blur-[80px]" />
                  
                  <div className="relative z-10 flex flex-col items-center">
                    <p className="text-[10px] font-medium tracking-[0.2em] mb-2 text-white/80">你的情感欲望是——</p>
                    <h1 className="text-5xl font-serif font-bold mb-8 drop-shadow-xl tracking-wider text-center">
                      {results.primary}
                    </h1>
                    
                    <div className="w-full max-w-sm text-center px-4 mb-8 relative">
                       <span className="absolute -top-4 left-4 text-4xl font-serif opacity-20">“</span>
                       <p className="font-serif italic text-white/95 text-base leading-relaxed py-2 inline-block relative z-10">
                         {displayData.quote}
                       </p>
                       <span className="absolute -bottom-8 right-4 text-4xl font-serif opacity-20">”</span>
                    </div>

                    <div className="w-full max-w-xs h-[260px] bg-white/10 backdrop-blur-sm rounded-[2rem] border border-white/20 p-4 shadow-inner relative mt-4">
                        <ResponsiveContainer width="100%" height="100%">
                          <RadarChart cx="50%" cy="50%" outerRadius="65%" data={chartData}>
                            <PolarGrid stroke="rgba(255,255,255,0.3)" />
                            <PolarAngleAxis dataKey="subject" tick={{ fill: 'white', fontSize: 10, fontWeight: 600, opacity: 0.9 }} />
                            <PolarRadiusAxis angle={30} domain={[0, 8]} tick={false} axisLine={false} />
                            <Radar
                              name="My Desire"
                              dataKey="A"
                              stroke="#fff" 
                              strokeWidth={3}
                              fill="#fff"
                              fillOpacity={0.6} 
                            />
                          </RadarChart>
                        </ResponsiveContainer>
                    </div>
                  </div>
                </div>

                <div className="px-5 -mt-10 relative z-20">
                  <div className="flex gap-3 overflow-x-auto no-scrollbar pb-2 pl-2">
                     {RESULT_TABS.map((tab) => (
                       <button
                         key={tab.id}
                         onClick={() => setActiveTab(tab.id)}
                         className={`flex-shrink-0 px-4 py-2 rounded-full text-[11px] font-bold transition-all duration-300 border backdrop-blur-md shadow-sm
                           ${activeTab === tab.id 
                             ? `${displayData.tabActiveColor} scale-105 shadow-md` 
                             : `${displayData.tabInactiveColor} border-transparent`}`}
                       >
                         {tab.label}
                       </button>
                     ))}
                  </div>

                  <div className="bg-white/90 backdrop-blur-xl rounded-[2rem] shadow-[0_10px_40px_-10px_rgba(0,0,0,0.05)] border border-white p-7 min-h-[340px] mt-4 relative overflow-hidden">
                      <div className={`absolute top-0 right-0 w-32 h-32 ${displayData.themeColor} opacity-[0.05] rounded-full blur-3xl pointer-events-none`}></div>

                      {activeTab === 'base' && (
                        <div className="animate-fade-in space-y-5">
                          <div className="flex items-center gap-3 mb-2">
                             <div className={`p-2 rounded-lg ${displayData.themeColor} bg-opacity-10`}>
                               <BookOpen className={`w-5 h-5 ${displayData.accentColor.replace('text-', 'text-opacity-90 text-')}`} />
                             </div>
                             <h3 className="font-serif font-bold text-lg text-stone-800">
                               {displayData.archetype}
                             </h3>
                          </div>
                          <p className="text-[13px] text-stone-600 leading-7 text-justify whitespace-pre-line font-light">
                            {displayData.content.base}
                          </p>
                        </div>
                      )}

                      {activeTab === 'light_shadow' && (
                        <div className="animate-fade-in space-y-8">
                           <div>
                              <h4 className="text-xs font-bold text-amber-600 mb-4 flex items-center gap-2 uppercase tracking-wide bg-amber-50 inline-block px-3 py-1 rounded-full">
                                 <Sun className="w-3 h-3" /> 你的光 · 核心天赋
                              </h4>
                              <div className="space-y-3 pl-1">
                                {displayData.content.light.map((item, idx) => (
                                  <div key={idx} className="relative pl-4 border-l-2 border-amber-200">
                                    <span className="block text-xs font-bold text-stone-800 mb-1">{item.label}</span>
                                    <span className="text-[11px] text-stone-500 leading-5 block text-justify">{item.text}</span>
                                  </div>
                                ))}
                              </div>
                           </div>
                           <div className="pt-2">
                              <h4 className="text-xs font-bold text-indigo-600 mb-4 flex items-center gap-2 uppercase tracking-wide bg-indigo-50 inline-block px-3 py-1 rounded-full">
                                 <Moon className="w-3 h-3" /> 你的影 · 隐性挑战
                              </h4>
                              <div className="space-y-3 pl-1">
                                {displayData.content.shadow.map((item, idx) => (
                                  <div key={idx} className="relative pl-4 border-l-2 border-indigo-200">
                                    <span className="block text-xs font-bold text-stone-800 mb-1">{item.label}</span>
                                    <span className="text-[11px] text-stone-500 leading-5 block text-justify">{item.text}</span>
                                  </div>
                                ))}
                              </div>
                           </div>
                        </div>
                      )}

                      {activeTab === 'partner' && (
                        <div className="animate-fade-in">
                          <div className="bg-rose-50 border border-rose-100 rounded-xl p-4 mb-6 text-center">
                             <p className="text-xs text-rose-600 font-bold">
                               💡 截图发给TA，能减少80%的争吵
                             </p>
                          </div>
                          <div className="space-y-6">
                            {displayData.content.partner.map((text, idx) => (
                              <div key={idx} className="flex gap-4">
                                 <span className="flex-shrink-0 w-6 h-6 rounded-full bg-stone-100 text-stone-400 flex items-center justify-center text-[10px] font-bold font-serif border border-stone-200">
                                   {idx + 1}
                                 </span>
                                 <p className="text-[13px] text-stone-600 leading-6 text-justify">
                                   {text}
                                 </p>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      {activeTab === 'self' && (
                        <div className="animate-fade-in space-y-4">
                          <div className="flex items-center gap-3 mb-4">
                             <div className="p-2 bg-rose-100 rounded-lg">
                               <Heart className="w-5 h-5 text-rose-500" />
                             </div>
                             <h3 className="font-bold text-stone-800">如何更温柔地爱自己</h3>
                          </div>
                          <p className="text-[13px] text-stone-600 leading-7 text-justify whitespace-pre-line p-5 bg-stone-50 rounded-2xl border border-stone-100">
                            {displayData.content.self}
                          </p>
                        </div>
                      )}

                      {activeTab === 'reshape' && (
                        <div className="animate-fade-in space-y-4">
                           <div className="flex items-center gap-3 mb-4">
                             <div className="p-2 bg-emerald-100 rounded-lg">
                               <Zap className="w-5 h-5 text-emerald-600" />
                             </div>
                             <h3 className="font-bold text-stone-800">能量重塑建议</h3>
                          </div>
                          <div className="bg-emerald-50/50 p-6 rounded-2xl border border-emerald-100">
                             <p className="text-[13px] text-emerald-900/80 leading-7 text-justify whitespace-pre-line">
                               {displayData.content.reshape}
                             </p>
                          </div>
                        </div>
                      )}
                  </div>

                  {/* 底部版权 */}
                  <div className="mt-12 mb-8 text-center px-6">
                      <p className="font-serif italic text-stone-400/80 text-xs mb-6">
                        {displayData.blessing}
                      </p>
                      <div className="w-8 h-[1px] bg-stone-200 mx-auto mb-4"></div>
                      <p className="text-[9px] text-stone-300 uppercase tracking-[0.3em] font-medium">
                         柚子的心理小屋 · 原创出品
                      </p>
                  </div>
                </div>
            </div>
          </div>
        )}

      </main>

      {/* 底部导航栏 (Quiz Mode Only) */}
      {step === 'quiz' && (
        <div className="flex-none w-full bg-white border-t border-stone-100 p-4 z-40">
           <div className="flex gap-4 max-w-md mx-auto">
             <button
               onClick={handlePrev}
               disabled={isPartFirstQuestion}
               className={`flex-1 py-3.5 rounded-xl font-bold text-xs flex items-center justify-center gap-2 border transition-colors
                 ${isPartFirstQuestion 
                   ? 'bg-stone-50 text-stone-300 border-stone-100 cursor-not-allowed' 
                   : 'bg-white text-stone-600 border-stone-200 hover:bg-stone-50'}`}
             >
               <ArrowLeft className="w-4 h-4" /> 上一题
             </button>
             
             <button
               onClick={handleNext}
               disabled={!answers[currentQIndex]}
               className={`flex-1 py-3.5 rounded-xl font-bold text-xs flex items-center justify-center gap-2 shadow-lg transition-all
                 ${!answers[currentQIndex]
                   ? 'bg-stone-200 text-white cursor-not-allowed'
                   : 'bg-stone-900 text-white active:scale-[0.98]'}`}
             >
               下一题 <ArrowRight className="w-4 h-4" />
             </button>
           </div>
        </div>
      )}

      {/* Part 确认弹窗 */}
      {showPartModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center px-6 animate-fade-in">
           <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" />
           <div className="bg-white w-full max-w-sm rounded-2xl p-6 relative z-10 shadow-2xl animate-slide-up text-center">
              <div className="w-12 h-12 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-4 text-rose-500">
                <AlertCircle className="w-6 h-6" />
              </div>
              <h3 className="font-bold text-lg text-stone-800 mb-2">确认提交本章节？</h3>
              <p className="text-xs text-stone-500 mb-6 leading-relaxed">
                提交后将无法返回修改本章节的答案。<br/>即将进入下一阶段的深度探索。
              </p>
              <div className="flex gap-3">
                <button 
                  onClick={() => setShowPartModal(false)}
                  className="flex-1 py-3 rounded-xl border border-stone-200 text-stone-600 text-xs font-bold"
                >
                  再检查一下
                </button>
                <button 
                  onClick={confirmNextPart}
                  className="flex-1 py-3 rounded-xl bg-stone-900 text-white text-xs font-bold shadow-lg"
                >
                  确认提交
                </button>
              </div>
           </div>
        </div>
      )}

      <style jsx global>{`
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes slideUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }

        @keyframes violent-shake {
          0% { transform: rotateY(180deg) translate(0, 0) rotate(0deg); }
          10% { transform: rotateY(180deg) translate(-5px, -5px) rotate(-3deg); }
          20% { transform: rotateY(180deg) translate(5px, 5px) rotate(3deg); }
          30% { transform: rotateY(180deg) translate(-7px, 5px) rotate(-5deg); }
          40% { transform: rotateY(180deg) translate(7px, -5px) rotate(5deg); }
          50% { transform: rotateY(180deg) translate(-5px, 7px) rotate(-3deg); }
          60% { transform: rotateY(180deg) translate(5px, -7px) rotate(3deg); }
          70% { transform: rotateY(180deg) translate(3px, 3px) rotate(-2deg); }
          80% { transform: rotateY(180deg) translate(-3px, -3px) rotate(2deg); }
          90% { transform: rotateY(180deg) translate(1px, 1px) rotate(0deg); }
          100% { transform: rotateY(180deg) translate(0, 0) rotate(0deg); }
        }
        
        .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-fade-in { animation: slideUp 0.8s ease-out forwards; }
        .animate-fade-in-slow { animation: slideUp 1.2s ease-out forwards; }
        .animate-violent-shake { animation: violent-shake 0.5s infinite; }
      `}</style>
    </div>
  );
}
