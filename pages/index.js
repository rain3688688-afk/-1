"use client";

import React, { useState, useEffect, useRef } from 'react';
import { Sparkles, Lock, Share2, RefreshCw, Zap, Heart, Shield, Anchor, Wind, Grid, Eye, Sun, Moon, Download, ChevronRight, BookOpen, Key, Feather, Search, Link as LinkIcon, Copy } from 'lucide-react';
import Head from 'next/head';
import { createClient } from '@supabase/supabase-js';
import { Radar, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, ResponsiveContainer } from 'recharts';
import html2canvas from 'html2canvas';

// --- 1. 初始化配置 ---
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || "";
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || "";
const supabase = createClient(supabaseUrl, supabaseKey);

const SITE_URL = "https://www.qingganyuwang.top"; 
const XIAOHONGSHU_KEYWORD = "柚子的心理小屋";

const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

// 章节配置
const PARTS_CONFIG = [
  { startIndex: 0, title: "Part 1：现实切片", quote: "“爱不仅仅是誓言，更是下意识的本能。”", desc: "先让我们从生活的琐碎里，捕捉你在亲密关系中那些最真实的条件反射。" },
  { startIndex: 16, title: "Part 2：情绪暗涌", quote: "“日常的表象之下，藏着我们未曾说出口的渴望。”", desc: "现在的你，已经脱去了社交伪装。让我们再往下潜一点，去触碰那些让你感到不安、委屈或满足的瞬间。" },
  { startIndex: 32, title: "Part 3：灵魂图腾", quote: "“语言无法抵达的地方，直觉可以。”", desc: "欢迎来到你内心的最深处。接下来的问题不需要逻辑，仅凭直觉，选出你第一眼看到的那个答案。" }
];

// 题目数据
const QUESTIONS = [
  { id: 1, question: "周末下午，伴侣突然失联了3个小时，发消息也没回。那一刻，你最真实的反应是？", options: [{ text: "下意识翻聊天记录，看是不是我说错话了？", type: "确定感" }, { text: "挺好的，刚好没人管我，专心做自己的事。", type: "自由感" }, { text: "推测原因，准备联系上后问清楚去向。", type: "掌控感" }, { text: "心里堵得慌。如果他够在意我，怎么舍得让我空等？", type: "被偏爱" }] },
  { id: 2, question: "伴侣最近工作压力极大，回家情绪低落一言不发。此时你心里的念头是？", options: [{ text: "看着心疼。倒杯水、切水果，让他知道有人照顾。", type: "被需要" }, { text: "他应该很烦。那我就识趣点躲远点，等他缓过来。", type: "安全距离" }, { text: "死气沉沉的沉默很难受。希望能聊聊。", type: "精神共鸣" }, { text: "在意接下来的安排：今晚怎么吃？计划还作数吗？", type: "秩序感" }] },
  { id: 3, question: "因为一件琐事发生了激烈的争吵，甚至有些冷场。你心里那个过不去的点主要是？", options: [{ text: "态度冷冰冰。那种随时要放弃我的感觉最让我害怕。", type: "确定感" }, { text: "没复盘。到底谁对谁错，以后按谁的来？", type: "秩序感" }, { text: "心软了。看他气得脸色发白，输赢不重要，想哄哄他。", type: "被需要" }, { text: "无法沟通。不立刻解决问题翻篇，我就没法安心做事。", type: "掌控感" }] },
  { id: 4, question: "你冷不丁冒出一个有点奇怪的脑洞，随口讲给伴侣听。此时你最期待的反应是？", options: [{ text: "哪怕听不懂，只要愿意放下手机认真听我说完，我就满足。", type: "被偏爱" }, { text: "瞬间接住梗，还能延伸出新观点。那一刻觉得“只有你懂我”。", type: "精神共鸣" }, { text: "我说我的，你听你的，不必强行同步。", type: "自由感" }, { text: "只敢说一半。怕说出来对方接不住，反而尴尬。", type: "安全距离" }] },
  { id: 5, question: "伴侣想看你的手机，或者询问你过去的详细情感经历。你的本能反应是？", options: [{ text: "哪怕没秘密也反感。这是隐私，被审视的感觉很不舒服。", type: "自由感" }, { text: "随便看。如果你看了能更安心，那我求之不得。", type: "确定感" }, { text: "看可以，但要公平。如果我也能看你的，那就没问题。", type: "秩序感" }, { text: "看可以，但不想被误解。不希望你片面定义现在的我。", type: "精神共鸣" }] },
  { id: 6, question: "伴侣偶尔有些迷糊，犯了个不大不小的错。你下意识的第一反应通常是？", options: [{ text: "下意识去兜底。直接上手帮他善后。", type: "被需要" }, { text: "觉得被忽视了。你是不是没把我的事放心上？", type: "被偏爱" }, { text: "复盘原因。想知道哪个环节出了问题，确保下次不再发生。", type: "掌控感" }, { text: "无所谓。谁还没个犯错的时候，大家都轻松点最好。", type: "安全距离" }] },
  { id: 7, question: "谈到“未来”这个话题时，什么情况最让你感到不安？", options: [{ text: "没有计划，说“顺其自然”。这种没规划的日子让我没底。", type: "秩序感" }, { text: "态度不坚定。表现出一丝犹豫，我就怀疑他没打算长久。", type: "确定感" }, { text: "想到未来几十年都要和一个人绑死，我就本能地想逃。", type: "自由感" }, { text: "怕未来各过各的。变成两个合租的陌生人。", type: "被需要" }] },
  { id: 8, question: "当你自己情绪崩溃、非常脆弱的时候，你最希望对方做什么？", options: [{ text: "别问“怎么了”。当没看见，让我躲一会儿。", type: "安全距离" }, { text: "只要抱着我，让我感觉“这一刻你也一样难过”。", type: "精神共鸣" }, { text: "帮我分析烂摊子怎么收场，解决那个搞崩我的问题。", type: "掌控感" }, { text: "就算我无理取闹，也请站在我这边。我只需要偏袒。", type: "被偏爱" }] },
  { id: 9, question: "到了纪念日，如果伴侣准备的礼物让你觉得有点失望，那个失望的点通常是？", options: [{ text: "不够用心。看不出我是那个被特殊对待的人。", type: "被偏爱" }, { text: "没意义。跟我不搭界，说明他根本不懂我的喜好。", type: "精神共鸣" }, { text: "不实用。破坏了开销计划，不如买点实用的。", type: "秩序感" }, { text: "不平衡。我总是记着你的喜好，你对我却一无所知。", type: "被需要" }] },
  { id: 10, question: "带伴侣去参加你的朋友聚会。整个过程中，你最舒服的状态是？", options: [{ text: "连体婴。哪怕跟别人聊天，我也希望眼神能对上。", type: "确定感" }, { text: "得体模式。在意他能不能融入，别冷场也别出格。", type: "掌控感" }, { text: "放养模式。各玩各的，不用我时刻照顾他的情绪。", type: "自由感" }, { text: "低调模式。正常社交就好，别让我们成为全场焦点。", type: "安全距离" }] },
  { id: 11, question: "两个人一起出去旅行，最容易让你心里炸毛的瞬间是？", options: [{ text: "人为失误搞砸计划。赶不上车/景点关门，让我瞬间暴躁。", type: "掌控感" }, { text: "行程变来变去。我需要知道今天到底要干嘛。", type: "秩序感" }, { text: "被行程表催着走。非要打卡、几点起床，这像军训。", type: "自由感" }, { text: "同路不同频。我想感叹风景，他只关心吃什么。", type: "精神共鸣" }] },
  { id: 12, question: "同居或长相处时，伴侣有一些让你看不惯的生活习惯。你通常会怎么想？", options: [{ text: "没有规矩。如果大家都随心所欲，这个家就乱套了。", type: "秩序感" }, { text: "他不重视我。说过好几次了还这样，根本没把我放心上。", type: "确定感" }, { text: "别管我就行。我不强迫他，他也别反过来管我。", type: "自由感" }, { text: "还是我来吧。骂归骂，最后还是默默帮他收拾了。", type: "被需要" }] },
  { id: 13, question: "伴侣无意中提起了一个优秀的异性朋友，言语间带着欣赏。你心里的第一反应是？", options: [{ text: "酸溜溜的。你为什么要当着我的面夸别人？", type: "被偏爱" }, { text: "警铃大作。那个人是不是比我更适合他？", type: "确定感" }, { text: "想搞清楚界限。确认关系是否在可控范围内。", type: "掌控感" }, { text: "无所谓装傻。不想深究，也不想表现得像个嫉妒狂。", type: "安全距离" }] },
  { id: 14, question: "在一起久了，关系进入平淡模式，每天除了吃饭睡觉没别的话题。你会觉得？", options: [{ text: "慢性死亡。没有思想交流，只剩空壳。", type: "精神共鸣" }, { text: "有点失落。好像我这个人在不在家对他没差别了。", type: "被需要" }, { text: "求之不得。不用费劲维系激情，各干各的最舒服。", type: "自由感" }, { text: "这很正常。稳定的、可预测的生活节奏让我踏实。", type: "秩序感" }] },
  { id: 15, question: "你有一个非常痴迷的小爱好，但伴侣完全不感兴趣。你希望他的态度是？", options: [{ text: "别干涉我。这是我的自留地，请离远点。", type: "安全距离" }, { text: "尊重我的投入。别总质疑我不务正业。", type: "掌控感" }, { text: "试着懂我一点。明白为什么这个东西能打动我。", type: "精神共鸣" }, { text: "陪我一起玩。哪怕不喜欢，也希望能为了我参与一下。", type: "被偏爱" }] },
  { id: 16, question: "大吵一架终于和好了。为了让这页彻底翻过去，你最需要的一个“收尾动作”是？", options: [{ text: "反复确认。“你真的不生气了吗？我们真的没事了吗？”", type: "确定感" }, { text: "某种补偿行为。比如给他做顿好吃的。", type: "被需要" }, { text: "彻底不提。赶紧回归正常，把这尴尬的一页揭过去。", type: "安全距离" }, { text: "得到一个小惊喜。买个礼物或者带我吃顿好的。", type: "被偏爱" }] },
  { id: 17, question: "在一段关系里，最让你感到心慌、不踏实的那种时刻，其实是？", options: [{ text: "不知道下一秒会发生什么。内心悬空的感觉最折磨人。", type: "确定感" }, { text: "感觉透不过气。那种被严密包裹的窒息感，让我只想逃。", type: "自由感" }, { text: "事情脱离了轨迹。局面完全乱套，无法把握方向。", type: "掌控感" }, { text: "像在演独角戏。面对面心却连不上的孤独感。", type: "精神共鸣" }] },
  { id: 18, question: "当你在感情里觉得特别委屈时，脑海里那个挥之不去的念头是？", options: [{ text: "“好像我没什么价值。” 觉得自己很多余。", type: "被需要" }, { text: "“我就知道会受伤。” 本能地想立刻缩回去。", type: "安全距离" }, { text: "“这不公平。” 为什么总是我在妥协？", type: "秩序感" }, { text: "“原来我和别人没区别。” 我并没有被放在例外的位置上。", type: "被偏爱" }] },
  { id: 19, question: "你理想中最好的爱，给你的直接感觉应该是？", options: [{ text: "轻松。没有压力，没有强制要求。", type: "自由感" }, { text: "踏实。不管发生什么，都知道你不会走。", type: "确定感" }, { text: "默契。不用费劲解释，你也懂。", type: "精神共鸣" }, { text: "清晰。一切都在计划中稳步推进。", type: "掌控感" }] },
  { id: 20, question: "当伴侣非常用力地黏着你、时刻都要和你在一起时，你的真实感受是？", options: [{ text: "很踏实。说明你真的很依赖我，我是不可替代的。", type: "被需要" }, { text: "很想躲。高密度的亲密让我觉得是种打扰。", type: "安全距离" }, { text: "有点烦。如果连正常生活节奏都被打乱了，我会觉得你不懂事。", type: "秩序感" }, { text: "很受用。这种非我不可的劲儿，最能证明你爱我。", type: "被偏爱" }] },
  { id: 21, question: "两个人坐在一起不说话时，你心里的真实活动是？", options: [{ text: "很难受。这种精神上的断连，让我觉得像陌生人。", type: "精神共鸣" }, { text: "很慌张。猜他为什么不说话？是不是生气了？", type: "确定感" }, { text: "很舒服。互不干扰，这种松弛感才是最高级的。", type: "自由感" }, { text: "很想找点事做。不喜欢这种不知道该干嘛的冷场。", type: "掌控感" }] },
  { id: 22, question: "如果你在这段关系里付出了很多，你最害怕的结果是？", options: [{ text: "怕你是真的不需要。怕我给的东西对你是个负担。", type: "被需要" }, { text: "怕这只是我的一厢情愿。只有我一人在投入。", type: "秩序感" }, { text: "怕你把这当成理所应当。连一点特殊的感动都没有。", type: "被偏爱" }, { text: "怕被赖上。怕你索取更多，让我背上沉重义务。", type: "安全距离" }] },
  { id: 23, question: "当听到“永远”这个词的时候，你下意识的反应是？", options: [{ text: "松了一口气。它能压住我心里所有的不安。", type: "确定感" }, { text: "压力好大。还没发生的事就先锁死，很沉重。", type: "自由感" }, { text: "听听就行。没有行动支撑就是空头支票。", type: "掌控感" }, { text: "很多余。真正的契合是不需要用时间来担保的。", type: "精神共鸣" }] },
  { id: 24, question: "在激烈的争吵中，最让你感到绝望、甚至想放弃的一瞬间是？", options: [{ text: "是他推开我的时候。说“不用你管”。", type: "被需要" }, { text: "是他开始胡搅蛮缠的时候。没有任何道理可讲。", type: "秩序感" }, { text: "是他站在我对立面的时候。帮理不帮亲。", type: "被偏爱" }, { text: "是他逼我立刻说话的时候。被逼到死角的窒息感。", type: "安全距离" }] },
  { id: 25, question: "哪怕此时此刻什么都没发生，但只要想到这件事，你就会觉得非常有安全感：", options: [{ text: "我知道你会坚定地站在我这边。不权衡利弊。", type: "确定感" }, { text: "我知道一切都在计划内。没有突发状况打乱生活。", type: "掌控感" }, { text: "我知道我是不可替代的。我能给你别人给不了的支撑。", type: "被需要" }, { text: "我知道我随时可以做自己。不需要伪装。", type: "自由感" }] },
  { id: 26, question: "如果回想一段失败的感情，最让你觉得“意难平”或者“很受伤”的点可能是？", options: [{ text: "“我居然不是特别的。” 我和其他人也没什么两样。", type: "被偏爱" }, { text: "“我们从未真正交流过。” 像住在同屋檐下的陌生人。", type: "精神共鸣" }, { text: "“付出没有回报。” 最后是一笔烂账，觉得很亏。", type: "秩序感" }, { text: "“我不该全盘托出。” 后悔把脆弱展示给你看。", type: "安全距离" }] },
  { id: 27, question: "你会因为什么事情而产生强烈的嫉妒心或占有欲？", options: [{ text: "当他遇到麻烦却不找我时。", type: "被需要" }, { text: "当他对谁都很好的时候。", type: "被偏爱" }, { text: "当他有事瞒着我时。", type: "掌控感" }, { text: "当他和别人聊得更嗨时。", type: "精神共鸣" }] },
  { id: 28, question: "伴侣出差或不在家，留你一个人独处一周。你的真实感受是？", options: [{ text: "像放假一样爽。完全属于自己的时间太珍贵了。", type: "自由感" }, { text: "逐渐开始慌张。没人说话，忍不住确认他还在意我。", type: "确定感" }, { text: "非常自在。互不打扰反而觉得关系更健康。", type: "安全距离" }, { text: "有点无所适从。不需要顾别人，反而觉得不真实。", type: "被需要" }] },
  { id: 29, question: "如果伴侣做了这件事，你会瞬间下头，甚至考虑分手？", options: [{ text: "言而无信。承诺的不兑现，没法过。", type: "秩序感" }, { text: "拒绝沟通。说“想太多”或者直接回避。", type: "精神共鸣" }, { text: "制造混乱。做事毫无章法搞得生活一团糟。", type: "掌控感" }, { text: "权衡利弊。为了别的东西牺牲了我的利益。", type: "被偏爱" }] },
  { id: 30, question: "如果给你自己写一份“恋爱使用说明书”，你最希望标注的核心法则是？", options: [{ text: "“请坚定地选择我。” 别犹豫，别摇摆。", type: "确定感" }, { text: "“请允许我做自己。” 别打着为我好的名义改造我。", type: "自由感" }, { text: "“请看见我的付出。” 别把一切都当成空气。", type: "被需要" }, { text: "“请给我一点时间。” 别一上来就掏心掏肺。", type: "安全距离" }] },
  { id: 31, question: "如果让你用一个词来定义你理想中的“关系形态”，你希望你们是？", options: [{ text: "合伙人。账目分明，分工明确，高效努力。", type: "秩序感" }, { text: "船长与领航员。有明确方向，有问题迅速解决。", type: "掌控感" }, { text: "灵魂伴侣。不用磨合的默契，眼神一对就知道。", type: "精神共鸣" }, { text: "两条平行的河。有交集，又互不吞没。", type: "自由感" }] },
  { id: 32, question: "在你看来，一个人爱你的最高级表现是？", options: [{ text: "例外。他对世界冷漠，唯独对我不一样。", type: "被偏爱" }, { text: "托底。无论我变成什么样，他永远站在我身后。", type: "确定感" }, { text: "依赖。愿意把最脆弱的一面给我看，只让我照顾。", type: "被需要" }, { text: "尊重。懂得站在安全线以外守护我。", type: "安全距离" }] },
  { id: 33, question: "如果要把你向往的亲密关系画成一幅画，它最像什么？", options: [{ text: "深深扎进土里的树根。地下紧紧纠缠。", type: "确定感" }, { text: "两朵飘在天上的云。聚散都随风。", type: "自由感" }, { text: "一条笔直的高速公路。全速驶向同一个终点。", type: "掌控感" }, { text: "两面互相照映的镜子。看着你就能看见自己。", type: "精神共鸣" }] },
  { id: 34, question: "如果要把自己比喻成一种动物，在爱人面前，你更像？", options: [{ text: "温顺的大金毛。你感受到陪伴我就满足。", type: "被需要" }, { text: "被驯服的小狐狸。我只认你这一个“驯养员”。", type: "被偏爱" }, { text: "屯松果的松鼠。未雨绸缪，规划好过冬。", type: "秩序感" }, { text: "林间的小鹿。生性敏感，试探着靠近。", type: "安全距离" }] },
  { id: 35, question: "闭上眼，你觉得最让你感到安稳的那个空间是？", options: [{ text: "暴雨夜的屋子。你在身边，门窗紧闭。", type: "确定感" }, { text: "巨大的落地窗。视野通透，没有围栏。", type: "自由感" }, { text: "深夜书房。安静私密，只有书和思想。", type: "精神共鸣" }, { text: "私有王国。关上门，这里就是我们的国度。", type: "掌控感" }] },
  { id: 36, question: "如果关系出现危机，你觉得那场景最像什么？", options: [{ text: "荒原。我的爱变成了没有回声的荒草。", type: "被需要" }, { text: "沼泽。越挣扎陷得越深，无法抽身。", type: "安全距离" }, { text: "废墟。规则崩塌，满地狼藉。", type: "秩序感" }, { text: "大卖场。被放在货架上打折出售。", type: "被偏爱" }] },
  { id: 37, question: "如果“誓言”是一个具体的物品，你希望它是什么？", options: [{ text: "磐石。够重够硬，镇住所有变数。", type: "确定感" }, { text: "风铃。风来时响，风走时静，不束缚。", type: "自由感" }, { text: "契约。白纸黑字，不可违背的守则。", type: "掌控感" }, { text: "潮汐。是引力，不言自明的必然性。", type: "精神共鸣" }] },
  { id: 38, question: "你最喜欢的亲密关系，它的“温度”应该是？", options: [{ text: "滚烫的 100°C。沸腾的热情，全心全意。", type: "被需要" }, { text: "微凉的 20°C。清爽不黏人，长久。", type: "安全距离" }, { text: "恒温的 26°C。不要忽冷忽热，要稳定。", type: "秩序感" }, { text: "只暖一人的 37°C。隐秘私有，只我有资格触碰。", type: "被偏爱" }] },
  { id: 39, question: "如果爱是一件必须随身携带的物品，你觉得它最像？", options: [{ text: "贴身的护身符。遇到不安时它就在。", type: "确定感" }, { text: "降噪耳机。戴上它，世界嘈杂消失。", type: "精神共鸣" }, { text: "瑞士军刀。精密有力，解决所有难题。", type: "掌控感" }, { text: "一张空白机票。给我探索世界的底气。", type: "自由感" }] },
  { id: 40, question: "如果有一天真的要分开，你希望那是？", options: [{ text: "燃尽。流干了最后一滴泪才甘心离场。", type: "被需要" }, { text: "退潮。自然而然退去，像没发生过。", type: "安全距离" }, { text: "清算。把账算清，把话说开。", type: "秩序感" }, { text: "绝版。你再也遇不到像我这样对你好的人。", type: "被偏爱" }] },
  { id: 41, question: "你最喜欢的恋爱氛围，像哪种天气？", options: [{ text: "多云有风。空气流动，清清爽爽。", type: "自由感" }, { text: "初雪。世界安静，纯粹浪漫。", type: "被偏爱" }, { text: "晴朗无云。能见度高，一眼看到地平线。", type: "秩序感" }, { text: "深夜雷雨。与世隔绝，只有我们俩。", type: "精神共鸣" }] },
  { id: 42, question: "如果你闭上眼触摸“爱”，手感应该是？", options: [{ text: "晒热的石头。厚实、干燥、有分量。", type: "确定感" }, { text: "湿软的陶泥。柔软、依恋，填满空隙。", type: "被需要" }, { text: "流动的溪水。清凉、无重力，不带来负担。", type: "安全距离" }, { text: "紧绷的缰绳。粗糙有力，握住就能控制。", type: "掌控感" }] },
  { id: 43, question: "你觉得一段好的亲密关系，闻起来应该像？", options: [{ text: "薄荷或海盐。清冽透气，肺部扩张。", type: "自由感" }, { text: "草莓尖尖。第一口咬下去的甜，特供的。", type: "被偏爱" }, { text: "刚晒干的棉被。干净干燥，井井有条。", type: "秩序感" }, { text: "旧书页/焚香。沉静悠长，闻到时间。", type: "精神共鸣" }] },
  { id: 44, question: "你希望爱人是哪种光源？", options: [{ text: "壁炉里的火。需要我添柴，但照亮屋子。", type: "被需要" }, { text: "灯塔。固定的。无论去哪回头都在。", type: "确定感" }, { text: "月光。温柔清冷，不灼伤我。", type: "安全距离" }, { text: "手里的火把。靠我亲手点燃，劈开黑暗。", type: "掌控感" }] },
  { id: 45, question: "如果把与爱人的相处节奏比作一段旋律，你希望它是？", options: [{ text: "时钟的声音。滴答滴答，精准规律。", type: "秩序感" }, { text: "随口的哼唱。没固定曲调，轻轻松松。", type: "自由感" }, { text: "山谷里的回音。微弱声音也能得到回应。", type: "精神共鸣" }, { text: "为你独奏。全世界是背景，只有我们。", type: "被偏爱" }] },
  { id: 46, question: "如果爱必须伴随一种痛，你宁愿是？", options: [{ text: "生长痛。骨骼拉伸，关系是成长的。", type: "被需要" }, { text: "钝痛。好过“不知道明天你还在不在”的撕裂。", type: "确定感" }, { text: "幻痛。宁愿隔着距离怀念，也不愿互相伤害。", type: "安全距离" }, { text: "剥离痛。撕开伪装，暴露软肋。", type: "精神共鸣" }] },
  { id: 47, question: "如果要把你们共度的时间比作一样东西，它应该是？", options: [{ text: "流沙。抓越紧流越快，不如摊开手。", type: "自由感" }, { text: "沙漏。时间可控，流完也能倒过来。", type: "掌控感" }, { text: "琥珀。封存最美瞬间，不被侵蚀。", type: "被偏爱" }, { text: "年轮。一圈一圈，扎扎实实。", type: "秩序感" }] },
  { id: 48, question: "最后，请凭直觉填空：爱是______。", options: [{ text: "定数。唯一不会更改的答案。", type: "确定感" }, { text: "认出。茫茫人海辨认出彼此是同类。", type: "精神共鸣" }, { text: "成全。不捆绑，拥有更广阔天空。", type: "自由感" }, { text: "治愈。看见你的破碎，甘愿做药。", type: "被需要" }] }
];

// 结果数据 (完整内容版)
const RESULTS = {
  "确定感": {
    type: "确定感",
    archetype: "风暴中的守夜人",
    icon: <Anchor className="w-8 h-8" />,
    quote: "“万物皆流变，而我只要一种绝对的定数。”",
    cardStyle: "from-blue-700/60 to-indigo-900/60 shadow-[0_0_40px_-5px_rgba(59,130,246,0.5)] border-blue-200/40",
    accentColor: "text-blue-700",
    radarColor: "#3b82f6", 
    tabs: {
      base: `在亲密关系中，你核心的情感诉求是 “稳定与可预期”，始终坚守着对长期联结的极致追求。相较于外在条件的光鲜或浪漫形式的轰轰烈烈，你更看重关系中的确定性—— 凡事有交代、件件有着落、事事有回音，这种清晰、可靠的互动模式，是你构建情感安全感的基石。\n\n你的情感底色厚重且带着强烈的契约精神，对感情的投入从不浅尝辄止，而是带着 “认定即终身” 的郑重。只要对方传递的态度足够明确、信号足够清晰，你便会毫无保留地深度投入，愿意为关系的长久发展付出耐心与精力，包容差异、共担责任，将长期承诺作为情感的核心导向，而非一时的情绪冲动。\n\n这份对关系的厚重期待背后，潜藏着你对不确定性的极度敏感与对被抛弃的深层恐惧。你对关系中的距离变化、态度波动有着本能的警觉，任何模糊的信号、延迟的回应，都可能触发你内心的不安。你并非刻意试探或控制，所有看似执着的追问与确认，本质上都是为了在不确定的关系流动中，寻找一个稳定的情感锚点，反复确认自身在对方心中的重要性与不可替代性。`,
      lightShadow: [
        { label: "稳定的情感支撑力 (光)", text: "你是关系中定海神针般的存在，具备极强的抗风险韧性。不会因短期矛盾或外界波动轻易放弃联结，始终以长期视角对待关系，能为对方提供可依赖的情感锚点，尤其在关系遭遇压力时，更能展现出坚定的守护姿态。" },
        { label: "纯粹的情感忠诚度 (光)", text: "你的情感投入具有极强的排他性与专注度，拒绝 “骑驴找马”“留退路” 等模糊模式。一旦确立联结，便会毫无保留地全心投入，将 “忠诚” 内化为关系的核心准则，这份纯粹性让对方能感受到强烈的被重视感。" },
        { label: "主动的关系修复力 (光)", text: "面对关系裂痕，你倾向于解决问题而非逃避冲突。具备主动沟通、磨合调整的意识，愿意为关系的长久性付出精力，始终以 “巩固联结、延续稳定” 为目标，展现出务实的经营能力。" },
        { label: "对模糊信号的过度敏感 (影)", text: "难以耐受关系中的信息空白，当对方出现沉默、回避等不确定行为时，易陷入过度解读与自我归因，将中性信号转化为被否定、被厌倦的负面预判，进而引发内心焦虑。" },
        { label: "以体谅为名的需求压抑 (影)", text: "因恐惧成为对方的 “负担”，常以 “懂事”“体谅” 为借口，刻意隐藏自身的情感需求与不安。表面上的 “没事，你去忙”，本质是对真实情绪的压抑，长期积累易导致自我消耗与关系失衡。" },
        { label: "对未来的焦虑性预判 (影)", text: "受怕失去的深层恐惧驱动，习惯对关系走向做负面预设，难以全然接纳当下的美好。这种对 稳定感的过度渴求，会转化为持续的焦虑，阻碍你沉浸式体验关系中的正向反馈与快乐。" }
      ],
      partner: [
        "1、你的追问，从不是找茬，是在求一份安心。\n当你反复问 “去哪了”“在干嘛”“爱不爱我” 时，别嫌我烦 —— 那一刻我正被不安包裹。你不用跟我讲道理，只要抱抱我说 “我在，别怕”，就够了。",
        "2、你的 “报备”，是我的定心丸。\n我不要求你秒回消息，但真的怕你突然失联。如果你要忙、或者心情不好想静一静，提前说一句 “我忙会儿，晚点找你”，就能让我从心慌落到踏实。",
        "3、关键时刻，请坚定地偏向我。\n我不用你对抗全世界，但需要知道：在我和别人之间，你会本能地护着我。任何犹豫、迟疑，或是 “先讲道理再顾我”，在我眼里都会变成 “我不重要” 的信号。"
      ],
      origins: `深度溯源：看见那个时刻在 “扫雷” 的小孩\n\n从依恋理论视角来看，你对确定感的极致渴求，本质是焦虑型依恋模式的典型呈现 —— 这种模式在人群中约占 28%，核心特征正是对关系稳定性的持续焦虑，以及对 “被抛弃” 的深层恐惧。\n\n你一定有过这样的童年记忆：那个重要的照顾者（父母或长辈），对你的态度从来没有固定的规律。他们的爱不是稳定的滋养，有时会在你哭闹时立刻抱起安抚，把你宠成掌心的宝贝；有时却对你的需求视而不见，甚至会因为自己的情绪不佳，对你莫名冷淡或责备。\n\n说好的周末陪伴可能被临时取消，承诺的礼物或安慰转头就忘；你需要关注时可能被说 “太黏人”，试图独立时又被质疑 “不够亲近”。这种反复无常的对待，让小小的你始终搞不懂：“为什么前一刻还好好的，爱就突然消失了？”“到底什么样的自己，才能换来一份稳定不变的爱？”\n\n这种不可预测的养育环境，让你从小就被迫活在 “不确定” 里。你不知道下一次伸手是否会被回应，下一次撒娇是否会被拒绝，只能时刻绷紧神经，留意着照顾者的每一个细微信号 —— 是脸色的变化，是语气的起伏，还是动作的轻重。\n\n这份童年里的不安，不是因为你不够好，而是源于照料者不稳定的回应模式。它在你心里埋下了一颗种子：“爱随时可能消失，我随时可能被丢下”。而这份深埋心底的恐惧，正是焦虑型依恋模式的根源，也让你在后来的亲密关系中，本能地执着于 “确定感”，只为填补童年从未被满足的、对稳定与安全的渴求。`,
      reshape: `重塑：把“锚”抛回自己手里\n\n1. 练习事实归因：停止对模糊信号的灾难化解读\n你习惯的读心术，本质是把不确定自动转化为被否定的负面预判。试着用事实 + 合理假设 替代脑补剧情：\n当对方沉默时，别想 “他厌倦我了”，而是告诉自己：“他现在没说话（事实），可能是工作累了 / 在处理私事（合理假设），和我们的关系无关”；\n当对方回应延迟时，别钻 “他不在乎我” 的牛角尖，而是接纳：“每个人都有自己的节奏，延迟回应是他的状态问题，不是我的价值问题”。\n\n2. 建立爱的韧性认知：相信关系的稳定性不依赖即时回应\n你总怕 “不回应 = 爱消失”，但真正的亲密关系，不是时刻在线的热烈，而是哪怕有间隙，也不会断裂的韧性。爱不是持续输出的电流，而是有蓄电功能的电池—— 偶尔的沉默、疏离，只是暂时的能量补给，不是电量耗尽；关系的稳固，不在于没有矛盾，而在于经历波动后依然能回归。试着相信，你们的联结不会因为一次延迟、一句平淡的回应就崩塌，它比你想象中更坚韧。\n\n3. 构建自我价值支撑体系：把情绪重心从对方身上收回\n当你把所有喜怒哀乐都绑定在对方身上时，自然会因对方的一点波动而失衡。真正的安全感，源我本身就足够完整：\n培养独立于关系的快乐来源：无论是深耕一项爱好，拓展社交圈，还是专注职业成长（学习新技能、），这些能让你在独处时也感受到价值与愉悦；\n关注自我需求的满足：不再等着对方来安抚、认可，而是学会自己取悦自己 —— 想吃的美食自己去吃，想看的电影自己去看，想被肯定时就给自己一个小奖励。当你自身的 “快乐账户” 足够充盈，就不会再依赖对方的 “情绪转账”，对方的偶尔摇摆，自然也就没那么有杀伤力了。`,
      blessing: `愿你在世事浮沉的人间，能遇见一个懂你敏感、护你不安的人 —— 他不必为你画地为牢，却愿意为你停下匆忙的脚步；不必许你永远，却能在你慌慌张张试探时，给你一份 “我一直都在” 的笃定。\n\n更愿你修炼出一颗稳稳的内心：不再把安全感寄托于他人的回应，不再把价值感捆绑于关系的稳定。当你真正相信 “无论是否被坚定选择，我本身就值得被好好爱着”，便会发现 —— 最坚实的依靠从不是别人的承诺，而是自己给的底气；最恒久的确定感，也从不是来自外界的安稳，而是源于内心的自洽与从容。\n\n往后余生，既有被人稳稳偏爱的幸运，也有独自安然前行的勇气。`
    }
  },
  "被需要": {
    type: "被需要",
    archetype: "以付出为锚的守护者",
    icon: <Heart className="w-8 h-8" />,
    quote: "“没有你，我只是一片废墟。”",
    cardStyle: "from-orange-600/60 to-red-800/60 shadow-[0_0_40px_-5px_rgba(234,88,12,0.5)] border-orange-200/40",
    accentColor: "text-orange-700",
    radarColor: "#ea580c",
    tabs: {
      base: `在亲密关系里，你最核心的需求是靠被对方依赖来确认自己的价值。对别人来说，爱可能是鲜花、情话和浪漫仪式，但对你而言，爱从来都是实打实的联结 —— 是“我能为你做什么”，是 “我的存在能让你少操心”。比起嘴上说得好听的甜言蜜语，你更在意自己的存在能让对方的生活变轻松，这种被需要的踏实反馈，才是你心里最安稳的安全感来源。\n\n你的情感底色里，藏着一种付出才值得被爱的本能认知。你会本能地盯着对方的生活细节：他加班晚了，你会提前煮好热饭；他遇到麻烦了，你会第一时间凑上去帮忙；甚至他随口提的喜好忌口，你都悄悄记在心里。这些付出不是刻意讨好，也不是为了换什么回报，只是真心想成为他生活里离不了的人。在你看来，被依赖就意味着自己在这段关系里不可替代，这份独一无二的位置，才让你觉得感情是扎实、不会轻易散的。\n\n可这份对 “被需要” 的执念背后，藏着你最怕的事 —— 怕自己是可有可无的。要是对方凡事都自己扛，不愿麻烦你，也很少主动找你帮忙，你表面上会笑着说 “没事，你能搞定就好”，心里却会悄悄空落落的：“原来没有我，他也能过得挺好”“我是不是在他这儿，也没那么重要”。你不是想控制谁，也不是占有欲强，只是需要通过一次次被他需要的小事，反复确认自己在他心里的分量。在你眼里，不被需要有时候就等于不被爱，那种没着没落的感觉，比吵架还让人难受。`,
      lightShadow: [
        { label: "靠谱的务实支撑力 (光)", text: "你是对方生活里最踏实的后盾，从来不会只说漂亮话。比起口头安慰，你更愿意用实打实的行动帮忙 —— 他工作卡壳时你搭把手出主意，生活忙乱时你默默扛起琐事，那种 “不管有事没事，我都在” 的态度，能让他真真切切感受到安全感，觉得自己不是一个人硬扛。" },
        { label: "暖心的情感联结力 (光)", text: "你总能通过付出和被依赖，把感情粘得很牢。你特别会察言观色，能捕捉到他没说出口的需求 —— 比如他强撑着说 “没事” 时的疲惫，或是不好意思拒绝别人时的为难，你都会主动上前搭把手。这种被看见、被照顾的感觉，会让他越来越依赖你，让两个人的关系满是温度。" },
        { label: "清醒的互惠平衡感 (光)", text: "你不是那种一味付出的傻好人，心里很清楚感情需要你来我往。你愿意为关系兜底、多做一点，但也盼着对方能看见你的付出，偶尔也回应你的需求。这种不偏不倚的互动，能让感情一直健康走下去，不会变成一个人的独角戏。" },
        { label: "价值感绑在 “被需要” 上 (影)", text: "你总不自觉把 “他需不需要我” 和 “我重不重要” 绑在一起。要是他暂时能自己处理事情，没怎么依赖你，你就容易胡思乱想：“原来没有我也可以”，心里空落落的，甚至悄悄觉得自己没那么有价值了。" },
        { label: "不敢直说 “我也想被你需要” (影)", text: "你心里其实很期待他主动找你帮忙，但又怕说出来会给对方压力，更怕被拒绝后，坐实了 “我不重要” 的想法。所以你宁愿默默付出，等着对方主动来需要自己，明明心里很期待，嘴上却要装大方：“没事，你自己搞定就好”，这份藏在心里的期待，慢慢就变成了失落和委屈。" },
        { label: "过度承担把自己累垮 (影)", text: "因为悄悄担心他累着，也怕他不再需要自己，你会不自觉把好多活都揽过来。哪怕自己已经累得不行，也硬撑着帮他跑腿、处理琐事；哪怕这件事超出你的能力范围，也不好意思说 “我做不到”。久而久之，付出变成了沉重的负担，你陷入 “越付出越累，越累越怕他离开” 的循环里，慢慢消耗着自己。" }
      ],
      partner: [
        "1、TA 说我来吧，其实是最直接的爱意表达\n当 TA 主动提出帮你处理琐事、分担压力时，别随口说不用不用。在 TA 心里，接受这份帮助从来不是麻烦，而是对 TA 自身价值的肯定，你越是拒绝，TA 心里越容易悄悄怀疑自己是不是多余的。",
        "2、主动向 TA 求助，是最珍贵的认可\n你不必假装什么都能扛，偶尔说一句这件事我搞不定，你能陪我一下吗，或者我今天好累，想让你帮我煮碗面，会让 TA 瞬间感受到被信任、被需要的重量，这种肯定比任何甜言蜜语都管用。",
        "3、TA 的过度照顾，背后藏着怕失去你的不安\n当你觉得 TA 做得太多、甚至有点多管闲事时，别直接反驳说你别这样。更温柔的方式是抱住 TA，告诉 TA 我知道你心疼我，但你已经很重要了，不用这么拼命。让 TA 清楚知道，你需要的是 TA 这个人，而不是 TA 一直不停的付出。"
      ],
      origins: `深度溯源：看见那个 “懂事才被爱” 的小孩\n\n根据核心关系动机理论，你对被需要的极致渴求，本质是核心关系动机在早期成长中被塑形的结果 —— 这种情感欲望的根源，往往与童年里懂事才能被爱的成长体验深度绑定。\n\n你可能记得，小时候的你很早就学会了体谅。可能是父母工作忙碌，你悄悄学着做家务、照顾弟妹；可能是长辈情绪起伏不定，你慢慢练就察言观色的本事，把自己的委屈悄悄藏在心里。你渐渐发现，只有当自己能帮上忙、会照顾人时，才能获得更多关注和肯定。一句你真懂事、幸好有你，就成了童年里最温暖的回馈，也悄悄定义了你对爱的认知逻辑。\n\n久而久之，能帮上忙就会被他人需要，被他人需要才能被爱，这样的认知慢慢沉淀在你的潜意识里。你习惯了用付出换取被看见的机会，用照顾别人来证明自己的价值，却渐渐忘了：你也可以只是单纯做自己，不用刻意付出什么，就值得被好好爱着。这份童年里为了获得爱而练就的生存方式，让你在亲密关系中本能地扮演起付出者的角色，也让被需要成为你确认爱的核心驱动力 —— 正如核心关系动机理论所揭示的，这种源于早期依恋经历的情感欲望，会成为主导你亲密行为的稳定线索。`,
      reshape: `重塑：把价值从 “付出” 里解放出来\n\n1. 先学会不付出，也敢安心被爱\n你习惯了用自己能做什么来证明重要性，却忘了关系的核心是彼此需要，而非自己必须有用。下次对方独自搞定某件事，别再悄悄失落没帮上忙，试着告诉自己：他能独立是好事，自己哪怕什么都不做，陪伴和存在本身对他来说同样珍贵。\n每天睡前花两分钟，回想当天自己没付出却依然被惦记、被关心的小事 —— 可能是他主动分享日常点滴，可能是睡前悄悄为你盖好被子，这些细节都在告诉你：你值得被爱，不是因为做了什么，只是因为你就是你。\n\n2. 坦然说我也需要被照顾，不用硬撑万能者\n你总怕麻烦别人，习惯了扮演照顾他人的角色，却忘了核心关系动机里的连结，从来都是双向流动的。你可以试着主动表达自己的需求，不用觉得提要求是自私：\n累的时候，别硬撑着做饭做家务，直接说今天没力气，想让你帮忙煮碗粥；难过的时候，别自己默默消化情绪，坦诚说现在心情很差，想让你陪我聊聊天，不用给我出主意，听我说就好。\n你要知道，真正在乎你的人，不会觉得你的需求是负担，反而会因为能为你做点什么而开心 —— 就像你愿意为他付出一样，他也渴望成为你的依靠，这份双向的彼此需要，才是关系最健康的状态。\n\n3. 拓展自我价值的边界，不止于被他人需要\n根据人际关系理论，一个人的价值感越多元，就越不会在单一关系里过度焦虑。你可以试着把注意力从如何被伴侣需要，转移到如何让自己活得更充实：\n深耕一个喜欢的爱好，比如绘画、烘焙、徒步 —— 在这个过程中，你会因为自己做得出色而收获成就感，这种价值感不依赖任何人的认可；投入工作或学习，提升自身能力 —— 当你在职业上取得进步、学到新技能时，会发现自己本身就很有能力，这份自信无需通过付出才能证明；多和朋友相处，在友情里感受被他人需要的同时，也享受单纯的陪伴带来的快乐 —— 你会发现，除了爱情，还有很多人在乎你、需要你，自己的价值从来不是单一维度的。`,
      blessing: `愿你遇见这样一个人：他会珍惜你为他做的每一件事，也会主动为你分担疲惫；他会依赖你的照顾，也会把你的需求放在心上；他会告诉你：“有你帮忙很好，但没有你，我也一样在乎你”。\n\n更愿你慢慢活成自己的底气：不用靠付出换爱，不用靠有用换存在感，哪怕什么都不做，也能坦然相信 “我值得被好好爱着”。往后余生，你既能享受 “被需要” 的踏实，也能拥有 “被偏爱” 的笃定，活得既有温度，又有光芒。`
    }
  },
  "掌控感": {
    type: "掌控感",
    archetype: "为关系掌舵的同行者",
    icon: <Zap className="w-8 h-8" />,
    quote: "“我抛开了所有理智，只求你结束我的痛苦。”",
    cardStyle: "from-rose-700/60 to-red-900/60 shadow-[0_0_40px_-5px_rgba(225,29,72,0.5)] border-rose-200/40",
    accentColor: "text-rose-700",
    radarColor: "#be123c",
    tabs: {
      base: `在亲密关系里，你最核心的需求从不是控制对方，而是关系的可预期、可沟通、可协同。对别人来说，爱或许是即兴陪伴、模糊留白，但对你而言，亲密更像两人共掌舵的船，得提前校准航向、明确规则、同步节奏，你才能放下顾虑，放心交付自己。\n\n你对关系章法的执念，藏着对无序失控的恐惧。模糊的界限、反复的态度、没说清的期待，在你眼里都是隐患，只有把这些捋顺，你才敢确信关系是稳的。如果对方凭情绪做事、回避沟通或走一步看一步，你不会觉得是性格不合，反而会格外孤独 —— 像独自驾着没罗盘的船，既要稳住方向，又要拉扯对方节奏，没人一起扛理顺关系的责任，你只能被迫站出来当 “大人”。\n\n你真正想要的是双向协作：不用你单方面提要求、定规则，而是对方愿意主动对齐目标、一起沟通、互相调整。你渴望的伙伴，能看懂你想聊清楚背后的不安，和你一起为稳定付出，而不是让你独自扛下所有。你要的从不是掌控权，而是我们始终站在同一边的笃定。`,
      lightShadow: [
        { label: "清晰的关系梳理力 (光)", text: "你总能一眼看穿矛盾的关键，不会让误会越积越深。不管是彼此的界限划分、相处节奏的调整，还是心里的期待沟通，你都擅长把模糊的事说清楚，推动双方找到都认可的方式，让关系在明确的框架里稳稳往前走。" },
        { label: "务实的问题突破力 (光)", text: "面对关系里的卡点，你从不会拖着或逃避。你行动力强，更愿意主动想办法、做调整，而不是任由问题发酵。这份不推活、敢担当的态度，让关系总带着 “往前推进” 的方向感，不会一直原地打转。" },
        { label: "靠谱的关系托底力 (光)", text: "和你在一起，对方会觉得特别踏实。你不会让感情停留在 “凑活过” 的状态，会主动规划未来、协调遇到的矛盾，用理性和行动为这段关系兜底。有你在，对方不用慌着找方向，因为你已经把 “一起走下去” 的底气铺好了。" },
        { label: "对无序的极致焦虑 (影)", text: "一旦关系脱离预设的轨道 —— 比如对方做事没计划、总回避深入沟通、态度反复无常，你会比常人更容易陷入慌乱，觉得整段关系都在摇晃。这种失控感会让你本能地想 “抓得更紧”，试图把关系拉回自己能掌控的状态。" },
        { label: "独自掌舵的疲惫感 (影)", text: "你习惯了做关系里 “把舵的人”，默默扛起梳理节奏、解决问题、规划方向的责任。久而久之，身心俱疲却很难放手，总担心自己一松劲，这段关系就会乱成一团，没人再去打理。" },
        { label: "同步期待带来的压力 (影)", text: "你对自己要求严格，做事有清晰的思路和节奏，也会不自觉地期待对方能跟上。当对方跟不上你的步调、理解不了你的想法时，你容易感到失望甚至烦躁，却忘了每个人都有自己的处事节奏，不是所有人都能和你保持同频。" },
        { label: "理性掩盖下的情绪忽视 (影)", text: "你太擅长用逻辑分析问题、解决矛盾，以至于自己的委屈、疲惫、失落常常被忽略。你习惯了先处理事情，再照顾情绪，甚至忘了自己也需要被看见、被安慰，久而久之，这些没被释放的情绪会悄悄消耗你的心力。" }
      ],
      partner: [
        "1、TA 不是想控制你，而是怕关系乱了阵脚\n当 TA 主动说想聊聊这件事、要不要把话说开，不是想挑刺吵架，只是想和你一起把关系捋顺，拉回彼此都安心的状态，不用各自猜来猜去。",
        "2、TA 要的是一起扛的合作感，不是单方面的听话\n你可以有自己的想法和节奏，不用事事跟着 TA 的步调，但请坦诚说出来，让 TA 知道你也在为这段关系用心。长期什么都不说、一味顺着，只会让 TA 觉得自己在独自扛下所有关系里的事，慢慢累到撑不住。",
        "3、你可以温柔地告诉 TA，先不着急解决问题，就单纯陪一陪\nTA 面对矛盾的本能是先找答案、想办法，有时会不小心忽略你的情绪。如果你明确说我现在不想聊解决方案，就想被你抱着静一静，TA 其实愿意放慢理性的脚步，先好好照顾你的感受。"
      ],
      origins: `深度溯源：看见那个 “必须懂事扛事” 的小孩\n\n你对掌控感的执念，从来不是天生爱操心，而是小时候在无序的环境里，慢慢被逼出来的一种生存本能 —— 那种没人牵头，一切就会乱成一团的不安，成了你心里最深刻的印记。\n\n小时候的成长里，或许总有些让人心里没底的时刻：可能环境里少了清晰的规则，遇事没人定调，大家慌慌张张没个准头；可能遇到问题时，没人愿意站出来扛，要么互相推脱，要么凭着情绪瞎决定；也可能计划总被轻易打乱，没个稳定的预期，让人摸不透接下来会发生什么。\n\n你慢慢发现，想要不被这种混乱裹挟，想要心里踏实点，只能自己站出来：主动把事情捋顺、把规则理清，提前想到可能出问题的地方，甚至学着调和身边的矛盾。不是你想当 “小大人”，而是那种看着一切脱离轨道、没人托底的无力感，实在太让人害怕了 —— 好像只有自己把局面抓在手里，把秩序建立起来，才能躲开那种慌慌张张的不安。\n\n后来你长大了，这种建立秩序的本能，自然带进了亲密关系里。你主动管节奏、定方向、解矛盾，不是想控制谁，而是怕重蹈小时候的覆辙 —— 怕关系里没章法、没规则，怕遇事没人一起扛，最后又陷入那种没人托底的混乱。\n\n可只有你自己知道，这份掌控背后藏着多少疲惫：你也想偶尔不用事事自己拿主意，不用总提着心预判风险，不用一直绷着神经当靠谱的人。也想有个人对你说 “这事交给我，你不用管”，让你能放下所有顾虑，安安心心当一次不用操心的人。只是这么多年，你早就习惯了用扛事武装自己，忘了自己也有需要被人兜着的时刻。`,
      reshape: `重塑：允许关系有 “不掌控” 的空间\n\n1、接纳适度失控，关系不必事事精准\n关系不是精密仪器，不用事事都卡着点、算着步。不用逼自己抓牢所有细节，偶尔偏离预期不是出错，一点小意外、一次节奏错位，反而能让感情更有弹性。下次对方没按计划来，或是临时变了想法，别立刻慌着调整，先深呼吸告诉自己：没关系，不用急着纠偏，我们慢慢磨合就好。给关系一点缓冲的余地，也给自己松松紧绷的神经。\n\n2、放下全能责任，学会把担子分出去\n你不是关系里唯一的责任人，没必要事事亲力亲为、替人收拾残局。当你又习惯性想包揽所有事时，试着停一停，把部分责任交出去：这件事你肯定有自己的想法，不如你来主导，我跟着你的节奏配合就好。你要知道，真正稳固的关系是两个人互相搭把手，而不是你一个人硬撑着扛下所有。学会依赖，学会放手，才是对自己的温柔。\n\n3、允许自己不懂事，暴露脆弱从来不是软弱\n你不用永远做那个最清醒、最能扛的人，偶尔也可以卸下防备，做个 “不用操心” 的人。累到撑不住的时候，不用硬撑着说没事，直接说我现在没力气想那么多，我们先缓一缓；委屈难过的时候，不用藏在逻辑分析里，坦诚说这件事让我心里不舒服，我需要你的安慰。承认自己的无力，不是软弱，而是敢对自己诚实 —— 你也需要被照顾，也需要有人接住你的情绪。`,
      blessing: `愿你遇见一个能和你并肩扛事、一起决策的人，不用再让你独自做那个 “负责全局的大人”。你们可以一起定方向，也可以一起接受偶尔的失控；他会尊重你的清醒，也会接住你偶尔的脆弱。\n\n更愿你慢慢学会，掌控感不是安全感的唯一来源。你可以保留自己的清醒和判断力，也能放心地说这次我想被带一带。往后余生，既有掌舵的底气，也有被照顾的福气，让世界在你稳住别人的同时，也悄悄稳住你。`
    }
  },
  "被偏爱": {
    type: "被偏爱",
    archetype: "渴求例外的驯养者",
    icon: <Sparkles className="w-8 h-8" />,
    quote: "“你要永远为你驯服的东西负责。”",
    cardStyle: "from-pink-600/60 to-fuchsia-800/60 shadow-[0_0_40px_-5px_rgba(219,39,119,0.5)] border-pink-200/40",
    accentColor: "text-pink-600",
    radarColor: "#db2777",
    tabs: {
      base: `你愿意毫无保留地付出，也能带着真心耐心经营，但这份投入有个隐形前提 —— 你的爱意需要被 “特殊对待” 来回应。如果有一天，你发现他的温柔开始平均分配，对别人的在意不比对你少，对你的倾斜慢慢消失，你的情绪会瞬间绷紧。这不是嫉妒，也不是小气，是你赖以生存的 “例外感” 被稀释了。\n\n你比谁都能精准捕捉感情里的温度波动，哪怕是一丝一毫的冷淡、敷衍或疏忽，都能触动你内心最敏感的神经。这份敏锐让你爱得格外深沉，能把关系经营得细腻又动人；但也让你格外脆弱，因为你所有的安全感，都扎根在 “我是你独一份的偏爱” 这个锚点上，一旦这个锚点松动，整段关系的安全感都会跟着崩塌。`,
      lightShadow: [
        { label: "深情且坚定的专注度 (光)", text: "一旦认定一个人，你会全身心投入，给出稳定又纯粹的爱意回馈，不会轻易摇摆。你的爱不是泛泛的好，而是带着 “只对你” 的专属感，让对方能清晰感受到被珍视。" },
        { label: "细腻入微的洞察力 (光)", text: "你能捕捉到别人忽略的细节 —— 记得他随口提的喜好、察觉他没说出口的情绪、在意他隐藏的疲惫，这种 “被真正看见” 的体贴，让关系充满温度。" },
        { label: "用心经营独特联结 (光)", text: "你擅长创造属于你们的专属记忆，可能是只有彼此懂的暗号，可能是优先考虑对方的习惯，这些 “别人没有” 的小细节，让关系变得格外深刻动人。" },
        { label: "推动关系真诚深度 (光)", text: "你的认真会带动对方更坦诚地对待感情，不敷衍、不模糊，逼着彼此直面内心的需求，让关系在真实的互动里越走越近。" },
        { label: "对差别对待的极致敏感 (影)", text: "对方对别人多一份耐心、多一句关心、多一次迁就，你心里的天平就会悄悄倾斜。不是小气，是怕自己的 “特别” 被稀释，怕那份独有的偏爱慢慢消失。" },
        { label: "陷入过度求证的内耗 (影)", text: "你会忍不住反复琢磨他的言行，哪怕是一句随口的话、一个无心的忽略，都要从中寻找 “他到底有没有更在乎我” 的答案，越想越焦虑，陷入自我消耗。" },
        { label: "怕落空的防御性退缩 (影)", text: "一旦感觉自己不再特别，你会下意识收回深情。不是冷漠，是怕自己毫无保留地付出，最后只换来和别人一样的待遇，这份防御背后，是藏不住的不安。" },
        { label: "小事放大的不安触发 (影)", text: "一个敷衍的回应、一次被排在后面的选择、一句没放在心上的承诺，在你眼里都会变成 “我不够重要” 的信号，轻易就触动内心的敏感神经。" }
      ],
      partner: [
        "1、TA 要的从不是更多，而是独一份\n不用送昂贵的礼物，但若你记得她随口提的喜好，或是在众人面前下意识护着她，这种只对她有的用心，才是最让她安心的偏爱。",
        "2、别用你想太多否定她的敏感\n当 TA 因为小事委屈、闷闷不乐时，最伤人的不是事情本身，是你一句小题大做。先抱抱她说我懂你在意的是我没对你特别对待，再慢慢解释，比讲道理管用得多。",
        "3、主动表达偏爱是她的刚需，不是加分项\n偶尔说一句你在我心里和别人不一样，或是在选择时优先考虑 TA 的感受，这些直白的信号，能帮她赶走所有 “我是不是可替代” 的不安。"
      ],
      origins: `深度溯源：看见那个渴望 “被优先选择” 的小孩\n\n你对偏爱的执着，并非贪心或矫情，而是核心情感欲望在早期成长中被反复强化的结果 —— 这份对独一份的渴求，往往源于那些自己的在意没被优先回应的成长时刻。\n\n小时候的你，或许总处在一种关注被分摊的环境里：可能是身边人的注意力被其他事或其他人占据，你的需求常常要排在后面；可能是你的情绪、想法很少被单独看见，大多时候要和别人分享来自他人的在意。慢慢你发现，只有当自己得到不一样的对待 —— 比如一份独属于自己的关注、一次优先考虑的选择、一句专门针对你的肯定，才能真切感受到 “我是重要的”。\n\n那些稀缺的特殊时刻，成了童年里最珍贵的心理养分。久而久之，“被偏爱 = 被重视 = 被爱” 的认知悄悄在心里扎根，变成了一种本能的情感期待。这份源于早年的心理缺口，让你在亲密关系中格外执着于差别对待—— 你并非计较对方对别人好，而是想通过那份只对我这样的例外感，补上童年没被坚定选择的遗憾。\n\n你拼命在细节里寻找偏爱信号，其实是在反复确认一个问题：我能不能成为那个不用和别人争抢，就被你放在心上第一位的人？这份对例外感的执着，本质上是对稳定且唯一的重视的深层渴望。`,
      reshape: `重塑：先学会自己偏爱自己\n\n1、接纳敏感，它不是缺点\n不用骂自己小心眼、太矫情，你的敏感只是因为太在乎被特别对待。当你因为小事难过时，先对自己说一句我知道你只是怕没被偏爱，这份情绪没有错，不用逼自己压抑，也不用否定自己的感受。\n\n2、自己先给足自己独一份的宠爱\n别总等着别人来证明你的特别，你可以先主动偏爱自己：想吃的东西不用等别人买，自己去尝；想做的事不用盼着别人陪，自己去做；有情绪时不用忍着讨好别人，先好好照顾自己的心情。你值得被偏爱，这份偏爱不用依赖任何人，从自己开始就足够。\n\n3、学会直白表达需求，不用猜来猜去\n不用让对方费力猜测你的想法，直接说出来更省心：和别人聊天时，希望你能先回我的消息；想让你在朋友面前多提提我；这件事，我希望你能优先考虑我的感受。清晰的需求才能换来精准的回应，不用把自己困在他为什么不懂的焦虑里，直白表达从来都不是自私，是对自己的负责。`,
      blessing: `愿你遇见明目张胆的偏爱，有人把你放在心尖上，让你清清楚楚感受到，自己就是那个不可替代的例外。\n\n更愿你自带自我偏爱的底气，不用依赖别人的特殊对待，也能笃定自己值得所有美好 —— 往后余生，被爱眷顾，更被自己偏爱。`
    }
  },
  "精神共鸣": {
    type: "精神共鸣",
    archetype: "灵魂旷野的寻觅者",
    icon: <Eye className="w-8 h-8" />,
    quote: "“我们相遇在精神的旷野，无需言语便已相通。”",
    cardStyle: "from-purple-600/60 to-violet-900/60 shadow-[0_0_40px_-5px_rgba(147,51,234,0.5)] border-purple-200/40",
    accentColor: "text-purple-700",
    radarColor: "#9333ea",
    tabs: {
      base: `在亲密关系里，你最核心的需求从不是占有或依赖，甚至不是流于表面的陪伴，而是一种灵魂层面的同频共振 —— 思想被看见、观点被呼应、内心深处的褶皱被温柔抚平。对别人来说，爱可能是柴米油盐的磨合、仪式感的堆砌，但对你而言，亲密的根基永远是思维契合与精神吸引：能一起穿透生活的表象，探讨那些看似无用却关乎自我的命题，能在彼此的眼神里读懂 “无需多言” 的默契，这样的靠近才让你觉得踏实。\n\n日常寒暄的温暖、琐碎陪伴的安稳，固然是关系的养分，却永远替代不了 “你一句话戳中我未说出口的心事”“你的观点让我突然豁然开朗” 的心灵碰撞。这种共鸣不是刻意追求深奥，而是对 “有质量的连接” 的本能渴求 —— 你怕的不是关系里没有话题，而是话题永远停留在 “吃了没”“在干嘛” 的浅层，怕两个人明明靠得很近，灵魂却隔着无法逾越的距离。\n\n你对浅层关系有着近乎本能的疏离感，没有精神交流的亲密，对你来说像一个缺了核心的空壳，再热闹也填不满内心的荒芜。你不是挑剔，而是太清楚自己要什么：一段关系可以不完美，可以有生活习惯的摩擦，可以有现实压力的考验，但绝不能没有 “懂” 的支撑。一旦遇到那个能在思维深处与你同频的人 —— 能听懂你话里的潜台词，能接住你突如其来的奇思妙想，能和你一起对世界保有好奇、一起成长，你便会卸下所有防备，毫无保留地深入投入，因为你知道，这样的灵魂相遇，才是你真正渴望的亲密。`,
      lightShadow: [
        { label: "思想共振的活力感 (光)", text: "你带对方的不只是爱情，更是共同成长的可能 —— 一起拓宽认知边界、探索世界，让关系始终保持向上的生命力。" },
        { label: "深层共情的理解力 (光)", text: "你懂得 “倾听” 的真正意义，不只是听表面的话，更能读懂背后的想法与情绪，让对方真切感受到 “被完全懂了” 的安心。" },
        { label: "持续焕新的新鲜感 (光)", text: "和你在一起从不会陷入枯燥重复，思维的碰撞、观点的交流，总能为关系注入新灵感，永远有聊不完的话题。" },
        { label: "理性与感性的平衡感 (光)", text: "你既擅长深度思考，也能传递细腻的情绪支持，不会让关系只停留在 “聊得来”，更有温度与陪伴的厚度。" },
        { label: "浅层关系的低耐受度 (影)", text: "如果一段关系长期只停留在 “吃了没”“在干嘛” 的琐事寒暄，没有深入的思想交流，你会慢慢失去存在感，想要抽离。" },
        { label: "将 “不理解” 等同于 “不在意” (影)", text: "对方未必不爱你，只是没能跟上你的思维深度，但这种 “聊不到一块” 的距离，在你心里会被放大成 “你不懂我，也不在乎我”。" },
        { label: "精神错位的高敏感度 (影)", text: "一旦对方的观点、节奏、对世界的态度不再与你同频，你对这段关系的期待会迅速下降，很难再找回最初的热情。" },
        { label: "忽略日常幸福的价值 (影)", text: "有时候你太执着于灵魂契合，反而会忽视相处中的小温暖 —— 比如默默的陪伴、笨拙的关心，这些普通的幸福其实也能滋养关系。" }
      ],
      partner: [
        "1、TA 要的不只是日常报备，更是心里的真实回响\n柴米油盐的琐事固然能维系陪伴，但如果长期只停留在 “吃了没”“在干嘛” 的表面寒暄，TA 会慢慢觉得这段关系里，自己的灵魂没被接住。愿意把心里的困惑、对生活的思考、甚至那些没说出口的价值观告诉你，对 TA 来说才是最踏实的靠近。",
        "2、当TA和你聊起那些好似“无用”的话题时，不是为了争辩，而是悄悄递来靠近的信号。\n那些抽象的探讨，本质上是 TA 想看看：你愿不愿意放下琐碎，在精神上陪 TA 站一会儿，一起触碰彼此内心更深的地方。",
        "3、你不用懂多少深奥理论，也不用读遍天下书，但请别关闭对内心和世界的探索欲\nTA 从来没要求你成为 “思想家”，只是希望你别用 “想那么多干嘛” 敷衍 TA 的认真。哪怕只是认真听 TA 说完，再坦诚地分享你的真实感受 —— 哪怕是 “我没想过这个问题，但我觉得你说得有道理”，对 TA 来说都是莫大的珍惜。"
      ],
      origins: `深度溯源：看见那个想得太多却没人懂的小孩\n\n你对精神共鸣的执着，从不是 “太复杂” 的矫情，而是核心关系动机在童年被悄悄塑形的结果 —— 那份 “心里有千言万语，却没人心能懂” 的孤独，早就在心底扎了根。\n\n小时候的你，或许总比同龄人多想一层：对世界有奇奇怪怪的疑问，对情绪有细腻难明的感知，对事情的来龙去脉总想追根究底。你试着把这些想法说出口，却很少被真正倾听：大人或许忙着生计，或许觉得你的思考 “没用”，没人愿意停下脚步，听你把那些天马行空的疑问、藏在情绪里的困惑说透，只会轻描淡写地告诉你 “别想那么多”“小孩子哪来那么多想法”。\n\n久而久之，你慢慢学会了把话咽回去，把思考藏起来 —— 自己琢磨那些没人回应的问题，自己消化那些不被理解的情绪。但心底里，却悄悄埋下了一个执拗的期待：希望有个人能看穿你的 “与众不同”，能跟上你跳跃的思路，能在你开口前就懂你没说出口的话，能和你聊那些别人觉得 “无聊” 却让你兴奋的话题。\n\n这份童年里未被满足的 “被懂” 的渴望，慢慢变成了你对亲密关系的核心期待。你不是刻意挑剔，只是太清楚 “没人懂” 的孤独有多难熬，所以才把 “精神同频” 当成了判断爱的重要标尺 —— 你要的从来不是多热烈的陪伴，而是一份 “不用费力解释，你就懂我” 的笃定，是想补上童年那堂 “没人听我把话说完” 的遗憾课。`,
      reshape: `重塑：允许自己的灵魂 “多元栖息”\n\n1、接纳你的深度需求，它从不是缺点\n不用怪自己 “想太多”“太较真”，更不用觉得喜欢聊深刻话题是矫情或难搞。你天生自带对深度连接的敏感，这份对意义、对共鸣、对思想碰撞的渴望，是你最独特的珍贵特质。你值得被懂，但不必强迫所有人都跟上你的节奏 —— 有人能懂是锦上添花的幸运，暂时没人懂，也不代表你不好、你的思考没价值。\n\n2、不把所有期待，都压在一个人身上\n如果伴侣暂时跟不上你的思维节奏，不用焦虑，也不用失望。灵魂的需求本就可以多元安放：不用逼他陪你聊抽象话题，你们可以一起逛超市、聊家常、享日常温暖；而那些关于人生、理想、世界的深度思考，完全可以分给志同道合的朋友、能引发共鸣的书籍，或是自己的创作。让不同的关系承接你不同层次的需求，不必苛求一个人满足你所有，反而能减少关系里的拉扯与失望。\n\n3、学会在普通日子里，发现藏着的连接\n试着放慢追逐 “灵魂契合” 的脚步，多留意日常相处里的小默契：一起吐槽堵车的无奈、看纪录片时同时发出的感慨、做饭时随口聊起的童年趣事，甚至是沉默坐着却觉得安心的瞬间。这些看似浅层的互动，其实都在悄悄拉近距离。灵魂同频固然是顶配，但普通日子里的包容、陪伴与互相迁就，同样是滋养关系的重要养分 —— 不是所有连接都要深刻，平淡里的心意，也值得被珍惜。`,
      blessing: `愿你这一生，既能遇见共享柴米油盐的人，也能遇见共赴精神旷野的伙伴。愿有人愿意认真听你说完所有奇思妙想，和你一起对世界保持好奇，一起为某个观点兴奋不已。也愿你在无人完全懂你的时刻，依然坚信：你的思考、你的独特，本身就是最珍贵的礼物，无需向谁证明。`
    }
  },
  "自由感": {
    type: "自由感",
    archetype: "守望星空的风之子",
    icon: <Wind className="w-8 h-8" />,
    quote: "“我爱你，却不愿用爱束缚你。”",
    cardStyle: "from-sky-500/60 to-blue-700/60 shadow-[0_0_40px_-5px_rgba(14,165,233,0.5)] border-sky-200/40",
    accentColor: "text-sky-600",
    radarColor: "#0284c7",
    tabs: {
      base: `在亲密关系里，你最核心的需求从不是占有或依赖，而是 “在爱里守住自我” 的自由 —— 靠近不难，难的是不用时刻黏在一起、不用事事报备、不用为了迎合对方丢掉自己的节奏。\n\n你愿意真心投入，也喜欢分享生活里的喜怒哀乐，但必须保留一块完全属于自己的空间：可能是独处整理情绪的时间，可能是专注于爱好的沉浸，可能是不被打扰的个人节奏。只要这份空间被尊重，你的爱就会自然流淌，轻盈又稳定；可一旦被过度关注、被实时追问、被情绪绑架，或是被要求 “必须怎样”，你的本能反应就是退一步 —— 不是害怕亲密，而是怕在关系里慢慢弄丢自己，怕那些 “为你好” 的期待，最后变成困住自我的牢笼。\n\n对别人来说，亲密可能是 “时刻在线” 的陪伴、“无话不谈” 的捆绑，但对你而言，好的关系是 “我需要时你在，我想独处时你不扰”：我们可以并肩往前走，也可以各自有自己的轨道；可以分享心事，也可以保留秘密；不用为了对方改变自己的节奏，也不用强迫对方跟上自己的脚步。这份 “不吞没、不束缚” 的自在，才是你最踏实的亲密。`,
      lightShadow: [
        { label: "让人舒展的松弛感 (光)", text: "你从不会要求对方 “秒回消息”“事事报备”，也不会干涉他的社交圈、兴趣爱好，让对方觉得和你在一起不用紧绷，能安心做自己，没有被控制的压抑。" },
        { label: "清晰坚定的边界感 (光)", text: "你懂得尊重自己的空间，也从不越界干涉别人的选择，不会用 “爱” 为名绑架对方的生活，这种分寸感让关系始终保持舒展，不会陷入窒息的纠缠。" },
        { label: "自我负责的情绪力 (光)", text: "你很少把所有情绪都丢给对方消化，遇到压力、困惑时，更习惯自己先梳理、自己承担，不会过度依赖对方的安慰，不给关系添上沉重的情绪负担。" },
        { label: "轻盈不沉重的爱意 (光)", text: "你不喜欢戏剧化的争吵、黏腻的捆绑，也不会提过度苛刻的要求，你的爱像春风一样自然 —— 不用刻意维系，却能让彼此在自在的氛围里感受到温暖。" },
        { label: "对 “过度靠近” 的本能抗拒 (影)", text: "只要对方表现出过度依赖、频繁追问、或是试图掌控你的节奏，哪怕没有恶意，你也会下意识想后退，甚至提前拉开距离，容易让对方误以为你 “不够爱”。" },
        { label: "习惯 “独自消化” 的封闭性 (影)", text: "你太擅长自己处理情绪和问题，常常忘了对方也希望参与你的世界 —— 哪怕只是听你吐槽、陪你分担，你也会下意识说 “没事”，慢慢让对方觉得自己 “走不进你的心里”。" },
        { label: "对 “束缚” 的过度预判 (影)", text: "只要稍微感受到一点被期待、被要求的压力，你就会立刻警觉，甚至提前撤退，把 “可能被束缚” 的预判当成事实，这种自我保护，有时会误伤真正想靠近你的人。" },
        { label: "“清淡表达” 的误解风险 (影)", text: "你在意一个人时，表达方式也不会太浓烈 —— 不会频繁说 “我爱你”，不会刻意制造黏腻的仪式感，这种清淡的态度，很容易让对方感受不到你的在意，陷入 “他到底爱不爱我” 的猜疑。" }
      ],
      partner: [
        "1、我需要独处，从不是不爱你，而是只有把自己的情绪和节奏整理好，才能更好地爱你\n有时候我会暂时抽离去做自己的事，不是想冷落你，是独处的安静能让我沉淀好所有心绪，等我调整过来，就会带着更踏实的心意回到你身边。",
        "2、别用时刻在线检验我的爱。秒回消息、频繁报备行踪、每天黏在一起，这些从来都不是我爱你的证明\n我们可以找一种彼此都舒服的相处方式 —— 比如忙的时候先吱一声，有空了再慢慢分享日常，不用总用为什么不找我这样的话考验我，那样只会让我忍不住想往后退一步。",
        "3、当我主动告诉你我的安排，其实是在把你放进我的生活节奏里\n比如今天想一个人待着、最近在忙一件喜欢的事，这些都不是在推开你，而是我愿意让你知道我当下的状态，希望你能接住我的节奏。如果你能轻轻回应一句好，我等你，我会更安心，也更愿意在未来的日子里，把更多心里的话慢慢说给你听。"
      ],
      origins: `深度溯源：看见那个 “怕失去自我” 的小孩\n\n你对自由感的执着，从来不是 “不爱黏人” 的天性，而是早年成长体验刻进心底的本能渴望 —— 那些 “不能按自己的想法来、只能听话” 的压抑时刻，早就在心里埋下了对 “自我空间” 的极度珍视。\n\n小时候的你，总被 “听话” 的期待包裹：可能是想法刚说出口就被否定，想做的事总被大人安排好，连难过了都要被说 “别矫情”；可能是生活被严密管束，不能有自己的小爱好，不能随便和喜欢的人相处；也可能是被寄托了太多期待，必须活成别人想要的样子，慢慢就懂了，失去自我、顺着别人的节奏走，有多压抑。\n\n慢慢的，你在心里划了一道线：只有守住自己的空间和节奏，才不会被别人的期待吞没。这份从小到大练出来的自我保护，让你在亲密关系里对 “被绑住” 的感觉特别敏锐 —— 哪怕只是一点点过度关注、一点点 “你该这样” 的要求，你都会立刻警觉。不是你不想靠近，是太怕重蹈覆辙，太怕在关系里再次弄丢那个真实的自己。\n\n你拼命想要的自由，说到底，不过是想被好好尊重 —— 允许你按自己的节奏活，允许你保留喜欢的样子，允许你有不被打扰的空间。这份对自由的渴求，本质上是藏在心底的深层期待：我能不能不用迎合谁，就被好好爱着？`,
      reshape: `重塑：在自由与亲密间找到平衡\n\n1、接纳你的边界需求，它从不是冷漠\n不用因为自己不爱黏人就怪自己，也不用觉得需要独处是疏远。你对自由和边界的珍视，是保护真实自我的重要特质，从来不是缺点。你值得被爱，更值得被尊重本来的节奏 —— 真正爱你的人，不会逼你丢掉自己去迎合，只会接纳你所有的样子，包括你需要独处的时刻、不喜欢黏腻的习惯。真实的你，本身就值得被好好对待。\n\n2、温柔划定边界，不用刻意推开别人\n不用等对方越界了才仓促后退，不如在关系里主动说清自己的节奏：比如 “我每天想留 1 小时做自己的事，不是不想陪你，这样我反而能更专注地跟你相处”“我不喜欢频繁报备行踪，但忙的时候会主动说一声，不让你担心”。清晰的边界从不是推开别人，而是给彼此一份安心的约定 —— 你不用勉强自己妥协，对方也不用猜来猜去，这样的关系才能少点误会，多点自在。\n\n3、试着适度敞开，不用一直独自硬扛\n你可以保留自己消化情绪的习惯，但不用逼自己把所有心事都藏在心里。不用追求 “完全透明”，偶尔试着说一句 “这件事我有点乱，想听听你的想法”“我现在需要静一静，晚点跟你细说”，就已经很好。适度的敞开不是失去自由，也不是要你丢掉边界，而是让对方知道：你不是不想靠近，只是需要一点时间整理自己。不用怕暴露脆弱，真正在意你的人，会在你需要时陪着，不会趁虚而入打扰你的节奏。`,
      blessing: `愿你始终保有做自己的勇气和节奏，不用为了爱妥协，不用为了自由假装冷漠。愿你遇见这样的人：他懂你对自由的渴求，不会用 “爱” 捆绑你；你们是并行的光，各自有自己的轨道，却能在彼此需要时相互照亮。\n\n也愿你在需要后退一步时，不再自责 —— 真正懂你的人，会尊重你的边界；会留下来的人，从来不需要你用 “丢掉自我” 去挽留。往后余生，你既是自由的风，也能拥有安稳的岸，在爱里自在呼吸，在自我里闪闪发光。`
    }
  },
  "安全距离": {
    type: "安全距离",
    archetype: "迷雾中的试探者",
    icon: <Shield className="w-8 h-8" />,
    quote: "“待人如执烛，太近灼手，太远暗生。”",
    cardStyle: "from-teal-600/60 to-emerald-800/60 shadow-[0_0_40px_-5px_rgba(13,148,136,0.5)] border-teal-200/40",
    accentColor: "text-teal-700",
    radarColor: "#0f766e",
    tabs: {
      base: `在亲密关系里，你最核心的需求从不是轰轰烈烈的奔赴，而是 “安全第一” 的踏实靠近 —— 你从不是冷淡，也不是慢热，只是心里自带一层 “安全缓冲带”，像洗手前慢慢试探水温，先确认没有刺痛，才敢再往前挪一步。\n\n你的亲密节奏里藏着独有的审慎：先悄悄观察、反复确认，直到笃定 “这个人值得托付”，才敢真正卸下防备。任何猛扑过来的热情、急着拉你进入深度关系、逼你立刻敞开心扉，或是强求即时回应的行为，都会让你下意识启动自我保护。这不是推开，是怕步子迈太急反而摔得疼；是怕轻易交付真心，最后只换来敷衍与辜负；更是怕那些 “来得快” 的亲密，会像潮水一样突然退去。\n\n你需要的，是一个能读懂 “你不是不上心，只是需要时间” 的人：不用催着你敞开心扉，不用逼你立刻给出答案，愿意陪着你按自己的节奏慢慢走。你对关系的态度从来都是 “宁缺毋滥”—— 确定前有多审慎，确定后就有多坚定。一旦认定彼此，便会拿出骨子里的稳定、踏实与长情，比大多数人都更珍惜这份来之不易的亲密。`,
      lightShadow: [
        { label: "慎重长情的定心丸 (光)", text: "不轻易开启关系，一旦选择便全心投入、坚定不摇，从不会敷衍应付，是关系里最让人安心的 “定海神针”，能稳稳托住彼此的期待。" },
        { label: "亲疏有度的平衡感 (光)", text: "既不会黏腻到让人窒息，也不会疏远到让人不安，总能精准拿捏 “刚刚好” 的距离，让彼此在亲密中保留独立，在独立中感知联结，活得舒展自在。" },
        { label: "克制稳健的情绪力 (光)", text: "从不会把负面情绪随意甩给对方，也不会在冲动下做出伤害关系的决定，总能用理性稳住节奏，用审慎化解矛盾，避免双方陷入无谓的内耗。" },
        { label: "张弛有道的分寸感 (光)", text: "和你相处无需刻意迎合，也不必担心被忽略。那种 “不吞没、不冷落” 的舒适尺度，能让人卸下紧绷的防备，真切感受到踏实又安心的陪伴。" },
        { label: "节奏错位的孤独感 (影)", text: "你的 “慢试探” 总与他人的 “快节奏” 错位，不是不愿靠近，而是很少有人能读懂你 “需要时间确认” 的谨慎。你满心认真对待，却总被误解为 “不上心”，最后只剩 “不被读懂” 的孤单。" },
        { label: "被催后的防御性退缩 (影)", text: "只要对方急于推进关系、用力催促，哪怕没有恶意，你也会下意识后退自保。可对方往往把这份退缩当成 “没兴趣”，误会层层叠加，让关系越走越远。" },
        { label: "观察期的无限内耗 (影)", text: "总想着 “再确认一次”“再等等看”，越观察越不敢迈出关键一步，把关系困在原地。既怕草率选择会受伤，又怕过度谨慎会错过，陷入反复纠结的内耗。" },
        { label: "情绪表达的信息断层 (影)", text: "习惯把想法、担忧、需求都藏在心里，从不轻易外露。对方猜不透你在想什么，也不知道该如何靠近，久而久之，便会因猜不透、摸不着而感到疲惫，慢慢选择放弃。" }
      ],
      partner: [
        "1、我的慢，从来不是没感觉，是怕真心错付才不敢太快\n如果你催得太急、推得太猛，只会触发我的自我保护，让我下意识往后退。你看到的 “慢半拍”，其实是我在认真掂量、想把关系走稳 —— 我不想草率开始，只想和你稳稳走到最后，这份谨慎，从来都是对我们的负责。",
        "2、我很难在带着情绪的氛围里说心里话\n如果你习惯用指责、讽刺，或是发脾气的方式逼我交代想法，我只会本能地把心关上。但如果你能先放下评判，不着急反驳、不随便贴标签，哪怕不认同我的想法，也愿意听我把话说完，我反而会慢慢卸下防备，把藏在心里的话都告诉你。",
        "3、一直都靠谱的踏实感，比一次性的盛大更重要\n对我来说，一直没变的态度、说到做到的承诺、不夸张不刻意的温柔，远比一两次轰轰烈烈的示爱更有分量。你不用费心思讨好，只要能保持稳定的可靠，让我感受到 “你一直都在、不会突然消失”，我才敢真正放下所有顾虑，向你靠近。"
      ],
      origins: `深度溯源：看见那个怕受伤所以不敢靠近的小孩\n\n你对安全距离的执着，从来不是 “高冷”，而是早年成长里，一次次 “靠近 = 受伤” 的经历，悄悄在心里种下了一颗 “怕疼” 的种子。\n\n小时候的你，或许试过把最喜欢的玩具分享给伙伴，却被轻易弄坏；把藏在心里的小秘密告诉大人，却被当成玩笑调侃；或是真心表达 “我不想这样”，却被否定 “你太矫情”。也可能在情绪失控的大人面前，你不敢多说一句话，怕说错就被指责；信任过的人，最后却轻易辜负了你的期待。\n\n一次次失望后，你慢慢摸清了规律：不轻易伸手，就不会被推开；不随便袒露，就不会被伤害。与其冒着疼的风险靠近，不如先站在不远处观望，等确认没有危险，才敢往前挪一小步。这份为了保护自己而慢慢养成的习惯，成了刻在骨子里的自我保护。\n\n所以长大后的你，在亲密关系里才格外谨慎 —— 不是不想靠近，是太怕真心被敷衍，太怕投入被辜负，太怕自己毫无保留地敞开心扉，最后只换来一场漫不经心的对待。你所有的 “慢” 和 “远”，不过是想确认：这个人，真的不会伤害我吗？这份谨慎背后，藏着的其实是一颗渴望被认真对待，却又怕受伤的柔软的心。`,
      reshape: `重塑：允许自己慢慢靠近，慢慢相信\n\n1、接纳自己的节奏，不用自责太冷\n不用因为自己慢热、谨慎就苛责自己，也不用强迫自己跟上别人的步伐。你的慢，是对关系的认真，是对自己的保护，从来不是缺点。你有权利按自己的方式靠近想要的关系，真正适合你的人，自然会愿意等你准备好。\n\n2、试着小步敞开心扉，不用一步到位\n不用逼自己立刻全盘托出，也不用一直封闭内心。可以从分享细微的情绪、简单的想法开始：比如觉得这件事让自己有点在意，或者坦言其实不太喜欢这样的方式。选一个你觉得安全的小片段，试着跟对方说说。一点点打开自己，既不会让你感到压力，也能让对方慢慢读懂你的心意。\n\n3、直白说出你的需要，不用让对方猜\n不用让对方一直揣摩你的想法，温柔地把需求说清楚就好：告诉对方你需要一点时间确认，希望对方能多等等；或者坦言不太喜欢被催促，那样会让自己很紧张。清晰的表达从来不是矫情，而是减少误会的钥匙 —— 让对方知道该怎么靠近你，你也能在被理解的氛围里，慢慢放下心里的焦虑。`,
      blessing: `愿你遇见这样一个人：不催你交卷，不逼你前行，愿意陪着你慢慢来。他能读懂你慢热背后的赤诚，看穿你谨慎底下的深情，会静静陪你站在关系的门口，等你摸清所有安心的细节，试探够所有温暖的温度，再笑着伸出手，轻轻把你拉进门。\n\n更愿你往后的亲密、友情与合作里，不再被贴冷漠的标签。总有人懂你的分寸，尊重你的节奏，不用你刻意解释，也不用你勉强迎合。也愿你有一天，能在真正安全的关系里，轻轻告诉自己：这次，我可以试着比从前再靠近那么一点点。`
    }
  },
  "秩序感": {
    type: "秩序感",
    archetype: "构建未来的建筑师",
    icon: <Grid className="w-8 h-8" />,
    quote: "“好的关系，是一起把日子过成有章法的温柔。”",
    cardStyle: "from-slate-600/60 to-zinc-800/60 shadow-[0_0_40px_-5px_rgba(71,85,105,0.5)] border-slate-200/40",
    accentColor: "text-slate-700",
    radarColor: "#334155",
    tabs: {
      base: `在亲密关系里，你是主动和对方搭建关系框架的共建者，核心需求从不是模糊的浪漫悸动，而是两人共同打磨的秩序感 —— 清晰的边界不越界，明确的期待不猜度，可落地的沟通不内耗，这些才是你敢放心交付真心的底气。\n\n你打心底不信随缘式相处能走得远，认定长期关系的根基必须扎在坦诚沟通、明确共识的土壤里。这不是理性过度的较真，而是怕够了混乱带来的消耗：怕猜来猜去的误会拉扯，怕悬而未决的矛盾堆积，怕关系像没锚的船失了方向。所以你会下意识想要对齐彼此的位置、相处节奏、未来方向，甚至冲突时的解决方式，这些别人觉得没必要的细节，对你而言都是关系的安全护栏。\n\n当关系里出现模糊态度、不对齐的期待或不愿沟通的逃避，你会比谁都先感到焦虑。你需要的不是听话照做的伴侣，而是愿意一起共建规则的伙伴：他不会觉得你谈秩序是死板，反而懂你想把日子过顺的踏实；不会用顺其自然敷衍，反而愿意一起捋清模糊、解决矛盾。\n\n对你来说，亲密不是情绪的随意流动，而是两人并肩把日子过稳的笃定。你要的从不是轰轰烈烈的激情，而是无论遇到什么，都有章法可依、有底气共渡的踏实；追求的是既有序又温暖，既踏实又长久的关系状态。`,
      lightShadow: [
        { label: "化繁为简的秩序力 (光)", text: "擅长把混乱的相处捋顺，将模糊的边界、零散的期待转化为清晰共识，为关系避开无效内耗，少走很多弯路。" },
        { label: "主动破局的沟通力 (光)", text: "遇事从不会逃避冷战，反而主动牵头沟通，愿意和对方一起拆解问题、寻找答案，不把矛盾留到隔夜。" },
        { label: "长远共建的规划力 (光)", text: "自带长远视角，不沉溺当下甜蜜，更会从现实出发和对方共建未来规划，让关系在踏实步履中稳步扎根。" },
        { label: "稳若磐石的可靠感 (光)", text: "你给的亲密从不是虚无承诺，而是实实在在的支撑 —— 明确的回应、稳定的态度，是关系里最让人安心的依靠。" },
        { label: "对模糊状态零容忍 (影)", text: "只要对方态度暧昧、回避沟通，或是用顺其自然敷衍，心里就会立刻陷入焦虑，难以踏实下来。" },
        { label: "急于解决却忽略情绪缓冲 (影)", text: "习惯遇事立刻推进解决，却忘了亲密关系需要情绪消化的空间，有时候对方要的是安慰，而非马上被梳理成条理。" },
        { label: "重秩序易轻共情流动 (影)", text: "能快速看清问题本质给出方案，却容易忽略对方的情绪需求 —— 对方或许只是想吐槽发泄，这份理性反而让人觉得不被懂。" },
        { label: "对回避沟通者易失耐心 (影)", text: "你的要求其实很简单，只是希望对方愿意坐下来坦诚聊聊，但这在很多关系里难实现，久而久之便会因反复消耗失去耐心。" }
      ],
      partner: [
        "1、对我来说，坦诚本身就是最踏实的爱\n我不是故意较真，也不想控制什么，只是想和你一起少些不必要的内耗，把日子过顺。愿意和我一起商量相处规则、分工和彼此的期待，对我来说就是被尊重、被当成平等伙伴的最好证明。",
        "2、长时间的模糊状态，会慢慢耗光我对关系的安全感\n如果你总用顺其自然、先这样吧回避聊关系本身，我只会越来越焦虑，最后不是想争吵，而是想抽身 —— 我不想在混沌里消耗彼此，只想拥有一段清晰笃定的关系。",
        "3、当我提议我们坐下来好好聊聊，请一定认真对待\n我不是要审判谁、指责谁，只是想把误会捋清、把委屈讲开，重新对齐彼此的节奏和边界。你如果愿意和我一起面对，而不是逃避冷战，我对这段关系的信心会成倍增加。"
      ],
      origins: `深度溯源：看见那个靠秩序保护自己的小孩\n\n小时候的你，最怕没个准数的慌。可能是答应好的旅行说黄就黄，连句像样的解释都没有；可能是家里的规矩朝令夕改，今天允许的事明天就被否定，全看大人心情；也可能是遇事没人牵头，让你一个小孩站在原地手足无措。那种抓不住任何东西的无助，悄悄在心里压了一层又一层。\n\n你慢慢发现，只有自己给自己找章法才踏实：把玩具摆得整整齐齐，心里的乱就跟着少一点。这份秩序感，从来不是死板的坚持，而是你捂热不安的温柔方式 —— 用清晰的规则挡住突如其来的乱，用可控的流程抵消不知道怎么办的慌。\n\n长大后你把这份需求带进亲密关系，想要的从不是冷冰冰的条款，而是不用猜、不内耗的踏实。你要的秩序，本质上是有人和你一起稳住日子的安心。`,
      reshape: `重塑：允许关系有温柔的留白\n\n1、接纳自己的秩序需求，它从不是过度理性\n你对秩序的渴求，是保护自己也守护关系的珍贵能力 —— 清晰的边界、坦诚的沟通本就是长期关系的基石，你的需求一点都不过分，更不是需要修正的缺点。\n\n2、分清问题和情绪，给彼此缓冲空间\n下次遇到矛盾，别急着立刻推进解决。先问问自己：对方现在需要的是具体方案，还是只想被理解？试着先接住对方的情绪，比如轻轻说一句你现在肯定不好受，等情绪慢慢平复，再一起聊怎么处理。秩序感很重要，但情感的温度，和秩序感一样，都是关系能长久的底气。\n\n3、允许关系有暂时没答案的空白，但不接受逃避\n你不用要求所有事都立刻有结果，也可以允许彼此有慢慢梳理的时间，但这份空白不能成为对方回避沟通的借口。要拎得清：对方是真的需要时间消化，还是根本不愿面对问题？只要能看到对方的诚意，感受到他在努力靠近、愿意一起面对，偶尔慢一点、留白久一点，也没关系。`,
      blessing: `愿你遇见这样的同行者：不回避问题，不敷衍沟通，愿意和你一起把话说透、把日子捋顺，在亲密、友情、合作里，主动与你并肩分担 —— 不用你独自扛起混乱，而是一起把琐碎梳理成暖意，让秩序不再是负担，而是彼此安心的底气。\n\n也愿你始终懂得：你的清晰、原则与不将就的坚持，从来都是珍贵的礼物。有章法的相处少内耗，有共识的陪伴最绵长，这份踏实的温暖，会在岁月里慢慢沉淀，成为你最长久的幸福。`
    }
  }
};

// 雷达图的维度
const ALL_DIMENSIONS = ["确定感", "被需要", "掌控感", "被偏爱", "精神共鸣", "自由感", "安全距离", "秩序感"];

export default function SoulScan_StainedGlass() {
  const [step, setStep] = useState('landing');
  const [showInput, setShowInput] = useState(false);
  const [code, setCode] = useState('');
  const [errorMsg, setErrorMsg] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [mounted, setMounted] = useState(false);
  
  const [currentQIndex, setCurrentQIndex] = useState(0);
  const [scores, setScores] = useState({});
  const [results, setResults] = useState({ primary: null });
  const [currentPart, setCurrentPart] = useState(null);
  
  // 动画与分享状态
  const [flipped, setFlipped] = useState(false);
  const [isShaking, setIsShaking] = useState(false); // 震动
  const [isExploding, setIsExploding] = useState(false); // 白光
  const [showFinal, setShowFinal] = useState(false);
  
  const [chartData, setChartData] = useState([]);
  const [activeTab, setActiveTab] = useState('base');
  const [saving, setSaving] = useState(false);

  // 解决 Hydration 报错
  useEffect(() => {
    setMounted(true);
  }, []);

  // --- 1. 登录交互 ---
  const handleVerify = async () => {
    setErrorMsg('');
    const inputCode = code.trim();

    if (!inputCode) {
      setErrorMsg('请输入兑换码，不能为空');
      return;
    }

    setIsLoading(true);

    try {
      const { data, error } = await supabase
        .from('codes')
        .select('*')
        .eq('code', inputCode)
        .single();

      if (error || !data) {
        throw new Error('未找到该兑换码');
      }

      if (data.used_count >= data.max_uses) {
        throw new Error('该兑换码已被使用，请购买新码');
      }

      const { error: updateError } = await supabase
        .from('codes')
        .update({ used_count: data.used_count + 1 })
        .eq('code', inputCode);

      if (updateError) {
        throw new Error('系统繁忙，请重试');
      }
      
      setIsLoading(false);
      handlePartTransition(0);

    } catch (err) {
      console.error(err);
      setIsLoading(false);
      setErrorMsg(err.message || '兑换码无效或已被使用');
    }
  };

  const handlePartTransition = (index) => {
    const part = PARTS_CONFIG.find(p => p.startIndex === index);
    if (part) {
      setCurrentPart(part);
      setStep('partIntro');
    } else {
      setStep('quiz');
    }
  };

  const handleAnswer = (type) => {
    const newScores = { ...scores, [type]: (scores[type] || 0) + 1 };
    setScores(newScores);

    const nextIndex = currentQIndex + 1;
    if (nextIndex < QUESTIONS.length) {
      setCurrentQIndex(nextIndex);
      handlePartTransition(nextIndex);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } else {
      finishQuiz(newScores);
    }
  };

  const finishQuiz = (finalScores) => {
    setStep('analyzing');
    const sortedScores = Object.entries(finalScores).sort((a, b) => b[1] - a[1]);
    const primaryKey = sortedScores[0][0];

    const radarData = ALL_DIMENSIONS.map(type => ({
      subject: type,
      A: finalScores[type] || 0,
      fullMark: 8
    }));

    setTimeout(() => {
      setResults({ primary: primaryKey });
      setChartData(radarData);
      setStep('result_card');
    }, 2500);
  };

  // 优化的转场动画逻辑
  const handleCardClick = () => {
    if (flipped) return;
    
    // 阶段1：优雅翻转 (0s -> 0.8s)
    setFlipped(true);
    
    // 阶段2：剧烈震动 (0.8s -> 2.3s)
    setTimeout(() => {
      setIsShaking(true);
    }, 800);

    // 阶段3：白光炸裂 (2.3s -> 3.0s)
    setTimeout(() => {
      setIsExploding(true);
      
      // 阶段4：切换页面 (3.0s)
      setTimeout(() => {
        setShowFinal(true);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 700); // 白光持续时间
    }, 2300);
  };

  // 1. 生成纯净海报
  const handleSavePoster = async () => {
    const element = document.getElementById('clean-poster-area');
    if (!element) return;
    
    setSaving(true);
    try {
      const canvas = await html2canvas(element, {
        useCORS: true,
        scale: 2, // 高清
        backgroundColor: null,
      });
      const link = document.createElement('a');
      link.download = `我的欲望底色-${results.primary}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
      alert("✅ 结果卡片已保存！\n快去小红书评论区晒出你的结果吧~");
    } catch (err) {
      console.error('Poster failed', err);
    }
    setSaving(false);
  };

  // 2. 复制信封链接
  const handleCopyLink = () => {
    const link = `${SITE_URL}/letter?type=${results.primary}`;
    navigator.clipboard.writeText(link).then(() => {
      alert("💌 心之密语已复制！\n\n请私发给微信/QQ好友，邀请TA拆开这封信。（请勿发到小红书哦）");
    });
  };

  const handleGoToXiaohongshu = () => {
    navigator.clipboard.writeText(XIAOHONGSHU_KEYWORD);
    alert(`已复制口令：${XIAOHONGSHU_KEYWORD}\n请前往小红书搜索购买`);
    window.location.href = "https://www.xiaohongshu.com";
  };

  if (!mounted) return null; // 防止 Hydration Error

  const progress = ((currentQIndex + 1) / QUESTIONS.length) * 100;
  const displayData = results.primary ? RESULTS[results.primary] : null;

  return (
    <div className="min-h-screen bg-[#FDFBF9] text-[#4A4A4A] font-sans selection:bg-rose-100 flex flex-col overflow-x-hidden">
      
      <Head>
        <script src="https://cdn.tailwindcss.com"></script>
      </Head>

      {/* 顶部栏 */}
      {step !== 'landing' && step !== 'partIntro' && !showFinal && (
        <nav className="fixed top-0 w-full bg-white/80 backdrop-blur-md z-50 border-b border-stone-100 px-6 py-4 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <Sparkles className="w-4 h-4 text-rose-400" />
            <span className="font-serif font-bold tracking-widest text-stone-800 text-xs">SOUL SCAN</span>
          </div>
          {step === 'quiz' && (
            <span className="text-[10px] font-mono text-stone-400 bg-stone-100 px-2 py-1 rounded">
              {currentQIndex + 1} / {QUESTIONS.length}
            </span>
          )}
        </nav>
      )}

      {/* Landing Page */}
      {step === 'landing' && (
        <div className="flex-1 flex flex-col relative overflow-hidden">
          <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full bg-gradient-to-br from-rose-200/40 to-orange-100/40 blur-[80px]" />
          <div className="absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] rounded-full bg-gradient-to-tl from-blue-200/40 to-purple-100/40 blur-[80px]" />

          <div className="flex-1 flex flex-col justify-center items-center px-8 z-10 animate-fade-in">
            <div className="mb-8 p-4 bg-white/50 backdrop-blur-sm rounded-2xl shadow-sm border border-white/60">
               <Lock className="w-8 h-8 text-stone-700 opacity-80" />
            </div>
            <div className="text-center space-y-4 mb-12">
              <h1 className="text-4xl font-serif font-bold text-stone-800 tracking-wide">情感欲望图鉴</h1>
              <p className="text-sm font-light text-stone-500 tracking-[0.2em] uppercase">Unlock Your Hidden Desires</p>
            </div>

            <div className="w-full max-w-xs space-y-4 min-h-[140px]">
              {!showInput ? (
                <div className="space-y-3">
                  <button onClick={() => setShowInput(true)} className="w-full bg-stone-900 text-white py-4 rounded-xl font-bold text-sm shadow-xl hover:scale-[1.02] transition-all flex items-center justify-center gap-2">
                    <Key className="w-4 h-4" /> 我有兑换码
                  </button>
                  <button onClick={handleGoToXiaohongshu} className="w-full bg-rose-50 text-rose-600 border border-rose-100 py-4 rounded-xl font-bold text-sm hover:bg-rose-100 transition-colors flex items-center justify-center gap-2">
                    <Search className="w-4 h-4" /> 没有码？去小红书获取
                  </button>
                </div>
              ) : (
                <div className="space-y-3 animate-slide-up">
                  <input type="text" value={code} onChange={(e) => setCode(e.target.value)} placeholder="请输入兑换码" className="w-full p-4 bg-white/80 border border-stone-200 rounded-xl outline-none text-center focus:ring-2 focus:ring-rose-200 transition-all placeholder:text-xs" />
                  <button onClick={handleVerify} disabled={isLoading} className="w-full bg-stone-900 text-white py-4 rounded-xl font-bold text-sm shadow-lg hover:bg-stone-800 transition-colors flex items-center justify-center gap-2">
                    {isLoading ? <RefreshCw className="w-4 h-4 animate-spin" /> : '开始解锁'}
                  </button>
                  {errorMsg && <p className="text-xs text-red-500 text-center bg-red-50 py-2 rounded-lg">{errorMsg}</p>}
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* Part Intro */}
      {step === 'partIntro' && currentPart && (
        <div className="flex-1 bg-stone-900 flex flex-col justify-center items-center text-center p-8 animate-fade-in relative overflow-hidden">
           <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-10" />
           <div className="relative z-10 max-w-sm">
             <span className="text-rose-300/80 text-[10px] tracking-[0.4em] uppercase mb-6 block">Chapter</span>
             <h2 className="text-2xl font-serif font-bold mb-6 text-rose-50 tracking-wide">{currentPart.title}</h2>
             <div className="w-8 h-1 bg-rose-500/50 mx-auto mb-8 rounded-full"></div>
             <p className="text-lg font-serif italic text-white/90 mb-8 leading-relaxed px-4">{currentPart.quote}</p>
             <p className="text-xs text-stone-400 leading-6 mb-12 px-6">{currentPart.desc}</p>
             <button onClick={() => setStep('quiz')} className="group flex items-center gap-2 mx-auto text-rose-200 border border-rose-200/20 px-8 py-3 rounded-full hover:bg-rose-200/10 transition-all text-xs tracking-widest">
               CONTINUE <ChevronRight className="w-3 h-3 group-hover:translate-x-1 transition-transform" />
             </button>
           </div>
        </div>
      )}

      {/* Quiz */}
      {step === 'quiz' && (
        <div className="flex-1 flex flex-col pt-24 px-6 animate-slide-up max-w-md mx-auto w-full">
          <div className="w-full h-1 bg-stone-100 rounded-full mb-10 overflow-hidden">
            <div className="h-full bg-rose-400 transition-all duration-500 ease-out" style={{ width: `${progress}%` }} />
          </div>
          <div className="flex-1 flex flex-col justify-center pb-20">
             <div className="mb-2">
               <span className="text-[10px] font-bold tracking-widest uppercase text-rose-400 bg-rose-50 px-2 py-1 rounded inline-block mb-4">{currentQIndex < 16 ? 'Reality' : currentQIndex < 32 ? 'Emotion' : 'Soul'}</span>
               <h2 className="text-lg font-serif font-medium leading-relaxed text-stone-800">{QUESTIONS[currentQIndex].question}</h2>
             </div>
             <div className="space-y-3 mt-8">
               {QUESTIONS[currentQIndex].options.map((opt, idx) => (
                 <button key={idx} onClick={() => handleAnswer(opt.type)} className="w-full text-left p-5 bg-white border border-stone-100 rounded-2xl shadow-sm hover:border-rose-300 hover:shadow-md hover:bg-rose-50/30 transition-all duration-200 active:scale-[0.98] group relative overflow-hidden">
                   <div className="relative z-10 flex items-start gap-3">
                     <div className="w-4 h-4 rounded-full border border-stone-300 mt-0.5 group-hover:border-rose-400 group-hover:bg-rose-400 flex-shrink-0 transition-colors" />
                     <span className="text-sm text-stone-600 group-hover:text-stone-900 leading-relaxed">{opt.text}</span>
                   </div>
                 </button>
               ))}
             </div>
          </div>
        </div>
      )}

      {/* Analysis */}
      {step === 'analyzing' && (
        <div className="flex-1 flex flex-col justify-center items-center text-center bg-stone-900 text-white">
          <div className="relative w-24 h-24">
            <div className="absolute inset-0 border-2 border-stone-800 rounded-full" />
            <div className="absolute inset-0 border-2 border-rose-400 rounded-full border-t-transparent animate-spin" />
            <div className="absolute inset-0 flex items-center justify-center"><Sparkles className="w-8 h-8 text-rose-300 animate-pulse" /></div>
          </div>
          <h3 className="mt-8 text-base font-serif font-bold text-rose-50 tracking-wide">生成欲望图谱...</h3>
        </div>
      )}

      {/* Result Step 1: Card Flip + Crack */}
      {step === 'result_card' && !showFinal && (
        <div className="flex-1 flex flex-col items-center justify-center animate-fade-in p-6 bg-stone-900 relative overflow-hidden">
          
          {/* 白光遮罩 */}
          <div className={`absolute inset-0 z-50 bg-white pointer-events-none transition-opacity duration-700 ${isExploding ? 'opacity-100' : 'opacity-0'}`}></div>

          <p className={`text-center text-[10px] text-stone-400 mb-8 tracking-[0.2em] uppercase transition-opacity ${flipped ? 'opacity-0' : 'opacity-100'}`}>Tap to Reveal</p>
          
          <div 
            className="relative w-full max-w-sm aspect-[4/5] perspective-1000 cursor-pointer group" 
            onClick={handleCardClick}
          >
            {/* 核心动画容器：翻转 + 震动 */}
            <div className={`relative w-full h-full duration-1000 transform-style-3d transition-transform 
              ${flipped ? 'rotate-y-180' : ''} 
              ${isShaking ? 'animate-violent-shake' : ''}`
            }>
              
              {/* Back (封面) */}
              <div className="absolute inset-0 backface-hidden bg-stone-800 rounded-[2rem] shadow-2xl border border-white/10 flex flex-col items-center justify-center">
                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20" />
                <Sparkles className="w-16 h-16 text-rose-200/50 mb-6 animate-pulse" />
                <h3 className="text-rose-100/90 text-lg font-serif tracking-widest">点击揭晓</h3>
              </div>

              {/* Front (结果) */}
              <div className={`absolute inset-0 backface-hidden rotate-y-180 rounded-[2rem] overflow-hidden flex flex-col justify-between text-white p-8 
                bg-gradient-to-br ${displayData ? displayData.cardStyle : 'from-gray-800 to-black'} backdrop-blur-xl border border-white/30`}>
                
                {displayData && (
                  <div className="relative z-10 text-center mt-20">
                      <div className="w-20 h-20 mx-auto mb-6 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center border border-white/30 shadow-inner">
                        {displayData.icon}
                      </div>
                      <h2 className="text-4xl font-serif font-bold mb-2 drop-shadow-md">{results.primary}</h2>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Result Step 2: Final Share Page */}
      {showFinal && displayData && (
        <div className="flex-1 flex flex-col animate-fade-in bg-white pb-24">
          
          {/* 📸 专门用于生成【纯净海报】的区域 (无二维码) */}
          <div id="clean-poster-area" className="bg-white relative">
              {/* 海报卡牌区 */}
              <div className={`pt-16 pb-12 px-6 rounded-b-[3rem] shadow-xl bg-gradient-to-b ${displayData.cardStyle} text-white relative overflow-hidden`}>
                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-10" />
                <div className="absolute top-[-20%] right-[-20%] w-[80%] h-[80%] rounded-full bg-white/10 blur-[60px]" />
                
                <div className="relative z-10 flex flex-col items-center">
                  <p className="text-[10px] font-medium opacity-80 tracking-[0.3em] mb-4 uppercase border border-white/20 px-3 py-1 rounded-full bg-white/5 backdrop-blur-md">你的情感欲望是</p>
                  <h1 className="text-6xl font-serif font-bold mb-8 drop-shadow-lg tracking-wider text-center">{results.primary}</h1>
                  
                  {/* 雷达图 */}
                  <div className="w-full max-w-xs h-[300px] bg-white/10 backdrop-blur-sm rounded-3xl border border-white/20 p-4 shadow-inner relative mb-8">
                      <ResponsiveContainer width="100%" height="100%">
                        <RadarChart cx="50%" cy="50%" outerRadius="70%" data={chartData}>
                          <PolarGrid stroke="rgba(255,255,255,0.15)" />
                          <PolarAngleAxis dataKey="subject" tick={{ fill: 'white', fontSize: 10, fontWeight: 500 }} />
                          <PolarRadiusAxis angle={30} domain={[0, 8]} tick={false} axisLine={false} />
                          <Radar name="My Desire" dataKey="A" stroke={displayData.radarColor || "#fff"} strokeWidth={2} fill={displayData.radarColor || "#fff"} fillOpacity={0.5} />
                        </RadarChart>
                      </ResponsiveContainer>
                  </div>

                  <div className="relative px-6">
                    <span className="absolute -top-4 -left-0 text-5xl opacity-20 font-serif">“</span>
                    <p className="text-base font-serif italic text-center leading-8 opacity-95 px-2">{displayData.quote}</p>
                    <span className="absolute -bottom-6 -right-0 text-5xl opacity-20 font-serif">”</span>
                  </div>
                </div>
              </div>

              <div className="px-6 py-6 text-center bg-white">
                  <p className="text-[10px] text-stone-300 tracking-[0.4em] uppercase">柚子的心理小屋 · 原创出品</p>
              </div>
          </div>

          {/* 下方详细内容 (不截图) */}
          <div className="px-6 py-2 relative z-20">
             <div className="flex gap-2 overflow-x-auto pb-6 no-scrollbar">
                {[{ id: 'base', label: '底色' }, { id: 'lightShadow', label: '光影' }, { id: 'partner', label: '致伴侣' }, { id: 'origins', label: '溯源' }, { id: 'reshape', label: '重塑' }].map(tab => (
                  <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-all shadow-sm ${activeTab === tab.id ? 'bg-stone-800 text-white ring-2 ring-stone-800 ring-offset-2' : 'bg-white text-stone-500 border border-stone-200'}`}>
                    {tab.label}
                  </button>
                ))}
             </div>

             <div className="space-y-6 animate-fade-in pb-20">
                
                {activeTab === 'base' && <div className="bg-stone-50 p-6 rounded-2xl border border-stone-100"><h4 className="font-bold text-sm mb-4 text-stone-800 flex items-center gap-2 uppercase tracking-wider"><BookOpen className="w-4 h-4" /> 亲密底色</h4><p className="text-sm text-stone-600 leading-7 text-justify whitespace-pre-line">{displayData.tabs.base}</p></div>}
                
                {/* 光影图谱 - 分离显示 */}
                {activeTab === 'lightShadow' && (
                  <div className="space-y-4">
                    <div className="bg-amber-50/50 p-5 rounded-2xl border border-amber-100">
                        <h4 className="text-xs font-bold mb-4 flex items-center gap-2 text-amber-700"><Sun className="w-4 h-4" /> 你的光 (天赋优势)</h4>
                        <div className="space-y-4">
                           {displayData.tabs.lightShadow.filter(i => i.label.includes('(光)')).map((item, idx) => (
                             <div key={idx}>
                               <span className="text-xs font-bold text-amber-800 block mb-1">{item.label.split(' ')[0]}</span>
                               <p className="text-xs text-stone-600 leading-relaxed">{item.text}</p>
                             </div>
                           ))}
                        </div>
                    </div>
                    <div className="bg-slate-50 p-5 rounded-2xl border border-slate-100">
                        <h4 className="text-xs font-bold mb-4 flex items-center gap-2 text-slate-600"><Moon className="w-4 h-4" /> 你的影 (成长挑战)</h4>
                        <div className="space-y-4">
                           {displayData.tabs.lightShadow.filter(i => i.label.includes('(影)')).map((item, idx) => (
                             <div key={idx}>
                               <span className="text-xs font-bold text-slate-700 block mb-1">{item.label.split(' ')[0]}</span>
                               <p className="text-xs text-stone-600 leading-relaxed">{item.text}</p>
                             </div>
                           ))}
                        </div>
                    </div>
                  </div>
                )}

                {activeTab === 'partner' && <div className="space-y-3">{displayData.tabs.partner.map((l,i)=><div key={i} className="bg-white p-4 rounded-xl border border-stone-100 text-sm text-stone-600 shadow-sm"><span className={`font-serif italic text-xl ${displayData.accentColor} mr-2`}>{i+1}.</span>{l}</div>)}</div>}
                {activeTab === 'origins' && <div className="bg-white p-6 rounded-2xl border border-stone-100 text-sm text-stone-600 leading-7 text-justify whitespace-pre-line shadow-sm"><h4 className="font-bold text-sm mb-4 text-stone-800 flex items-center gap-2 uppercase tracking-wider"><Search className="w-4 h-4" /> 童年溯源</h4>{displayData.tabs.origins}</div>}
                {activeTab === 'reshape' && <div className="bg-emerald-50 p-6 rounded-2xl border border-emerald-100 text-sm text-emerald-800 leading-7 whitespace-pre-line"><h4 className="font-bold text-sm mb-4 text-emerald-800 flex items-center gap-2 uppercase tracking-wider"><Zap className="w-4 h-4" /> 能量重塑</h4>{displayData.tabs.reshape}</div>}
             
                {/* 底部祝福 (所有Tabs下都显示) */}
                <div className="mt-12 mb-8 text-center">
                   <Feather className="w-5 h-5 text-stone-300 mx-auto mb-4" />
                   <p className="font-serif italic text-stone-500 text-sm leading-8 px-4 whitespace-pre-line">{displayData.blessing}</p>
                   <div className="w-12 h-[1px] bg-stone-200 mx-auto mt-6"></div>
                </div>
             </div>
          </div>

          {/* 双按钮悬浮栏 */}
          <div className="fixed bottom-0 left-0 w-full px-4 py-4 bg-white/90 backdrop-blur-md border-t border-stone-100 z-50 flex gap-3">
            <button 
              onClick={handleSavePoster}
              className="flex-1 py-3 bg-stone-900 text-white rounded-xl text-xs font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-transform"
            >
              <Download className="w-4 h-4" />
              生成结果卡片 (防折叠)
            </button>
            
            <button 
              onClick={handleCopyLink}
              className="flex-1 py-3 bg-rose-50 text-rose-600 border border-rose-100 rounded-xl text-xs font-bold flex items-center justify-center gap-2 active:scale-95 transition-transform"
            >
              <LinkIcon className="w-4 h-4" />
              复制心之密语 (微信用)
            </button>
          </div>

        </div>
      )}

      <style jsx global>{`
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes violent-shake {
          0% { transform: rotateY(180deg) translate(0, 0) rotate(0deg); }
          25% { transform: rotateY(180deg) translate(5px, 5px) rotate(2deg); }
          50% { transform: rotateY(180deg) translate(-5px, -5px) rotate(-2deg); }
          75% { transform: rotateY(180deg) translate(5px, -5px) rotate(2deg); }
          100% { transform: rotateY(180deg) translate(0, 0) rotate(0deg); }
        }
        .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-fade-in { animation: slideUp 0.8s ease-out forwards; }
        .animate-violent-shake { animation: violent-shake 0.5s infinite; }
        .animate-bounce-slow { animation: bounce 2s infinite; }
      `}</style>
    </div>
  );
}
